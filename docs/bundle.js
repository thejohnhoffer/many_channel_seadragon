!function(e){var t={};function i(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},i.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=27)}([function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)r(i,n)&&(e[n]=i[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,i,n,r){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+n),r);else for(var o=0;o<n;o++)e[r+o]=t[i+o]},flattenChunks:function(e){var t,i,n,r,o,s;for(n=0,t=0,i=e.length;t<i;t++)n+=e[t].length;for(s=new Uint8Array(n),r=0,t=0,i=e.length;t<i;t++)o=e[t],s.set(o,r),r+=o.length;return s}},s={arraySet:function(e,t,i,n,r){for(var o=0;o<n;o++)e[r+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(n)},function(e,t,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,i){"use strict";var n=i(0),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var s=new n.Buf8(256),a=0;a<256;a++)s[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function l(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var i="",s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i}s[254]=s[254]=1,t.string2buf=function(e){var t,i,r,o,s,a=e.length,l=0;for(o=0;o<a;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new n.Buf8(l),s=0,o=0;s<l;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},t.buf2binstring=function(e){return l(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},t.buf2string=function(e,t){var i,n,r,o,a=t||e.length,h=new Array(2*a);for(n=0,i=0;i<a;)if((r=e[i++])<128)h[n++]=r;else if((o=s[r])>4)h[n++]=65533,i+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&i<a;)r=r<<6|63&e[i++],o--;o>1?h[n++]=65533:r<65536?h[n++]=r:(r-=65536,h[n++]=55296|r>>10&1023,h[n++]=56320|1023&r)}return l(h,n)},t.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+s[e[i]]>t?i:t}},function(e,t,i){"use strict";var n=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();e.exports=function(e,t,i,r){var o=n,s=r+i;e^=-1;for(var a=r;a<s;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}},function(e,t,i){"use strict";e.exports=function(e,t,i,n){for(var r=65535&e|0,o=e>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{o=o+(r=r+t[n++]|0)|0}while(--s);r%=65521,o%=65521}return r|o<<16|0}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,$,fullScreenApi;//! openseadragon 2.3.1
//! Built on 2018-05-18
//! Git commit: --dfad46e
//! http://openseadragon.github.io
//! License: http://openseadragon.github.io/license/
function OpenSeadragon(e){return new OpenSeadragon.Viewer(e)}!function(e){e.version={versionStr:"2.3.1",major:parseInt("2",10),minor:parseInt("3",10),revision:parseInt("1",10)};var t,i={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},n=Object.prototype.toString,r=Object.prototype.hasOwnProperty;e.isFunction=function(t){return"function"===e.type(t)},e.isArray=Array.isArray||function(t){return"array"===e.type(t)},e.isWindow=function(e){return e&&"object"==typeof e&&"setInterval"in e},e.type=function(e){return null===e||void 0===e?String(e):i[n.call(e)]||"object"},e.isPlainObject=function(t){if(!t||"object"!==OpenSeadragon.type(t)||t.nodeType||e.isWindow(t))return!1;if(t.constructor&&!r.call(t,"constructor")&&!r.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(var n in t)i=n;return void 0===i||r.call(t,i)},e.isEmptyObject=function(e){for(var t in e)return!1;return!0},e.freezeObject=function(t){return Object.freeze?e.freezeObject=Object.freeze:e.freezeObject=function(e){return e},e.freezeObject(t)},e.supportsCanvas=(t=document.createElement("canvas"),!(!e.isFunction(t.getContext)||!t.getContext("2d"))),e.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},e.pixelDensityRatio=function(){if(e.supportsCanvas){var t=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,n=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return Math.max(i,1)/n}return 1}()}(OpenSeadragon),function($){$.extend=function(){var e,t,i,n,r,o,s=arguments[0]||{},a=arguments.length,l=!1,h=1;for("boolean"==typeof s&&(l=s,s=arguments[1]||{},h=2),"object"==typeof s||OpenSeadragon.isFunction(s)||(s={}),a===h&&(s=this,--h);h<a;h++)if(null!==(e=arguments[h])||void 0!==e)for(t in e)i=s[t],s!==(n=e[t])&&(l&&n&&(OpenSeadragon.isPlainObject(n)||(r=OpenSeadragon.isArray(n)))?(r?(r=!1,o=i&&OpenSeadragon.isArray(i)?i:[]):o=i&&OpenSeadragon.isPlainObject(i)?i:{},s[t]=OpenSeadragon.extend(l,o,n)):void 0!==n&&(s[t]=n));return s};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var e=navigator.userAgent;return"string"==typeof e&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,degrees:0,opacity:1,preload:!1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(e){var t,i,n=new $.Point;for(i=getOffsetParent(e=$.getElement(e),t="fixed"==$.getElementStyle(e).position);i;)n.x+=e.offsetLeft,n.y+=e.offsetTop,t&&(n=n.plus($.getPageScroll())),i=getOffsetParent(e=i,t="fixed"==$.getElementStyle(e).position);return n},getElementOffset:function(e){var t,i,n=(e=$.getElement(e))&&e.ownerDocument,r={top:0,left:0};return n?(t=n.documentElement,void 0!==e.getBoundingClientRect&&(r=e.getBoundingClientRect()),i=n==n.window?n:9===n.nodeType&&(n.defaultView||n.parentWindow),new $.Point(r.left+(i.pageXOffset||t.scrollLeft)-(t.clientLeft||0),r.top+(i.pageYOffset||t.scrollTop)-(t.clientTop||0))):new $.Point},getElementSize:function(e){return e=$.getElement(e),new $.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return(e=$.getElement(e)).currentStyle}:function(e){return e=$.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var t={};return $.getCssPropertyWithVendorPrefix=function(e){if(void 0!==t[e])return t[e];var i=document.createElement("div").style,n=null;if(void 0!==i[e])n=e;else for(var r=["Webkit","Moz","MS","O","webkit","moz","ms","o"],o=$.capitalizeFirstLetter(e),s=0;s<r.length;s++){var a=r[s]+o;if(void 0!==i[a]){n=a;break}}return t[e]=n,n},$.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},positiveModulo:function(e,t){var i=e%t;return i<0&&(i+=t),i},pointInElement:function(e,t){e=$.getElement(e);var i=$.getElementOffset(e),n=$.getElementSize(e);return t.x>=i.x&&t.x<i.x+n.x&&t.y<i.y+n.y&&t.y>=i.y},getEvent:function(e){return $.getEvent=e?function(e){return e}:function(){return window.event},$.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.pageX,t.y=e.pageY,t};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(e){var t=new $.Point;return e=$.getEvent(e),t.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,t}}return $.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(t.scrollLeft||t.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(e){if(void 0!==window.scrollTo)$.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var t=$.getPageScroll();if(t.x===e.x&&t.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var i=$.getPageScroll();if(i.x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,(i=$.getPageScroll()).x!==t.x&&i.y!==t.y)return void($.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});$.setPageScroll=function(e){}}return $.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},t=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!t.clientWidth&&!t.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(e){e=$.getElement(e);var t=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(t[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(t[1].style,{display:"table-row"}),$.extend(t[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),t[0].appendChild(t[1]),t[1].appendChild(t[2]),t[2].appendChild(e),t[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(e){return $.makeTransparentImage=function(e){var t=$.makeNeutralElement("img");return t.src=e,t},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(e){var t=$.makeNeutralElement("img"),i=null;return(i=$.makeNeutralElement("span")).style.display="inline-block",t.onload=function(){i.style.width=i.style.width||t.width+"px",i.style.height=i.style.height||t.height+"px",t.onload=null,t=null},t.src=e,i.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",i}),$.makeTransparentImage(e)},setElementOpacity:function(e,t,i){var n;e=$.getElement(e),i&&!$.Browser.alpha&&(t=Math.round(t)),$.Browser.opacity?e.style.opacity=t<1?t:"":t<1?(n="alpha(opacity="+Math.round(100*t)+")",e.style.filter=n):e.style.filter=""},setElementTouchActionNone:function(e){void 0!==(e=$.getElement(e)).style.touchAction?e.style.touchAction="none":void 0!==e.style.msTouchAction&&(e.style.msTouchAction="none")},addClass:function(e,t){(e=$.getElement(e)).className?-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t):e.className=t},indexOf:function(e,t,i){return Array.prototype.indexOf?this.indexOf=function(e,t,i){return e.indexOf(t,i)}:this.indexOf=function(e,t,i){var n,r,o=i||0;if(!e)throw new TypeError;if(0===(r=e.length)||o>=r)return-1;for(o<0&&(o=r-Math.abs(o)),n=o;n<r;n++)if(e[n]===t)return n;return-1},this.indexOf(e,t,i)},removeClass:function(e,t){var i,n,r=[];for(i=(e=$.getElement(e)).className.split(/\s+/),n=0;n<i.length;n++)i[n]&&i[n]!==t&&r.push(i[n]);e.className=r.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,t,i,n){(e=$.getElement(e)).addEventListener(t,i,n)};if(window.attachEvent)return function(e,t,i,n){(e=$.getElement(e)).attachEvent("on"+t,i)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,t,i,n){(e=$.getElement(e)).removeEventListener(t,i,n)};if(window.detachEvent)return function(e,t,i,n){(e=$.getElement(e)).detachEvent("on"+t,i)};throw new Error("No known event model.")}(),cancelEvent:function(e){(e=$.getEvent(e)).preventDefault?$.cancelEvent=function(e){e.preventDefault()}:$.cancelEvent=function(e){(e=$.getEvent(e)).cancel=!0,e.returnValue=!1},$.cancelEvent(e)},stopEvent:function(e){(e=$.getEvent(e)).stopPropagation?$.stopEvent=function(e){e.stopPropagation()}:$.stopEvent=function(e){(e=$.getEvent(e)).cancelBubble=!0},$.stopEvent(e)},createCallback:function(e,t){var i,n=[];for(i=2;i<arguments.length;i++)n.push(arguments[i]);return function(){var i,r=n.concat([]);for(i=0;i<arguments.length;i++)r.push(arguments[i]);return t.apply(e,r)}},getUrlParameter:function(e){var t=URLPARAMS[e];return t||null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var t;try{t=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}if(t)window.XMLHttpRequest?$.createAjaxRequest=function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(e)},makeAjaxRequest:function(e,t,i){var n,r,o;$.isPlainObject(e)&&(t=e.success,i=e.error,n=e.withCredentials,r=e.headers,o=e.responseType||null,e=e.url);var s=$.getUrlProtocol(e),a=$.createAjaxRequest("file:"===s);if(!$.isFunction(t))throw new Error("makeAjaxRequest requires a success callback");a.onreadystatechange=function(){4==a.readyState&&(a.onreadystatechange=function(){},a.status>=200&&a.status<300||0===a.status&&"http:"!==s&&"https:"!==s?t(a):($.console.log("AJAX request returned %d: %s",a.status,e),$.isFunction(i)&&i(a)))};try{if(a.open("GET",e,!0),o&&(a.responseType=o),r)for(var l in r)r.hasOwnProperty(l)&&r[l]&&a.setRequestHeader(l,r[l]);n&&(a.withCredentials=!0),a.send(null)}catch(n){var h=n.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==n.number&&-2147024891==n.number&&(h+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",n.name,h),a.onreadystatechange=function(){},window.XDomainRequest){var c=new XDomainRequest;if(c){c.onload=function(e){$.isFunction(t)&&t({responseText:c.responseText,status:200,statusText:"OK"})},c.onerror=function(e){$.isFunction(i)&&i({responseText:c.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{c.open("GET",e),c.send()}catch(e){$.isFunction(i)&&i(a,n)}}}else $.isFunction(i)&&i(a,n)}return a},jsonp:function(e){var t,i=e.url,n=document.head||document.getElementsByTagName("head")[0]||document.documentElement,r=e.callbackName||"openseadragon"+$.now(),o=window[r],s="$1"+r+"$2",a=e.param||"callback",l=e.callback;i=i.replace(/(\=)\?(&|$)|\?\?/i,s),i+=(/\?/.test(i)?"&":"?")+a+"="+r,window[r]=function(e){if(o)window[r]=o;else try{delete window[r]}catch(e){}l&&$.isFunction(l)&&l(e)},t=document.createElement("script"),void 0===e.async&&!1===e.async||(t.async="async"),e.scriptCharset&&(t.charset=e.scriptCharset),t.src=i,t.onload=t.onreadystatechange=function(e,i){(i||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,n&&t.parentNode&&n.removeChild(t),t=void 0)},n.insertBefore(t,n.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)$.parseXml=function(e){return(new DOMParser).parseFromString(e,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(e){var t=null;return(t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t}}return $.parseXml(e)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(e){return!!FILEFORMATS[(e=e||"").toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var e=navigator.appVersion,t=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(t.substring(t.indexOf("MSIE")+5,t.indexOf(";",t.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(t.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(t.substring(t.indexOf("Firefox")+8))):t.indexOf("Safari")>=0?($.Browser.vendor=t.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(t.substring(t.substring(0,t.indexOf("Safari")).lastIndexOf("/")+1,t.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(t)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(e)}var i,n,r,o=window.location.search.substring(1).split("&");for(r=0;r<o.length;r++)(n=(i=o[r]).indexOf("="))>0&&(URLPARAMS[i.substring(0,n)]=decodeURIComponent(i.substring(n+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(e){};function getOffsetParent(e,t){return t&&e!=document.body?document.body:e.offsetParent}$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(e){var t=e.requestAnimationFrame||e.mozRequestAnimationFrame||e.webkitRequestAnimationFrame||e.msRequestAnimationFrame,i=e.cancelAnimationFrame||e.mozCancelAnimationFrame||e.webkitCancelAnimationFrame||e.msCancelAnimationFrame;if(t&&i)$.requestAnimationFrame=function(){return t.apply(e,arguments)},$.cancelAnimationFrame=function(){return i.apply(e,arguments)};else{var n,r=[],o=[],s=0;$.requestAnimationFrame=function(e){return r.push([++s,e]),n||(n=setInterval(function(){if(r.length){var e=$.now(),t=o;for(o=r,r=t;o.length;)o.shift()[1](e)}else clearInterval(n),n=void 0},20)),s},$.cancelAnimationFrame=function(e){var t,i;for(t=0,i=r.length;t<i;t+=1)if(r[t][0]===e)return void r.splice(t,1);for(t=0,i=o.length;t<i;t+=1)if(o[t][0]===e)return void o.splice(t,1)}}}(window)}(OpenSeadragon),__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0===(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=function(){return OpenSeadragon})?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__),$=OpenSeadragon,fullScreenApi={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""},document.exitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.fullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.requestFullscreen()},fullScreenApi.exitFullScreen=function(){document.exitFullscreen()},fullScreenApi.fullScreenEventName="fullscreenchange",fullScreenApi.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.msFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.msRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.msExitFullscreen()},fullScreenApi.fullScreenEventName="MSFullscreenChange",fullScreenApi.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitFullscreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullscreen()},fullScreenApi.exitFullScreen=function(){document.webkitExitFullscreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.webkitRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.webkitCancelFullScreen()},fullScreenApi.fullScreenEventName="webkitfullscreenchange",fullScreenApi.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(fullScreenApi.supportsFullScreen=!0,fullScreenApi.getFullScreenElement=function(){return document.mozFullScreenElement},fullScreenApi.requestFullScreen=function(e){return e.mozRequestFullScreen()},fullScreenApi.exitFullScreen=function(){document.mozCancelFullScreen()},fullScreenApi.fullScreenEventName="mozfullscreenchange",fullScreenApi.fullScreenErrorEventName="mozfullscreenerror"),fullScreenApi.isFullScreen=function(){return null!==fullScreenApi.getFullScreenElement()},fullScreenApi.cancelFullScreen=function(){$.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),fullScreenApi.exitFullScreen()},$.extend($,fullScreenApi),function(e){e.EventSource=function(){this.events={}},e.EventSource.prototype={addOnceHandler:function(e,t,i,n){var r=this;n=n||1;var o=0,s=function(i){++o===n&&r.removeHandler(e,s),t(i)};this.addHandler(e,s,i)},addHandler:function(t,i,n){var r=this.events[t];r||(this.events[t]=r=[]),i&&e.isFunction(i)&&(r[r.length]={handler:i,userData:n||null})},removeHandler:function(t,i){var n,r=this.events[t],o=[];if(r&&e.isArray(r)){for(n=0;n<r.length;n++)r[n].handler!==i&&o.push(r[n]);this.events[t]=o}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(e,i){var n,r=t.length;for(n=0;n<r;n++)t[n]&&(i.eventSource=e,i.userData=t[n].userData,t[n].handler(i))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),function(e){var t,i,n,r,o,s,a=[],l={};function h(t){var i,n=l[t.hash],r=n.activePointersLists.length;for(i=0;i<r;i++)n.activePointersLists[i].captureCount>0&&(e.removeEvent(e.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),e.removeEvent(e.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[i].captureCount=0);for(i=0;i<r;i++)n.activePointersLists.pop()}function c(t){var i,n,r=l[t.hash];if(r.tracking){for(n=0;n<e.MouseTracker.subscribeEvents.length;n++)i=e.MouseTracker.subscribeEvents[n],e.removeEvent(t.element,i,r[i],!1);h(t),r.tracking=!1}}function u(t,i){var n=l[t.hash];if("pointerevent"===i)return{upName:e.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:n.pointerupcaptured,moveName:e.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:n.pointermovecaptured};if("mouse"===i)return{upName:"mouseup",upHandler:n.mouseupcaptured,moveName:"mousemove",moveHandler:n.mousemovecaptured};if("touch"===i)return{upName:"touchend",upHandler:n.touchendcaptured,moveName:"touchmove",moveHandler:n.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function d(t,i,n){var r,o=t.getActivePointersListByType(i);o.captureCount+=n||1,1===o.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.setCapture(!0):(r=u(t,e.MouseTracker.havePointerEvents?"pointerevent":i),j&&q(window.top)&&e.addEvent(window.top,r.upName,r.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,r.upName,r.upHandler,!0),e.addEvent(e.MouseTracker.captureElement,r.moveName,r.moveHandler,!0)))}function p(t,i,n){var r,o=t.getActivePointersListByType(i);o.captureCount-=n||1,0===o.captureCount&&(e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?t.element.releaseCapture():(r=u(t,e.MouseTracker.havePointerEvents?"pointerevent":i),j&&q(window.top)&&e.removeEvent(window.top,r.upName,r.upHandler,!0),e.removeEvent(e.MouseTracker.captureElement,r.moveName,r.moveHandler,!0),e.removeEvent(e.MouseTracker.captureElement,r.upName,r.upHandler,!0)))}function g(t){var i;if(e.MouseTracker.unprefixedPointerEvents)i=t.pointerType;else switch(t.pointerType){case 2:i="touch";break;case 3:i="pen";break;case 4:i="mouse";break;default:i=""}return i}function m(t){return e.getMousePosition(t)}function f(e,t){return v(m(e),t)}function v(t,i){var n=e.getElementOffset(i);return t.minus(n)}function w(t,i){return new e.Point((t.x+i.x)/2,(t.y+i.y)/2)}function y(t,i){var n={target:(i=e.getEvent(i)).target||i.srcElement,type:"wheel",shiftKey:i.shiftKey||!1,clientX:i.clientX,clientY:i.clientY,pageX:i.pageX?i.pageX:i.clientX,pageY:i.pageY?i.pageY:i.clientY,deltaMode:"MozMousePixelScroll"==i.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==e.MouseTracker.wheelEventName?n.deltaY=-i.wheelDelta/e.DEFAULT_SETTINGS.pixelsPerWheelLine:n.deltaY=i.detail,_(t,n,i)}function _(t,i,n){var r;r=i.deltaY<0?1:-1,t.scrollHandler&&!1===t.scrollHandler({eventSource:t,pointerType:"mouse",position:f(i,t.element),scroll:r,shift:i.shiftKey,isTouchEvent:!1,originalEvent:n,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(n)}function T(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function x(t,i){N(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(i),currentTime:e.now()}])}function S(t,i){U(t,i,[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(i),currentTime:e.now()}])}function b(t){return e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?1===t?0:2===t?2:4===t?1:-1:t}function E(t,i){V(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(i),currentTime:e.now()}],b(i.button))&&p(t,"mouse")}function P(t,i){G(t,i=e.getEvent(i),[{id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(i),currentTime:e.now()}])}function R(e,t,i){var n,r=i.getLength(),o=[];if("touch"===i.type||i.contacts>0){for(n=0;n<r;n++)o.push(i.getByIndex(n));o.length>0&&(V(e,t,o,0),i.captureCount=1,p(e,i.type),U(e,t,o))}}function C(t,i){var n,r,o,s,l=i.changedTouches.length,h=[];for(n=e.now(),r=0;r<l;r++)h.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:m(i.changedTouches[r]),currentTime:n});for(V(t,i,h,0)&&p(t,"touch",l),U(t,i,h),r=0;r<a.length;r++)if(a[r]!==t&&a[r].isTracking()&&T(a[r].element,t.element)){for(s=[],o=0;o<l;o++)s.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:m(i.changedTouches[o]),currentTime:n});U(a[r],i,s)}e.cancelEvent(i)}function k(t,i){var n,r=i.changedTouches.length,o=[];for(n=0;n<r;n++)o.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:m(i.changedTouches[n]),currentTime:e.now()});G(t,i,o),e.cancelEvent(i)}function I(t,i){i.currentTarget===i.relatedTarget||T(i.currentTarget,i.relatedTarget)||N(t,i,[{id:i.pointerId,type:g(i),isPrimary:i.isPrimary,currentPos:m(i),currentTime:e.now()}])}function O(t,i){i.currentTarget===i.relatedTarget||T(i.currentTarget,i.relatedTarget)||U(t,i,[{id:i.pointerId,type:g(i),isPrimary:i.isPrimary,currentPos:m(i),currentTime:e.now()}])}function z(t,i){var n;W(t,i,[n={id:i.pointerId,type:g(i),isPrimary:i.isPrimary,currentPos:m(i),currentTime:e.now()}],i.button)&&(e.stopEvent(i),d(t,n.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.cancelEvent(i)}function B(e,t){D(e,t)}function D(t,i){var n;V(t,i,[n={id:i.pointerId,type:g(i),isPrimary:i.isPrimary,currentPos:m(i),currentTime:e.now()}],i.button)&&p(t,n.type)}function A(e,t){L(e,t)}function L(t,i){G(t,i,[{id:i.pointerId,type:g(i),isPrimary:i.isPrimary,currentPos:m(i),currentTime:e.now()}])}function M(e,t){!function(e,t,i){V(e,t,i,0),U(e,t,i)}(e,t,[{id:t.pointerId,type:g(t)}])}function H(e,t){return t.hasOwnProperty("isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function F(e,t){var i,n;return e.getById(t.id)?(i=e.removeById(t.id),t.hasOwnProperty("isPrimary")||(n=e.getPrimary())||(n=e.getByIndex(0))&&(n.isPrimary=!0)):i=e.getLength(),i}function N(t,i,n){var r,o,s,a=t.getActivePointersListByType(n[0].type),l=n.length;for(r=0;r<l;r++)o=n[r],(s=a.getById(o.id))?(s.insideElement=!0,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime,o=s):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,H(a,o)),t.enterHandler&&!1===t.enterHandler({eventSource:t,pointerType:o.type,position:v(o.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:o.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)}function U(t,i,n){var r,o,s,a=t.getActivePointersListByType(n[0].type),l=n.length;for(r=0;r<l;r++)o=n[r],(s=a.getById(o.id))&&(s.captured?(s.insideElement=!1,s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):F(a,s),o=s),t.exitHandler&&!1===t.exitHandler({eventSource:t,pointerType:o.type,position:v(o.currentPos,t.element),buttons:a.buttons,pointers:t.getActivePointerCount(),insideElementPressed:!!s&&s.insideElementPressed,buttonDownAny:0!==a.buttons,isTouchEvent:"touch"===o.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)}function W(t,i,n,r){var o,s,a,h=l[t.hash],c=t.getActivePointersListByType(n[0].type),u=n.length;void 0!==i.buttons?c.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===r?c.buttons+=1:1===r?c.buttons+=4:2===r?c.buttons+=2:3===r?c.buttons+=8:4===r?c.buttons+=16:5===r&&(c.buttons+=32):0===r?c.buttons|=1:1===r?c.buttons|=4:2===r?c.buttons|=2:3===r?c.buttons|=8:4===r?c.buttons|=16:5===r&&(c.buttons|=32);var d=t.getActivePointersListsExceptType(n[0].type);for(o=0;o<d.length;o++)R(t,i,d[o]);if(0!==r)return t.nonPrimaryPressHandler&&!1===t.nonPrimaryPressHandler({eventSource:t,pointerType:n[0].type,position:v(n[0].currentPos,t.element),button:r,buttons:c.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),!1;for(o=0;o<u;o++)s=n[o],(a=c.getById(s.id))?(a.captured=!0,a.insideElementPressed=!0,a.insideElement=!0,a.contactPos=s.currentPos,a.contactTime=s.currentTime,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=s.currentPos,a.currentTime=s.currentTime,s=a):(s.captured=!0,s.insideElementPressed=!0,s.insideElement=!0,H(c,s)),c.addContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.addPoint(t,s),1===c.contacts?t.pressHandler&&!1===t.pressHandler({eventSource:t,pointerType:s.type,position:v(s.contactPos,t.element),buttons:c.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i):2===c.contacts&&t.pinchHandler&&"touch"===s.type&&(h.pinchGPoints=c.asArray(),h.lastPinchDist=h.currentPinchDist=h.pinchGPoints[0].currentPos.distanceTo(h.pinchGPoints[1].currentPos),h.lastPinchCenter=h.currentPinchCenter=w(h.pinchGPoints[0].currentPos,h.pinchGPoints[1].currentPos));return!0}function V(t,i,n,r){var o,s,a,h,c,u,d=l[t.hash],p=t.getActivePointersListByType(n[0].type),g=n.length,m=!1,f=!1;if(void 0!==i.buttons?p.buttons=i.buttons:e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?0===r?p.buttons-=1:1===r?p.buttons-=4:2===r?p.buttons-=2:3===r?p.buttons-=8:4===r?p.buttons-=16:5===r&&(p.buttons-=32):0===r?p.buttons^=-2:1===r?p.buttons^=-5:2===r?p.buttons^=-3:3===r?p.buttons^=-9:4===r?p.buttons^=-17:5===r&&(p.buttons^=-33),0!==r)return t.nonPrimaryReleaseHandler&&!1===t.nonPrimaryReleaseHandler({eventSource:t,pointerType:n[0].type,position:v(n[0].currentPos,t.element),button:r,buttons:p.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),R(t,i,t.getActivePointersListByType("mouse")),!1;for(a=0;a<g;a++)h=n[a],(c=p.getById(h.id))&&(c.captured&&(c.captured=!1,m=!0,f=!0),c.lastPos=c.currentPos,c.lastTime=c.currentTime,c.currentPos=h.currentPos,c.currentTime=h.currentTime,c.insideElement||F(p,c),o=c.currentPos,s=c.currentTime,f?(p.removeContact(),(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&e.MouseTracker.gesturePointVelocityTracker.removePoint(t,c),0===p.contacts?(t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:c.type,position:v(o,t.element),buttons:p.buttons,insideElementPressed:c.insideElementPressed,insideElementReleased:c.insideElement,isTouchEvent:"touch"===c.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),t.dragEndHandler&&!c.currentPos.equals(c.contactPos)&&!1===t.dragEndHandler({eventSource:t,pointerType:c.type,position:v(c.currentPos,t.element),speed:c.speed,direction:c.direction,shift:i.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),(t.clickHandler||t.dblClickHandler)&&c.insideElement&&(u=s-c.contactTime<=t.clickTimeThreshold&&c.contactPos.distanceTo(o)<=t.clickDistThreshold,t.clickHandler&&!1===t.clickHandler({eventSource:t,pointerType:c.type,position:v(c.currentPos,t.element),quick:u,shift:i.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),t.dblClickHandler&&u&&(p.clicks++,1===p.clicks?(d.lastClickPos=o,d.dblClickTimeOut=setTimeout(function(){p.clicks=0},t.dblClickTimeThreshold)):2===p.clicks&&(clearTimeout(d.dblClickTimeOut),p.clicks=0,d.lastClickPos.distanceTo(o)<=t.dblClickDistThreshold&&!1===t.dblClickHandler({eventSource:t,pointerType:c.type,position:v(c.currentPos,t.element),shift:i.shiftKey,isTouchEvent:"touch"===c.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i),d.lastClickPos=null)))):2===p.contacts&&t.pinchHandler&&"touch"===c.type&&(d.pinchGPoints=p.asArray(),d.lastPinchDist=d.currentPinchDist=d.pinchGPoints[0].currentPos.distanceTo(d.pinchGPoints[1].currentPos),d.lastPinchCenter=d.currentPinchCenter=w(d.pinchGPoints[0].currentPos,d.pinchGPoints[1].currentPos))):t.releaseHandler&&!1===t.releaseHandler({eventSource:t,pointerType:c.type,position:v(o,t.element),buttons:p.buttons,insideElementPressed:c.insideElementPressed,insideElementReleased:c.insideElement,isTouchEvent:"touch"===c.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i));return m}function G(t,i,n){var r,o,s,a,h,c=l[t.hash],u=t.getActivePointersListByType(n[0].type),d=n.length;for(void 0!==i.buttons&&(u.buttons=i.buttons),r=0;r<d;r++)o=n[r],(s=u.getById(o.id))?(o.hasOwnProperty("isPrimary")&&(s.isPrimary=o.isPrimary),s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=o.currentPos,s.currentTime=o.currentTime):(o.captured=!1,o.insideElementPressed=!1,o.insideElement=!0,H(u,o));t.stopHandler&&"mouse"===n[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout(function(){!function(e,t,i){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:i,position:f(t,e.element),buttons:e.getActivePointersListByType(i).buttons,isTouchEvent:"touch"===i,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}(t,i,n[0].type)},t.stopDelay)),0===u.contacts?t.moveHandler&&!1===t.moveHandler({eventSource:t,pointerType:n[0].type,position:v(n[0].currentPos,t.element),buttons:u.buttons,isTouchEvent:"touch"===n[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i):1===u.contacts?(t.moveHandler&&(s=u.asArray()[0],!1===t.moveHandler({eventSource:t,pointerType:s.type,position:v(s.currentPos,t.element),buttons:u.buttons,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)),t.dragHandler&&(h=(s=u.asArray()[0]).currentPos.minus(s.lastPos),!1===t.dragHandler({eventSource:t,pointerType:s.type,position:v(s.currentPos,t.element),buttons:u.buttons,delta:h,speed:s.speed,direction:s.direction,shift:i.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))):2===u.contacts&&(t.moveHandler&&(a=u.asArray(),!1===t.moveHandler({eventSource:t,pointerType:a[0].type,position:v(w(a[0].currentPos,a[1].currentPos),t.element),buttons:u.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)),t.pinchHandler&&"touch"===n[0].type&&(h=c.pinchGPoints[0].currentPos.distanceTo(c.pinchGPoints[1].currentPos))!=c.currentPinchDist&&(c.lastPinchDist=c.currentPinchDist,c.currentPinchDist=h,c.lastPinchCenter=c.currentPinchCenter,c.currentPinchCenter=w(c.pinchGPoints[0].currentPos,c.pinchGPoints[1].currentPos),!1===t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:c.pinchGPoints,lastCenter:v(c.lastPinchCenter,t.element),center:v(c.currentPinchCenter,t.element),lastDistance:c.lastPinchDist,distance:c.currentPinchDist,shift:i.shiftKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i)))}e.MouseTracker=function(t){a.push(this);var i=arguments;e.isPlainObject(t)||(t={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=e.getElement(t.element),this.clickTimeThreshold=t.clickTimeThreshold||e.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=t.clickDistThreshold||e.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=t.dblClickTimeThreshold||e.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=t.dblClickDistThreshold||e.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=t.userData||null,this.stopDelay=t.stopDelay||50,this.enterHandler=t.enterHandler||null,this.exitHandler=t.exitHandler||null,this.pressHandler=t.pressHandler||null,this.nonPrimaryPressHandler=t.nonPrimaryPressHandler||null,this.releaseHandler=t.releaseHandler||null,this.nonPrimaryReleaseHandler=t.nonPrimaryReleaseHandler||null,this.moveHandler=t.moveHandler||null,this.scrollHandler=t.scrollHandler||null,this.clickHandler=t.clickHandler||null,this.dblClickHandler=t.dblClickHandler||null,this.dragHandler=t.dragHandler||null,this.dragEndHandler=t.dragEndHandler||null,this.pinchHandler=t.pinchHandler||null,this.stopHandler=t.stopHandler||null,this.keyDownHandler=t.keyDownHandler||null,this.keyUpHandler=t.keyUpHandler||null,this.keyHandler=t.keyHandler||null,this.focusHandler=t.focusHandler||null,this.blurHandler=t.blurHandler||null;var n=this;l[this.hash]={click:function(t){!function(t,i){t.clickHandler&&e.cancelEvent(i)}(n,t)},dblclick:function(t){!function(t,i){t.dblClickHandler&&e.cancelEvent(i)}(n,t)},keydown:function(t){!function(t,i){t.keyDownHandler&&(i=e.getEvent(i),t.keyDownHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}(n,t)},keyup:function(t){!function(t,i){t.keyUpHandler&&(i=e.getEvent(i),t.keyUpHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}(n,t)},keypress:function(t){!function(t,i){t.keyHandler&&(i=e.getEvent(i),t.keyHandler({eventSource:t,keyCode:i.keyCode?i.keyCode:i.charCode,ctrl:i.ctrlKey,shift:i.shiftKey,alt:i.altKey,meta:i.metaKey,originalEvent:i,preventDefaultAction:!1,userData:t.userData})||e.cancelEvent(i))}(n,t)},focus:function(t){!function(t,i){t.focusHandler&&(i=e.getEvent(i),!1===t.focusHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}(n,t)},blur:function(t){!function(t,i){t.blurHandler&&(i=e.getEvent(i),!1===t.blurHandler({eventSource:t,originalEvent:i,preventDefaultAction:!1,userData:t.userData})&&e.cancelEvent(i))}(n,t)},wheel:function(e){!function(e,t){_(e,t,t)}(n,e)},mousewheel:function(e){y(n,e)},DOMMouseScroll:function(e){y(n,e)},MozMousePixelScroll:function(e){y(n,e)},mouseenter:function(t){!function(t,i){i=e.getEvent(i),x(t,i)}(n,t)},mouseleave:function(t){!function(t,i){i=e.getEvent(i),S(t,i)}(n,t)},mouseover:function(t){!function(t,i){if((i=e.getEvent(i)).currentTarget===i.relatedTarget||T(i.currentTarget,i.relatedTarget))return;x(t,i)}(n,t)},mouseout:function(t){!function(t,i){if((i=e.getEvent(i)).currentTarget===i.relatedTarget||T(i.currentTarget,i.relatedTarget))return;S(t,i)}(n,t)},mousedown:function(t){!function(t,i){var n;i=e.getEvent(i),n={id:e.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:m(i),currentTime:e.now()},W(t,i,[n],b(i.button))&&(e.stopEvent(i),d(t,"mouse"));(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler)&&e.cancelEvent(i)}(n,t)},mouseup:function(e){!function(e,t){E(e,t)}(n,e)},mouseupcaptured:function(t){!function(t,i){E(t,i),e.stopEvent(i)}(n,t)},mousemove:function(e){!function(e,t){P(e,t)}(n,e)},mousemovecaptured:function(t){!function(t,i){P(t,i),e.stopEvent(i)}(n,t)},touchstart:function(t){!function(t,i){var n,r,o,s,l=i.changedTouches.length,h=[],c=t.getActivePointersListByType("touch");n=e.now(),c.getLength()>i.touches.length-l&&(e.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),R(t,i,c));for(r=0;r<l;r++)h.push({id:i.changedTouches[r].identifier,type:"touch",currentPos:m(i.changedTouches[r]),currentTime:n});for(N(t,i,h),r=0;r<a.length;r++)if(a[r]!==t&&a[r].isTracking()&&T(a[r].element,t.element)){for(s=[],o=0;o<l;o++)s.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:m(i.changedTouches[o]),currentTime:n});N(a[r],i,s)}W(t,i,h,0)&&(e.stopEvent(i),d(t,"touch",l));e.cancelEvent(i)}(n,t)},touchend:function(e){!function(e,t){C(e,t)}(n,e)},touchendcaptured:function(t){!function(t,i){C(t,i),e.stopEvent(i)}(n,t)},touchmove:function(e){!function(e,t){k(e,t)}(n,e)},touchmovecaptured:function(t){!function(t,i){k(t,i),e.stopEvent(i)}(n,t)},touchcancel:function(e){!function(e,t){var i=e.getActivePointersListByType("touch");R(e,t,i)}(n,e)},gesturestart:function(e){!function(e,t){t.stopPropagation(),t.preventDefault()}(0,e)},gesturechange:function(e){!function(e,t){t.stopPropagation(),t.preventDefault()}(0,e)},pointerover:function(e){I(n,e)},MSPointerOver:function(e){I(n,e)},pointerout:function(e){O(n,e)},MSPointerOut:function(e){O(n,e)},pointerdown:function(e){z(n,e)},MSPointerDown:function(e){z(n,e)},pointerup:function(e){B(n,e)},MSPointerUp:function(e){B(n,e)},pointermove:function(e){A(n,e)},MSPointerMove:function(e){A(n,e)},pointercancel:function(e){M(n,e)},MSPointerCancel:function(e){M(n,e)},pointerupcaptured:function(t){!function(t,i){t.getActivePointersListByType(g(i)).getById(i.pointerId)&&D(t,i);e.stopEvent(i)}(n,t)},pointermovecaptured:function(t){!function(t,i){t.getActivePointersListByType(g(i)).getById(i.pointerId)&&L(t,i);e.stopEvent(i)}(n,t)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},t.startDisabled||this.setTracking(!0)},e.MouseTracker.prototype={destroy:function(){var e;for(c(this),this.element=null,e=0;e<a.length;e++)if(a[e]===this){a.splice(e,1);break}l[this.hash]=null,delete l[this.hash]},isTracking:function(){return l[this.hash].tracking},setTracking:function(t){return t?function(t){var i,n,r=l[t.hash];if(!r.tracking){for(n=0;n<e.MouseTracker.subscribeEvents.length;n++)i=e.MouseTracker.subscribeEvents[n],e.addEvent(t.element,i,r[i],!1);h(t),r.tracking=!0}}(this):c(this),this},getActivePointersListsExceptType:function(e){for(var t=l[this.hash],i=[],n=0;n<t.activePointersLists.length;++n)t.activePointersLists[n].type!==e&&i.push(t.activePointersLists[n]);return i},getActivePointersListByType:function(t){var i,n,r=l[this.hash],o=r.activePointersLists.length;for(i=0;i<o;i++)if(r.activePointersLists[i].type===t)return r.activePointersLists[i];return n=new e.MouseTracker.GesturePointList(t),r.activePointersLists.push(n),n},getActivePointerCount:function(){var e,t=l[this.hash],i=t.activePointersLists.length,n=0;for(e=0;e<i;e++)n+=t.activePointersLists[e].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},e.MouseTracker.resetAllMouseTrackers=function(){for(var e=0;e<a.length;e++)a[e].isTracking()&&(a[e].setTracking(!1),a[e].setTracking(!0))},e.MouseTracker.gesturePointVelocityTracker=(t=[],i=0,n=0,r=function(e,t){return e.hash.toString()+t.type+t.id.toString()},o=function(){var i,r,o,s,a,l,h=t.length,c=e.now();for(s=c-n,n=c,i=0;i<h;i++)(o=(r=t[i]).gPoint).direction=Math.atan2(o.currentPos.y-r.lastPos.y,o.currentPos.x-r.lastPos.x),a=r.lastPos.distanceTo(o.currentPos),r.lastPos=o.currentPos,l=1e3*a/(s+1),o.speed=.75*l+.25*o.speed},{addPoint:function(s,a){var l=r(s,a);t.push({guid:l,gPoint:a,lastPos:a.currentPos}),1===t.length&&(n=e.now(),i=window.setInterval(o,50))},removePoint:function(e,n){var o,s=r(e,n),a=t.length;for(o=0;o<a;o++)if(t[o].guid===s){t.splice(o,1),0==--a&&window.clearInterval(i);break}}}),e.MouseTracker.captureElement=document,e.MouseTracker.wheelEventName=e.Browser.vendor==e.BROWSERS.IE&&e.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",e.MouseTracker.supportsMouseCapture=(s=document.createElement("div"),e.isFunction(s.setCapture)&&e.isFunction(s.releaseCapture)),e.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",e.MouseTracker.wheelEventName],"DOMMouseScroll"==e.MouseTracker.wheelEventName&&e.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||e.Browser.vendor!==e.BROWSERS.IE)?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),e.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(e.MouseTracker.havePointerEvents=!0,e.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),e.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?e.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:e.MouseTracker.maxTouchPoints=0,e.MouseTracker.haveMouseEnter=!1):(e.MouseTracker.havePointerEvents=!1,e.Browser.vendor===e.BROWSERS.IE&&e.Browser.version<9?(e.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),e.MouseTracker.haveMouseEnter=!0):(e.MouseTracker.subscribeEvents.push("mouseover","mouseout"),e.MouseTracker.haveMouseEnter=!1),e.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&e.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&e.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),e.MouseTracker.mousePointerId="legacy-mouse",e.MouseTracker.maxTouchPoints=10),e.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},e.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(e){var t,i=this._gPoints.length;for(t=0;t<i;t++)if(this._gPoints[t].isPrimary)return this._gPoints[t];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var j=function(){try{return window.self!==window.top}catch(e){return!0}}();function q(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return!1}}}(OpenSeadragon),function(e){e.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},e.Control=function(t,i,n){var r=t.parentNode;"number"==typeof i&&(e.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),i={anchor:i}),i.attachToViewer=void 0===i.attachToViewer||i.attachToViewer,this.autoFade=void 0===i.autoFade||i.autoFade,this.element=t,this.anchor=i.anchor,this.container=n,this.anchor==e.ControlAnchor.ABSOLUTE?(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof i.top?i.top+"px":i.top,this.wrapper.style.left="number"==typeof i.left?i.left+"px":i.left,this.wrapper.style.height="number"==typeof i.height?i.height+"px":i.height,this.wrapper.style.width="number"==typeof i.width?i.width+"px":i.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=e.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==e.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),i.attachToViewer?this.anchor==e.ControlAnchor.TOP_RIGHT||this.anchor==e.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):r.appendChild(this.wrapper)},e.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(t){this.wrapper.style.display=t?this.anchor==e.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(t){this.element[e.SIGNAL]&&e.Browser.vendor==e.BROWSERS.IE?e.setElementOpacity(this.element,t,!0):e.setElementOpacity(this.wrapper,t,!0)}}}(OpenSeadragon),function(e){function t(e,t){var i,n=e.controls;for(i=n.length-1;i>=0;i--)if(n[i].element==t)return i;return-1}e.ControlDock=function(t){var i,n,r=["topleft","topright","bottomright","bottomleft"];for(e.extend(!0,this,{id:"controldock-"+e.now()+"-"+Math.floor(1e6*Math.random()),container:e.makeNeutralElement("div"),controls:[]},t),this.container.onsubmit=function(){return!1},this.element&&(this.element=e.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),n=0;n<r.length;n++)i=r[n],this.controls[i]=e.makeNeutralElement("div"),this.controls[i].style.position="absolute",i.match("left")&&(this.controls[i].style.left="0px"),i.match("right")&&(this.controls[i].style.right="0px"),i.match("top")&&(this.controls[i].style.top="0px"),i.match("bottom")&&(this.controls[i].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},e.ControlDock.prototype={addControl:function(i,n){var r=null;if(!(t(this,i=e.getElement(i))>=0)){switch(n.anchor){case e.ControlAnchor.TOP_RIGHT:r=this.controls.topright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.BOTTOM_RIGHT:r=this.controls.bottomright,i.style.position="relative",i.style.paddingRight="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.BOTTOM_LEFT:r=this.controls.bottomleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingBottom="0px";break;case e.ControlAnchor.TOP_LEFT:r=this.controls.topleft,i.style.position="relative",i.style.paddingLeft="0px",i.style.paddingTop="0px";break;case e.ControlAnchor.ABSOLUTE:r=this.container,i.style.margin="0px",i.style.padding="0px";break;default:case e.ControlAnchor.NONE:r=this.container,i.style.margin="0px",i.style.padding="0px"}this.controls.push(new e.Control(i,n,r)),i.style.display="inline-block"}},removeControl:function(i){var n=t(this,i=e.getElement(i));return n>=0&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;e>=0;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;t>=0;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(e){var t={},i=1;function n(t){return t=e.getElement(t),new e.Point(0===t.clientWidth?1:t.clientWidth,0===t.clientHeight?1:t.clientHeight)}function r(t,i){if(i instanceof e.Overlay)return i;var n=null;if(i.element)n=e.getElement(i.element);else{var r=i.id?i.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(n=e.getElement(i.id))||((n=document.createElement("a")).href="#/overlay/"+r),n.id=r,e.addClass(n,i.className?i.className:"openseadragon-overlay")}var o=i.location,s=i.width,a=i.height;if(!o){var l=i.x,h=i.y;if(void 0!==i.px){var c=t.viewport.imageToViewportRectangle(new e.Rect(i.px,i.py,s||0,a||0));l=c.x,h=c.y,s=void 0!==s?c.width:void 0,a=void 0!==a?c.height:void 0}o=new e.Point(l,h)}var u=i.placement;return u&&"string"===e.type(u)&&(u=e.Placement[i.placement.toUpperCase()]),new e.Overlay({element:n,location:o,placement:u,onDraw:i.onDraw,checkResize:i.checkResize,width:s,height:a,rotationMode:i.rotationMode})}function o(e,t){var i;for(i=e.length-1;i>=0;i--)if(e[i].element===t)return i;return-1}function s(t,i){return e.requestAnimationFrame(function(){i(t)})}function a(t){e.requestAnimationFrame(function(){!function(t){var i,n,r,o;if(t.controlsShouldFade){for(i=e.now(),n=i-t.controlsFadeBeginTime,r=1-n/t.controlsFadeLength,r=Math.min(1,r),r=Math.max(0,r),o=t.controls.length-1;o>=0;o--)t.controls[o].autoFade&&t.controls[o].setOpacity(r);r>0&&a(t)}}(t)})}function l(t){t.autoHideControls&&(t.controlsShouldFade=!0,t.controlsFadeBeginTime=e.now()+t.controlsFadeDelay,window.setTimeout(function(){a(t)},t.controlsFadeDelay))}function h(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;t>=0;t--)e.controls[t].setOpacity(1)}function c(){h(this)}function u(){l(this)}function d(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 38:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function p(t){var i={originalEvent:t.originalEvent,preventDefaultAction:t.preventDefaultAction,preventVerticalPan:t.preventVerticalPan,preventHorizontalPan:t.preventHorizontalPan};if(this.raiseEvent("canvas-key",i),i.preventDefaultAction||t.ctrl||t.alt||t.meta)return!0;switch(t.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return i.preventVerticalPan||(t.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return i.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new e.Point(40,0))),this.viewport.applyConstraints()),!1;default:return!0}}function g(e){var t;document.activeElement==this.canvas||this.canvas.focus();var i={tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-click",i),!i.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType)).clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function m(e){var t,i={tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};this.raiseEvent("canvas-double-click",i),!i.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,t.zoomToRefPoint?this.viewport.pointFromPixel(e.position,!0):null),this.viewport.applyConstraints())}function f(e){var t,i={tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent,preventDefaultAction:e.preventDefaultAction};if(this.raiseEvent("canvas-drag",i),!i.preventDefaultAction&&this.viewport){if(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.constrainDuringPan){var n=this.viewport.deltaPointsFromPixels(e.delta.negate());this.viewport.centerSpringX.target.value+=n.x,this.viewport.centerSpringY.target.value+=n.y;var r=this.viewport.getBounds(),o=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=n.x,this.viewport.centerSpringY.target.value-=n.y,r.x!=o.x&&(e.delta.x=0),r.y!=o.y&&(e.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled&&!this.constrainDuringPan)}}function v(t){if(!t.preventDefaultAction&&this.viewport){var i=this.gestureSettingsByDeviceType(t.pointerType);if(i.flickEnabled&&t.speed>=i.flickMinSpeed){var n=0;this.panHorizontal&&(n=i.flickMomentum*t.speed*Math.cos(t.direction));var r=0;this.panVertical&&(r=i.flickMomentum*t.speed*Math.sin(t.direction));var o=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),s=this.viewport.pointFromPixel(new e.Point(o.x-n,o.y-r));this.viewport.panTo(s,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:t.eventSource,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent})}function w(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function y(t){window.location!=window.parent.location&&e.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:t.eventSource,pointerType:t.pointerType,position:t.position,buttons:t.buttons,pointers:t.pointers,insideElementPressed:t.insideElementPressed,buttonDownAny:t.buttonDownAny,originalEvent:t.originalEvent})}function _(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function T(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function x(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function S(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function b(e){var t,i,n;if(!e.preventDefaultAction&&this.viewport&&((t=this.gestureSettingsByDeviceType(e.pointerType)).pinchToZoom&&(i=this.viewport.pointFromPixel(e.center,!0),n=this.viewport.pointFromPixel(e.lastCenter,!0).minus(i),this.panHorizontal||(n.x=0),this.panVertical||(n.y=0),this.viewport.zoomBy(e.distance/e.lastDistance,i,!0),t.zoomToRefPoint&&this.viewport.panBy(n,!0),this.viewport.applyConstraints()),t.pinchRotate)){var r=Math.atan2(e.gesturePoints[0].currentPos.y-e.gesturePoints[1].currentPos.y,e.gesturePoints[0].currentPos.x-e.gesturePoints[1].currentPos.x),o=Math.atan2(e.gesturePoints[0].lastPos.y-e.gesturePoints[1].lastPos.y,e.gesturePoints[0].lastPos.x-e.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(r-o)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:e.eventSource,gesturePoints:e.gesturePoints,lastCenter:e.lastCenter,center:e.center,lastDistance:e.lastDistance,distance:e.distance,shift:e.shift,originalEvent:e.originalEvent}),!1}function E(t){var i,n,r;if((r=e.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=r,!t.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(t.pointerType)).scrollToZoom&&(n=Math.pow(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(n,i.zoomToRefPoint?this.viewport.pointFromPixel(t.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),i&&i.scrollToZoom)return!1}else if((i=this.gestureSettingsByDeviceType(t.pointerType))&&i.scrollToZoom)return!1}function P(e){t[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function R(e){e.pointers<1&&(t[this.hash].mouseInside=!1,t[this.hash].animating||l(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function C(e){!function(e){if(e._opening)return;if(e.autoResize){var i=n(e.container),r=t[e.hash].prevContainerSize;if(!i.equals(r)){var o=e.viewport;if(e.preserveImageSizeOnResize){var s=r.x/i.x,a=o.getZoom()*s,c=o.getCenter();o.resize(i,!1),o.zoomTo(a,null,!0),o.panTo(c,!0)}else{var u=o.getBounds();o.resize(i,!0),o.fitBoundsWithConstraints(u,!0)}t[e.hash].prevContainerSize=i,t[e.hash].forceRedraw=!0}}var d=e.viewport.update(),p=e.world.update()||d;d&&e.raiseEvent("viewport-change");e.referenceStrip&&(p=e.referenceStrip.update(e.viewport)||p);!t[e.hash].animating&&p&&(e.raiseEvent("animation-start"),h(e));(p||t[e.hash].forceRedraw||e.world.needsDraw())&&(!function(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}(e),e._drawOverlays(),e.navigator&&e.navigator.update(e.viewport),t[e.hash].forceRedraw=!1,p&&e.raiseEvent("animation"));t[e.hash].animating&&!p&&(e.raiseEvent("animation-finish"),t[e.hash].mouseInside||l(e));t[e.hash].animating=p}(e),e.isOpen()?e._updateRequestId=s(e,C):e._updateRequestId=!1}function k(e,t){return e?e+t:t}function I(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=this.zoomPerSecond,t[this.hash].zooming=!0,B(this)}function O(){t[this.hash].lastZoomTime=e.now(),t[this.hash].zoomFactor=1/this.zoomPerSecond,t[this.hash].zooming=!0,B(this)}function z(){t[this.hash].zooming=!1}function B(t){e.requestAnimationFrame(e.delegate(t,D))}function D(){var i,n,r;t[this.hash].zooming&&this.viewport&&(n=(i=e.now())-t[this.hash].lastZoomTime,r=Math.pow(t[this.hash].zoomFactor,n/1e3),this.viewport.zoomBy(r),this.viewport.applyConstraints(),t[this.hash].lastZoomTime=i,B(this))}function A(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function L(){this.viewport&&(t[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function M(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function H(){this.viewport&&this.viewport.goHome()}function F(){this.isFullPage()&&!e.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function N(){if(this.viewport){var e=this.viewport.getRotation();0===e?e=270:e-=90,this.viewport.setRotation(e)}}function U(){if(this.viewport){var e=this.viewport.getRotation();270===e?e=0:e+=90,this.viewport.setRotation(e)}}function W(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&e<0&&(e+=this.tileSources.length),this.goToPage(e)}function V(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}e.Viewer=function(r){var o,a,h=arguments,c=this;if(e.isPlainObject(r)||(r={id:h[0],xmlPath:h.length>1?h[1]:void 0,prefixUrl:h.length>2?h[2]:void 0,controls:h.length>3?h[3]:void 0,overlays:h.length>4?h[4]:void 0}),r.config&&(e.extend(!0,r,r.config),delete r.config),e.extend(!0,this,{id:r.id,hash:r.hash||i++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},e.DEFAULT_SETTINGS,r),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==t[this.hash]&&e.console.warn("Hash "+this.hash+" has already been used."),t[this.hash]={fsBoundsDelta:new e.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=e.now(),e.EventSource.call(this),this.addHandler("open-failed",function(t){var i=e.getString("Errors.OpenFailed",t.eventSource,t.message);c._showMessage(i)}),e.ControlDock.call(this,r),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=e.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",(a=this.canvas.style).width="100%",a.height="100%",a.overflow="hidden",a.position="absolute",a.top="0px",a.left="0px",e.setElementTouchActionNone(this.canvas),""!==r.tabIndex&&(this.canvas.tabIndex=void 0===r.tabIndex?0:r.tabIndex),this.container.className="openseadragon-container",function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new e.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:e.delegate(this,d),keyHandler:e.delegate(this,p),clickHandler:e.delegate(this,g),dblClickHandler:e.delegate(this,m),dragHandler:e.delegate(this,f),dragEndHandler:e.delegate(this,v),enterHandler:e.delegate(this,w),exitHandler:e.delegate(this,y),pressHandler:e.delegate(this,_),releaseHandler:e.delegate(this,T),nonPrimaryPressHandler:e.delegate(this,x),nonPrimaryReleaseHandler:e.delegate(this,S),scrollHandler:e.delegate(this,E),pinchHandler:e.delegate(this,b)}),this.outerTracker=new e.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:e.delegate(this,P),exitHandler:e.delegate(this,R)}),this.toolbar&&(this.toolbar=new e.ControlDock({element:this.toolbar})),this.bindStandardControls(),t[this.hash].prevContainerSize=n(this.container),this.world=new e.World({viewer:this}),this.world.addHandler("add-item",function(e){c.source=c.world.getItemAt(0).source,t[c.hash].forceRedraw=!0,c._updateRequestId||(c._updateRequestId=s(c,C))}),this.world.addHandler("remove-item",function(e){c.world.getItemCount()?c.source=c.world.getItemAt(0).source:c.source=null,t[c.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(e){c.viewport&&c.viewport._setContentBounds(c.world.getHomeBounds(),c.world.getContentFactor())}),this.world.addHandler("item-index-change",function(e){c.source=c.world.getItemAt(0).source}),this.viewport=new e.Viewport({containerSize:t[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new e.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:r.timeout}),this.tileCache=new e.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new e.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=e.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(o=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(o,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(o=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(o,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new e.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),o=0;o<this.customControls.length;o++)this.addControl(this.customControls[o].id,{anchor:this.customControls[o].anchor});e.requestAnimationFrame(function(){l(c)})},e.extend(e.Viewer.prototype,e.EventSource.prototype,e.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(t){return e.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(t)},openTileSource:function(t){return e.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(t)},open:function(t,i){var n=this;if(this.close(),t){if(this.sequenceMode&&e.isArray(t))return this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===i||isNaN(i)||(this.initialPage=i),this.tileSources=t,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),void this._updateSequenceButtons(this._sequenceIndex);if(e.isArray(t)||(t=[t]),t.length){this._opening=!0;for(var o,s=t.length,a=0,l=0,h=function(){if(a+l===s)if(a){!n._firstOpen&&n.preserveViewport||(n.viewport.goHome(!0),n.viewport.update()),n._firstOpen=!1;var e=t[0];if(e.tileSource&&(e=e.tileSource),n.overlays&&!n.preserveOverlays)for(var i=0;i<n.overlays.length;i++)n.currentOverlays[i]=r(n,n.overlays[i]);n._drawOverlays(),n._opening=!1,n.raiseEvent("open",{source:e})}else n._opening=!1,n.raiseEvent("open-failed",o)},c=function(t){e.isPlainObject(t)&&t.tileSource||(t={tileSource:t}),void 0!==t.index&&(e.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var i=t.success;t.success=function(e){if(a++,t.tileSource.overlays)for(var r=0;r<t.tileSource.overlays.length;r++)n.addOverlay(t.tileSource.overlays[r]);i&&i(e),h()};var r=t.error;t.error=function(e){l++,o||(o=e),r&&r(e),h()},n.addTiledImage(t)},u=0;u<t.length;u++)c(t[u]);return this}}},close:function(){return t[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),t[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(t[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(e.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),t[this.hash]=null,delete t[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisibile();return t},setControlsEnabled:function(e){return e?h(this):l(this),this.raiseEvent("controls-enabled",{enabled:e}),this},setDebugMode:function(e){for(var t=0;t<this.world.getItemCount();t++)this.world.getItemAt(t).debugMode=e;this.debugMode=e,this.forceRedraw()},isFullPage:function(){return t[this.hash].fullPage},setFullPage:function(i){var n,r,o=document.body,s=o.style,a=document.documentElement.style,l=this;if(i==this.isFullPage())return this;var h={fullPage:i,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",h),h.preventDefaultAction)return this;if(i){for(this.elementSize=e.getElementSize(this.element),this.pageScroll=e.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=s.margin,this.docMargin=a.margin,s.margin="0",a.margin="0",this.bodyPadding=s.padding,this.docPadding=a.padding,s.padding="0",a.padding="0",this.bodyWidth=s.width,this.docWidth=a.width,s.width="100%",a.width="100%",this.bodyHeight=s.height,this.docHeight=a.height,s.height="100%",a.height="100%",this.previousBody=[],t[this.hash].prevElementParent=this.element.parentNode,t[this.hash].prevNextSibling=this.element.nextSibling,t[this.hash].prevElementWidth=this.element.style.width,t[this.hash].prevElementHeight=this.element.style.height,n=o.childNodes.length,r=0;r<n;r++)this.previousBody.push(o.childNodes[0]),o.removeChild(o.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,o.appendChild(this.toolbar.element),e.addClass(this.toolbar.element,"fullpage")),e.addClass(this.element,"fullpage"),o.appendChild(this.element),this.element.style.height=e.getWindowSize().y+"px",this.element.style.width=e.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=e.getElementSize(this.element).y-e.getElementSize(this.toolbar.element).y+"px"),t[this.hash].fullPage=!0,e.delegate(this,P)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,s.margin=this.bodyMargin,a.margin=this.docMargin,s.padding=this.bodyPadding,a.padding=this.docPadding,s.width=this.bodyWidth,a.width=this.docWidth,s.height=this.bodyHeight,a.height=this.docHeight,o.removeChild(this.element),n=this.previousBody.length,r=0;r<n;r++)o.appendChild(this.previousBody.shift());e.removeClass(this.element,"fullpage"),t[this.hash].prevElementParent.insertBefore(this.element,t[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(o.removeChild(this.toolbar.element),e.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=t[this.hash].prevElementWidth,this.element.style.height=t[this.hash].prevElementHeight;var c=0,u=function(){e.setPageScroll(l.pageScroll);var t=e.getPageScroll();++c<10&&(t.x!==l.pageScroll.x||t.y!==l.pageScroll.y)&&e.requestAnimationFrame(u)};e.requestAnimationFrame(u),t[this.hash].fullPage=!1,e.delegate(this,R)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:i}),this},setFullScreen:function(t){var i=this;if(!e.supportsFullScreen)return this.setFullPage(t);if(e.isFullScreen()===t)return this;var n={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var r=function(){var t=e.isFullScreen();t||(e.removeEvent(document,e.fullScreenEventName,r),e.removeEvent(document,e.fullScreenErrorEventName,r),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&i.navigator.update(i.viewport),i.raiseEvent("full-screen",{fullScreen:t})};e.addEvent(document,e.fullScreenEventName,r),e.addEvent(document,e.fullScreenErrorEventName,r),e.requestFullScreen(document.body)}else e.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){e.console.assert(t,"[Viewer.addTiledImage] options is required"),e.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),e.console.assert(!t.replace||t.index>-1&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var i=this;t.replace&&(t.replaceItem=i.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.preload&&(t.preload=this.preload),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation),void 0===t.crossOriginPolicy&&(t.crossOriginPolicy=void 0!==t.tileSource.crossOriginPolicy?t.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===t.ajaxWithCredentials&&(t.ajaxWithCredentials=this.ajaxWithCredentials),void 0===t.loadTilesWithAjax&&(t.loadTilesWithAjax=this.loadTilesWithAjax),void 0===t.ajaxHeaders||null===t.ajaxHeaders?t.ajaxHeaders=this.ajaxHeaders:e.isPlainObject(t.ajaxHeaders)&&e.isPlainObject(this.ajaxHeaders)&&(t.ajaxHeaders=e.extend({},this.ajaxHeaders,t.ajaxHeaders));var n={options:t};function r(e){for(var r=0;r<i._loadQueue.length;r++)if(i._loadQueue[r]===n){i._loadQueue.splice(r,1);break}0===i._loadQueue.length&&o(n),i.raiseEvent("add-item-failed",e),t.error&&t.error(e)}function o(e){i.collectionMode&&(i.world.arrange({immediately:e.options.collectionImmediately,rows:i.collectionRows,columns:i.collectionColumns,layout:i.collectionLayout,tileSize:i.collectionTileSize,tileMargin:i.collectionTileMargin}),i.world.setAutoRefigureSizes(!0))}function s(){for(var t,n,r;i._loadQueue.length&&(t=i._loadQueue[0]).tileSource;){if(i._loadQueue.splice(0,1),t.options.replace){var s=i.world.getIndexOfItem(t.options.replaceItem);-1!=s&&(t.options.index=s),i.world.removeItem(t.options.replaceItem)}n=new e.TiledImage({viewer:i,source:t.tileSource,viewport:i.viewport,drawer:i.drawer,tileCache:i.tileCache,imageLoader:i.imageLoader,x:t.options.x,y:t.options.y,width:t.options.width,height:t.options.height,fitBounds:t.options.fitBounds,fitBoundsPlacement:t.options.fitBoundsPlacement,clip:t.options.clip,placeholderFillStyle:t.options.placeholderFillStyle,opacity:t.options.opacity,preload:t.options.preload,degrees:t.options.degrees,compositeOperation:t.options.compositeOperation,springStiffness:i.springStiffness,animationTime:i.animationTime,minZoomImageRatio:i.minZoomImageRatio,wrapHorizontal:i.wrapHorizontal,wrapVertical:i.wrapVertical,immediateRender:i.immediateRender,blendTime:i.blendTime,alwaysBlend:i.alwaysBlend,minPixelRatio:i.minPixelRatio,smoothTileEdgesMinZoom:i.smoothTileEdgesMinZoom,iOSDevice:i.iOSDevice,crossOriginPolicy:t.options.crossOriginPolicy,ajaxWithCredentials:t.options.ajaxWithCredentials,loadTilesWithAjax:t.options.loadTilesWithAjax,ajaxHeaders:t.options.ajaxHeaders,debugMode:i.debugMode}),i.collectionMode&&i.world.setAutoRefigureSizes(!1),i.world.addItem(n,{index:t.options.index}),0===i._loadQueue.length&&o(t),1!==i.world.getItemCount()||i.preserveViewport||i.viewport.goHome(!0),i.navigator&&(r=e.extend({},t.options,{replace:!1,originalTiledImage:n,tileSource:t.tileSource}),i.navigator.addTiledImage(r)),t.options.success&&t.options.success({item:n})}}e.isArray(t.tileSource)?setTimeout(function(){r({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})}):(this._loadQueue.push(n),function(t,i,n,r,o){var s=t;if("string"==e.type(i))if(i.match(/^\s*<.*>\s*$/))i=e.parseXml(i);else if(i.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var a=e.parseJSON(i);i=a}catch(e){}function l(e,t){e.ready?r(e):(e.addHandler("ready",function(){r(e)}),e.addHandler("open-failed",function(e){o({message:e.message,source:t})}))}setTimeout(function(){if("string"==e.type(i))(i=new e.TileSource({url:i,crossOriginPolicy:void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,ajaxHeaders:t.ajaxHeaders,useCanvas:t.useCanvas,success:function(e){r(e.tileSource)}})).addHandler("open-failed",function(e){o(e)});else if(e.isPlainObject(i)||i.nodeType)if(void 0!==i.crossOriginPolicy||void 0===n.crossOriginPolicy&&void 0===t.crossOriginPolicy||(i.crossOriginPolicy=void 0!==n.crossOriginPolicy?n.crossOriginPolicy:t.crossOriginPolicy),void 0===i.ajaxWithCredentials&&(i.ajaxWithCredentials=t.ajaxWithCredentials),void 0===i.useCanvas&&(i.useCanvas=t.useCanvas),e.isFunction(i.getTileUrl)){var a=new e.TileSource(i);a.getTileUrl=i.getTileUrl,r(a)}else{var h=e.TileSource.determineType(s,i);if(!h)return void o({message:"Unable to load TileSource",source:i});var c=h.prototype.configure.apply(s,[i]);l(new h(c),i)}else l(i,i)})}(this,t.tileSource,t,function(e){n.tileSource=e,s()},function(e){e.options=t,r(e),s()}))},addSimpleImage:function(t){e.console.assert(t,"[Viewer.addSimpleImage] options is required"),e.console.assert(t.url,"[Viewer.addSimpleImage] options.url is required");var i=e.extend({},t,{tileSource:{type:"image",url:t.url}});delete i.url,this.addTiledImage(i)},addLayer:function(t){var i=this;e.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var n=e.extend({},t,{success:function(e){i.raiseEvent("add-layer",{options:t,drawer:e.item})},error:function(e){i.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(n),this},getLayerAtLevel:function(t){return e.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(t)},getLevelOfLayer:function(t){return e.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(t)},getLayersCount:function(){return e.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(t,i){return e.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(t,i)},removeLayer:function(t){return e.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(t)},forceRedraw:function(){return t[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=e.delegate(this,c),i=e.delegate(this,u),n=e.delegate(this,V),r=e.delegate(this,W),o=this.navImages,s=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(s=!1),this.previousButton=new e.Button({element:this.previousButton?e.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.PreviousPage"),srcRest:k(this.prefixUrl,o.previous.REST),srcGroup:k(this.prefixUrl,o.previous.GROUP),srcHover:k(this.prefixUrl,o.previous.HOVER),srcDown:k(this.prefixUrl,o.previous.DOWN),onRelease:r,onFocus:t,onBlur:i}),this.nextButton=new e.Button({element:this.nextButton?e.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.NextPage"),srcRest:k(this.prefixUrl,o.next.REST),srcGroup:k(this.prefixUrl,o.next.GROUP),srcHover:k(this.prefixUrl,o.next.HOVER),srcDown:k(this.prefixUrl,o.next.DOWN),onRelease:n,onFocus:t,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),s&&(this.paging=new e.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:e.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=e.delegate(this,I),i=e.delegate(this,z),n=e.delegate(this,A),r=e.delegate(this,O),o=e.delegate(this,L),s=e.delegate(this,H),a=e.delegate(this,F),l=e.delegate(this,N),h=e.delegate(this,U),d=e.delegate(this,c),p=e.delegate(this,u),g=this.navImages,m=[],f=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(f=!1),this.showZoomControl&&(m.push(this.zoomInButton=new e.Button({element:this.zoomInButton?e.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomIn"),srcRest:k(this.prefixUrl,g.zoomIn.REST),srcGroup:k(this.prefixUrl,g.zoomIn.GROUP),srcHover:k(this.prefixUrl,g.zoomIn.HOVER),srcDown:k(this.prefixUrl,g.zoomIn.DOWN),onPress:t,onRelease:i,onClick:n,onEnter:t,onExit:i,onFocus:d,onBlur:p})),m.push(this.zoomOutButton=new e.Button({element:this.zoomOutButton?e.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.ZoomOut"),srcRest:k(this.prefixUrl,g.zoomOut.REST),srcGroup:k(this.prefixUrl,g.zoomOut.GROUP),srcHover:k(this.prefixUrl,g.zoomOut.HOVER),srcDown:k(this.prefixUrl,g.zoomOut.DOWN),onPress:r,onRelease:i,onClick:o,onEnter:r,onExit:i,onFocus:d,onBlur:p}))),this.showHomeControl&&m.push(this.homeButton=new e.Button({element:this.homeButton?e.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.Home"),srcRest:k(this.prefixUrl,g.home.REST),srcGroup:k(this.prefixUrl,g.home.GROUP),srcHover:k(this.prefixUrl,g.home.HOVER),srcDown:k(this.prefixUrl,g.home.DOWN),onRelease:s,onFocus:d,onBlur:p})),this.showFullPageControl&&m.push(this.fullPageButton=new e.Button({element:this.fullPageButton?e.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.FullPage"),srcRest:k(this.prefixUrl,g.fullpage.REST),srcGroup:k(this.prefixUrl,g.fullpage.GROUP),srcHover:k(this.prefixUrl,g.fullpage.HOVER),srcDown:k(this.prefixUrl,g.fullpage.DOWN),onRelease:a,onFocus:d,onBlur:p})),this.showRotationControl&&(m.push(this.rotateLeftButton=new e.Button({element:this.rotateLeftButton?e.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateLeft"),srcRest:k(this.prefixUrl,g.rotateleft.REST),srcGroup:k(this.prefixUrl,g.rotateleft.GROUP),srcHover:k(this.prefixUrl,g.rotateleft.HOVER),srcDown:k(this.prefixUrl,g.rotateleft.DOWN),onRelease:l,onFocus:d,onBlur:p})),m.push(this.rotateRightButton=new e.Button({element:this.rotateRightButton?e.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:e.getString("Tooltips.RotateRight"),srcRest:k(this.prefixUrl,g.rotateright.REST),srcGroup:k(this.prefixUrl,g.rotateright.GROUP),srcHover:k(this.prefixUrl,g.rotateright.HOVER),srcDown:k(this.prefixUrl,g.rotateright.DOWN),onRelease:h,onFocus:d,onBlur:p}))),f&&(this.buttons=new e.ButtonGroup({buttons:m,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",e.delegate(this,M)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||e.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&e>=0&&e<this.tileSources.length&&(this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e),this.raiseEvent("page",{page:e})),this},addOverlay:function(t,i,n,s){var a;if(a=e.isPlainObject(t)?t:{element:t,location:i,placement:n,onDraw:s},t=e.getElement(a.element),o(this.currentOverlays,t)>=0)return this;var l=r(this,a);return this.currentOverlays.push(l),l.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:t,location:a.location,placement:a.placement}),this},updateOverlay:function(i,n,r){var s;return i=e.getElement(i),(s=o(this.currentOverlays,i))>=0&&(this.currentOverlays[s].update(n,r),t[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:i,location:n,placement:r})),this},removeOverlay:function(i){var n;return i=e.getElement(i),(n=o(this.currentOverlays,i))>=0&&(this.currentOverlays[n].destroy(),this.currentOverlays.splice(n,1),t[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:i})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return t[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(t){var i;return t=e.getElement(t),(i=o(this.currentOverlays,t))>=0?this.currentOverlays[i]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(e>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(t){this._hideMessage();var i=e.makeNeutralElement("div");i.appendChild(document.createTextNode(t)),this.messageDiv=e.makeCenteredNode(i),e.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){switch(e){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;e<t;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new e.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else e.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(e){function t(e){e.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(e.position)),this.viewer.viewport.applyConstraints())}function i(e){this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function r(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function o(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}e.Navigator=function(s){var a,l,h,c,u=s.viewer,d=this;function p(e){o(d.displayRegionContainer,e),o(d.displayRegion,-e),d.viewport.setRotation(e)}(s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:e.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+e.now(),this.element=e.makeNeutralElement("div"),s.controlOptions={anchor:e.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:s.autoFade},s.position&&("BOTTOM_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==s.position?s.controlOptions.anchor=e.ControlAnchor.TOP_LEFT:"ABSOLUTE"==s.position&&(s.controlOptions.anchor=e.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",(s=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize,minZoomImageRatio:1})).minPixelRatio=this.minPixelRatio=u.minPixelRatio,e.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new e.Point(1,1),this.totalBorderWidths=new e.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),s.controlOptions.anchor!=e.ControlAnchor.NONE&&(h=this.element.style,c=this.borderWidth,h.margin="0px",h.border=c+"px solid #555",h.padding="0px",h.background="#000",h.opacity=.8,h.overflow="hidden"),this.displayRegion=e.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid #900",e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=e.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",u.addControl(this.element,s.controlOptions),this._resizeWithViewer=s.controlOptions.anchor!=e.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!=e.ControlAnchor.NONE,this._resizeWithViewer&&(s.width&&s.height?(this.element.style.height="number"==typeof s.height?s.height+"px":s.height,this.element.style.width="number"==typeof s.width?s.width+"px":s.width):(a=e.getElementSize(u.element),this.element.style.height=Math.round(a.y*s.sizeRatio)+"px",this.element.style.width=Math.round(a.x*s.sizeRatio)+"px",this.oldViewerSize=a),l=e.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new e.Point(0,0),e.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),s.navigatorRotate)&&(p(s.viewer.viewport?s.viewer.viewport.getRotation():s.viewer.degrees||0),s.viewer.addHandler("rotate",function(e){p(e.degrees)}));this.innerTracker.destroy(),this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),clickHandler:e.delegate(this,t),releaseHandler:e.delegate(this,n),scrollHandler:e.delegate(this,r)}),this.addHandler("reset-size",function(){d.viewport&&d.viewport.goHome(!0)}),u.world.addHandler("item-index-change",function(e){window.setTimeout(function(){var t=d.world.getItemAt(e.previousIndex);d.world.setItemIndex(t,e.newIndex)},1)}),u.world.addHandler("remove-item",function(e){var t=e.item,i=d._getMatchingItem(t);i&&d.world.removeItem(i)}),this.update(u.viewport)},e.extend(e.Navigator.prototype,e.EventSource.prototype,e.Viewer.prototype,{updateSize:function(){if(this.viewport){var t=new e.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);t.equals(this.oldContainerSize)||(this.viewport.resize(t,!0),this.viewport.goHome(!0),this.oldContainerSize=t,this.drawer.clear(),this.world.draw())}},update:function(t){var i,n,r,o,s,a;if(i=e.getElementSize(this.viewer.element),this._resizeWithViewer&&i.x&&i.y&&!i.equals(this.oldViewerSize)&&(this.oldViewerSize=i,this.maintainSizeRatio||!this.elementArea?(n=i.x*this.sizeRatio,r=i.y*this.sizeRatio):(n=Math.sqrt(this.elementArea*(i.x/i.y)),r=this.elementArea/n),this.element.style.width=Math.round(n)+"px",this.element.style.height=Math.round(r)+"px",this.elementArea||(this.elementArea=n*r),this.updateSize()),t&&this.viewport){o=t.getBoundsNoRotate(!0),s=this.viewport.pixelFromPointNoRotate(o.getTopLeft(),!1),a=this.viewport.pixelFromPointNoRotate(o.getBottomRight(),!1).minus(this.totalBorderWidths);var l=this.displayRegion.style;l.display=this.world.getItemCount()?"block":"none",l.top=Math.round(s.y)+"px",l.left=Math.round(s.x)+"px";var h=Math.abs(s.x-a.x),c=Math.abs(s.y-a.y);l.width=Math.round(Math.max(h,0))+"px",l.height=Math.round(Math.max(c,0))+"px"}},addTiledImage:function(t){var i=this,n=t.originalTiledImage;delete t.original;var r=e.extend({},t,{success:function(e){var t=e.item;function r(){i._matchBounds(t,n)}t._originalForNavigator=n,i._matchBounds(t,n,!0),n.addHandler("bounds-change",r),n.addHandler("clip-change",r),n.addHandler("opacity-change",function(){i._matchOpacity(t,n)}),n.addHandler("composite-operation-change",function(){i._matchCompositeOperation(t,n)})}});return e.Viewer.prototype.addTiledImage.apply(this,[r])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;n<i;n++)if((t=this.world.getItemAt(n))._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBoundsNoRotate();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i),e.setRotation(t.getRotation(),i),e.setClip(t.getClip())},_matchOpacity:function(e,t){e.setOpacity(t.opacity)},_matchCompositeOperation:function(e,t){e.setCompositeOperation(t.compositeOperation)}})}(OpenSeadragon),function(e){var t={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};e.extend(e,{getString:function(i){var n,r=i.split("."),o=null,s=arguments,a=t;for(n=0;n<r.length-1;n++)a=a[r[n]]||{};return"string"!=typeof(o=a[r[n]])&&(e.console.log("Untranslated source string:",i),o=""),o.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<s.length?s[t]:""})},setString:function(e,i){var n,r=e.split("."),o=t;for(n=0;n<r.length-1;n++)o[r[n]]||(o[r[n]]={}),o=o[r[n]];o[r[n]]=i}})}(OpenSeadragon),function(e){e.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},e.Point.prototype={clone:function(){return new e.Point(this.x,this.y)},plus:function(t){return new e.Point(this.x+t.x,this.y+t.y)},minus:function(t){return new e.Point(this.x-t.x,this.y-t.y)},times:function(t){return new e.Point(this.x*t,this.y*t)},divide:function(t){return new e.Point(this.x/t,this.y/t)},negate:function(){return new e.Point(-this.x,-this.y)},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},squaredDistanceTo:function(e){return Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)},apply:function(t){return new e.Point(t(this.x),t(this.y))},equals:function(t){return t instanceof e.Point&&this.x===t.x&&this.y===t.y},rotate:function(t,i){var n,r;if(i=i||new e.Point(0,0),t%90==0){switch(e.positiveModulo(t,360)){case 0:n=1,r=0;break;case 90:n=0,r=1;break;case 180:n=-1,r=0;break;case 270:n=0,r=-1}}else{var o=t*Math.PI/180;n=Math.cos(o),r=Math.sin(o)}var s=n*(this.x-i.x)-r*(this.y-i.y)+i.x,a=r*(this.x-i.x)+n*(this.y-i.y)+i.y;return new e.Point(s,a)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(e){e.TileSource=function(t,i,n,r,o,s){var a,l,h=this,c=arguments;if(a=e.isPlainObject(t)?t:{width:c[0],height:c[1],tileSize:c[2],tileOverlap:c[3],minLevel:c[4],maxLevel:c[5]},e.EventSource.call(this),e.extend(!0,this,a),!this.success)for(l=0;l<arguments.length;l++)if(e.isFunction(arguments[l])){this.success=arguments[l];break}this.success&&this.addHandler("ready",function(e){h.success(e)}),"string"==e.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new e.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=a.width&&a.height?a.width/a.height:1,this.dimensions=new e.Point(a.width,a.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=a.tileOverlap?a.tileOverlap:0,this.minLevel=a.minLevel?a.minLevel:0,this.maxLevel=void 0!==a.maxLevel&&null!==a.maxLevel?a.maxLevel:a.width&&a.height?Math.ceil(Math.log(Math.max(a.width,a.height))/Math.log(2)):0,this.success&&e.isFunction(this.success)&&this.success(this))},e.TileSource.prototype={getTileSize:function(t){return e.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(t){var i=this.getLevelScale(t),n=Math.ceil(i*this.dimensions.x/this.getTileWidth(t)),r=Math.ceil(i*this.dimensions.y/this.getTileHeight(t));return new e.Point(n,r)},getPixelRatio:function(t){var i=this.dimensions.times(this.getLevelScale(t)),n=1/i.x,r=1/i.y;return new e.Point(n,r)},getClosestLevel:function(){var e,t;for(e=this.minLevel+1;e<=this.maxLevel&&!((t=this.getNumTiles(e)).x>1||t.y>1);e++);return e-1},getTileAtPoint:function(t,i){var n=i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1/this.aspectRatio;e.console.assert(n,"[TileSource.getTileAtPoint] must be called with a valid point.");var r=this.dimensions.x*this.getLevelScale(t),o=i.x*r,s=i.y*r,a=Math.floor(o/this.getTileWidth(t)),l=Math.floor(s/this.getTileHeight(t));i.x>=1&&(a=this.getNumTiles(t).x-1);return i.y>=1/this.aspectRatio-1e-15&&(l=this.getNumTiles(t).y-1),new e.Point(a,l)},getTileBounds:function(t,i,n,r){var o=this.dimensions.times(this.getLevelScale(t)),s=this.getTileWidth(t),a=this.getTileHeight(t),l=0===i?0:s*i-this.tileOverlap,h=0===n?0:a*n-this.tileOverlap,c=s+(0===i?1:2)*this.tileOverlap,u=a+(0===n?1:2)*this.tileOverlap,d=1/o.x;return c=Math.min(c,o.x-l),u=Math.min(u,o.y-h),r?new e.Rect(0,0,c,u):new e.Rect(l*d,h*d,c*d,u*d)},getImageInfo:function(t){var i,n,r,o,s,a,l,h=this;t&&(l=(a=(s=t.split("/"))[s.length-1]).lastIndexOf("."))>-1&&(s[s.length-1]=a.slice(0,l)),n=function(i){"string"==typeof i&&(i=e.parseXml(i));var n=e.TileSource.determineType(h,i,t);n?(void 0===(o=n.prototype.configure.apply(h,[i,t])).ajaxWithCredentials&&(o.ajaxWithCredentials=h.ajaxWithCredentials),r=new n(o),h.ready=!0,h.raiseEvent("ready",{tileSource:r})):h.raiseEvent("open-failed",{message:"Unable to load TileSource",source:t})},t.match(/\.js$/)?(i=t.split("/").pop().replace(".js",""),e.jsonp({url:t,async:!1,callbackName:i,callback:n})):e.makeAjaxRequest({url:t,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(t){var i=function(t){var i,n,r=t.responseText,o=t.status;if(!t)throw new Error(e.getString("Errors.Security"));if(200!==t.status&&0!==t.status)throw o=t.status,i=404==o?"Not Found":t.statusText,new Error(e.getString("Errors.Status",o,i));if(r.match(/\s*<.*/))try{n=t.responseXML&&t.responseXML.documentElement?t.responseXML:e.parseXml(r)}catch(e){n=t.responseText}else if(r.match(/\s*[\{\[].*/))try{n=e.parseJSON(r)}catch(e){n=r}else n=r;return n}(t);n(i)},error:function(e,i){var n;try{n="HTTP "+e.status+" attempting to load TileSource"}catch(e){n=(void 0!==i&&i.toString?i.toString():"Unknown error")+" attempting to load TileSource"}h.raiseEvent("open-failed",{message:n,source:t})}})},supports:function(e,t){return!1},configure:function(e,t){throw new Error("Method not implemented.")},getTileUrl:function(e,t,i){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(e,t,i){return{}},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&t>=0&&i>=0&&t<n.x&&i<n.y}},e.extend(!0,e.TileSource.prototype,e.EventSource.prototype),e.TileSource.determineType=function(t,i,n){var r;for(r in OpenSeadragon)if(r.match(/.+TileSource$/)&&e.isFunction(OpenSeadragon[r])&&e.isFunction(OpenSeadragon[r].prototype.supports)&&OpenSeadragon[r].prototype.supports.call(t,i,n))return OpenSeadragon[r];e.console.error("No TileSource was able to open %s %s",n,i)}}(OpenSeadragon),function(e){function t(t,i){var n,r,o=i.Image,s=o.Url,a=o.Format,l=o.Size,h=o.DisplayRect||[],c=parseInt(l.Width,10),u=parseInt(l.Height,10),d=parseInt(o.TileSize,10),p=parseInt(o.Overlap,10),g=[];for(r=0;r<h.length;r++)n=h[r].Rect,g.push(new e.DisplayRect(parseInt(n.X,10),parseInt(n.Y,10),parseInt(n.Width,10),parseInt(n.Height,10),parseInt(n.MinLevel,10),parseInt(n.MaxLevel,10)));return e.extend(!0,{width:c,height:u,tileSize:d,tileOverlap:p,minLevel:null,maxLevel:null,tilesUrl:s,fileFormat:a,displayRects:g},i)}e.DziTileSource=function(t,i,n,r,o,s,a,l,h){var c,u,d,p;if(p=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=p.tilesUrl,this.fileFormat=p.fileFormat,this.displayRects=p.displayRects,this.displayRects)for(c=this.displayRects.length-1;c>=0;c--)for(d=(u=this.displayRects[c]).minLevel;d<=u.maxLevel;d++)this._levelRects[d]||(this._levelRects[d]=[]),this._levelRects[d].push(u);e.TileSource.apply(this,[p])},e.extend(e.DziTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){var i;return e.Image?i=e.Image.xmlns:e.documentElement&&("Image"!=e.documentElement.localName&&"Image"!=e.documentElement.tagName||(i=e.documentElement.namespaceURI)),-1!==(i=(i||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==i.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(i,n){var r;return r=e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var r,o,s,a,l,h=n.documentElement,c=h.localName||h.tagName,u=n.documentElement.namespaceURI,d=null,p=[];if("Image"==c)try{if(void 0===(a=h.getElementsByTagName("Size")[0])&&(a=h.getElementsByTagNameNS(u,"Size")[0]),d={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:h.getAttribute("Url"),Format:h.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(h.getAttribute("Overlap"),10),TileSize:parseInt(h.getAttribute("TileSize"),10),Size:{Height:parseInt(a.getAttribute("Height"),10),Width:parseInt(a.getAttribute("Width"),10)}}},!e.imageFormatSupported(d.Image.Format))throw new Error(e.getString("Errors.ImageFormat",d.Image.Format.toUpperCase()));for(void 0===(r=h.getElementsByTagName("DisplayRect"))&&(r=h.getElementsByTagNameNS(u,"DisplayRect")[0]),l=0;l<r.length;l++)o=r[l],void 0===(s=o.getElementsByTagName("Rect")[0])&&(s=o.getElementsByTagNameNS(u,"Rect")[0]),p.push({Rect:{X:parseInt(s.getAttribute("X"),10),Y:parseInt(s.getAttribute("Y"),10),Width:parseInt(s.getAttribute("Width"),10),Height:parseInt(s.getAttribute("Height"),10),MinLevel:parseInt(o.getAttribute("MinLevel"),10),MaxLevel:parseInt(o.getAttribute("MaxLevel"),10)}});return p.length&&(d.Image.DisplayRect=p),t(i,d)}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.Dzi"))}else{if("Collection"==c)throw new Error(e.getString("Errors.Dzc"));if("Error"==c){var g=h.getElementsByTagName("Message")[0],m=g.firstChild.nodeValue;throw new Error(m)}}throw new Error(e.getString("Errors.Dzi"))}(this,i),n&&!r.tilesUrl&&(r.tilesUrl=n.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=n.search(/\.(dzi|xml|js)\?/)?r.queryParams=n.match(/\?.*/):r.queryParams=""),r},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(e,t,i){var n,r,o,s,a,l,h,c=this._levelRects[e];if(!c||!c.length)return!0;for(h=c.length-1;h>=0;h--)if(!(e<(n=c[h]).minLevel||e>n.maxLevel)&&(r=this.getLevelScale(e),o=n.x*r,s=n.y*r,a=o+n.width*r,l=s+n.height*r,o=Math.floor(o/this._tileWidth),s=Math.floor(s/this._tileWidth),a=Math.ceil(a/this._tileWidth),l=Math.ceil(l/this._tileWidth),o<=t&&t<a&&s<=i&&i<l))return!0;return!1}})}(OpenSeadragon),function(e){e.IIIFTileSource=function(t){if(e.extend(!0,this,t),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(t.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)t.tileWidth=this.tile_width,t.tileHeight=this.tile_height;else if(this.tile_width)t.tileSize=this.tile_width;else if(this.tile_height)t.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)t.tileWidth=this.tiles[0].width,t.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var i=0;i<this.tiles.length;i++)for(var n=0;n<this.tiles[i].scaleFactors.length;n++){var r=this.tiles[i].scaleFactors[n];this.scale_factors.push(r),t.tileSizePerScaleFactor[r]={width:this.tiles[i].width,height:this.tiles[i].height||this.tiles[i].width}}}else if(h=t.profile,-1==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(h[0])||-1!=h.indexOf("sizeByW")){for(var o=Math.min(this.height,this.width),s=[256,512,1024],a=[],l=0;l<s.length;l++)s[l]<=o&&a.push(s[l]);a.length>0?t.tileSize=Math.max.apply(null,a):t.tileSize=o}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,t.levels=function(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+",/0/default.jpg",width:e.sizes[i].width,height:e.sizes[i].height});return t.sort(function(e,t){return e.width-t.width})}(this),e.extend(!0,t,{width:t.levels[t.levels.length-1].width,height:t.levels[t.levels.length-1].height,tileSize:Math.max(t.height,t.width),tileOverlap:0,minLevel:0,maxLevel:t.levels.length-1}),this.levels=t.levels):e.console.error("Nothing in the info.json to construct image pyramids from");var h;if(!t.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var c=Math.max.apply(null,this.scale_factors);t.maxLevel=Math.round(Math.log(c)*Math.LOG2E)}else t.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));e.TileSource.apply(this,[t])},e.extend(e.IIIFTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return!(!e.protocol||"http://iiif.io/api/image"!=e.protocol)||(!(!e["@context"]||"http://library.stanford.edu/iiif/image-api/1.1/context.json"!=e["@context"]&&"http://iiif.io/api/image/1/context.json"!=e["@context"])||(!(!e.profile||0!==e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html"))||(!!(e.identifier&&e.width&&e.height)||!(!e.documentElement||"info"!=e.documentElement.tagName||"http://library.stanford.edu/iiif/image-api/ns/"!=e.documentElement.namespaceURI))))},configure:function(t,i){if(e.isPlainObject(t))return t["@context"]?t:(t["@context"]="http://iiif.io/api/image/1.0/context.json",t["@id"]=i.replace("/info.json",""),t);var n=function(t){if(!t||!t.documentElement)throw new Error(e.getString("Errors.Xml"));var i=t.documentElement,n=null;if("info"==i.tagName)try{return function t(i,n,r){var o,s;if(3==i.nodeType&&r)(s=i.nodeValue.trim()).match(/^\d*$/)&&(s=Number(s)),n[r]?(e.isArray(n[r])||(n[r]=[n[r]]),n[r].push(s)):n[r]=s;else if(1==i.nodeType)for(o=0;o<i.childNodes.length;o++)t(i.childNodes[o],n,i.nodeName)}(i,n={}),n}catch(t){throw t instanceof Error?t:new Error(e.getString("Errors.IIIF"))}throw new Error(e.getString("Errors.IIIF"))}(t);return n["@context"]="http://iiif.io/api/image/1.0/context.json",n["@id"]=i.replace("/info.xml",""),n},getTileWidth:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileWidth.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(t){if(this.emulateLegacyImagePyramid)return e.TileSource.prototype.getTileHeight.call(this,t);var i=Math.pow(2,this.maxLevel-t);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(t){if(this.emulateLegacyImagePyramid){var i=NaN;return this.levels.length>0&&t>=this.minLevel&&t<=this.maxLevel&&(i=this.levels[t].width/this.levels[this.maxLevel].width),i}return e.TileSource.prototype.getLevelScale.call(this,t)},getNumTiles:function(t){return this.emulateLegacyImagePyramid?this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0):e.TileSource.prototype.getNumTiles.call(this,t)},getTileAtPoint:function(t,i){return this.emulateLegacyImagePyramid?new e.Point(0,0):e.TileSource.prototype.getTileAtPoint.call(this,t,i)},getTileUrl:function(e,t,i){if(this.emulateLegacyImagePyramid){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}var r,o,s,a,l,h,c,u,d,p,g,m=Math.pow(.5,this.maxLevel-e),f=Math.ceil(this.width*m),v=Math.ceil(this.height*m);return r=this.getTileWidth(e),o=this.getTileHeight(e),s=Math.ceil(r/m),a=Math.ceil(o/m),g=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1?"native.jpg":"default.jpg",f<r&&v<o?(p=f+",",l="full"):(h=t*s,c=i*a,u=Math.min(s,this.width-h),d=Math.min(a,this.height-c),p=Math.ceil(u*m)+",",l=[h,c,u,d].join(",")),[this["@id"],l,p,"0",g].join("/")}})}(OpenSeadragon),function(e){e.OsmTileSource=function(t,i,n,r,o){var s;(s=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&s.height||(s.width=65572864,s.height=65572864),s.tileSize||(s.tileSize=256,s.tileOverlap=0),s.tilesUrl||(s.tilesUrl="http://tile.openstreetmap.org/"),s.minLevel=8,e.TileSource.apply(this,[s])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"openstreetmaps"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),function(e){e.TmsTileSource=function(t,i,n,r,o){var s;s=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var a,l=256*Math.ceil(s.width/256),h=256*Math.ceil(s.height/256);a=l>h?l/256:h/256,s.maxLevel=Math.ceil(Math.log(a)/Math.log(2))-1,s.tileSize=256,s.width=l,s.height=h,e.TileSource.apply(this,[s])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"tiledmapservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),function(e){e.ZoomifyTileSource=function(e){e.tileSize=256;var t={x:e.width,y:e.height};for(e.imageSizes=[{x:e.width,y:e.height}],e.gridSize=[this._getGridSize(e.width,e.height,e.tileSize)];parseInt(t.x,10)>e.tileSize||parseInt(t.y,10)>e.tileSize;)t.x=Math.floor(t.x/2),t.y=Math.floor(t.y/2),e.imageSizes.push({x:t.x,y:t.y}),e.gridSize.push(this._getGridSize(t.x,t.y,e.tileSize));e.imageSizes.reverse(),e.gridSize.reverse(),e.minLevel=0,e.maxLevel=e.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[e])},e.extend(e.ZoomifyTileSource.prototype,e.TileSource.prototype,{_getGridSize:function(e,t,i){return{x:Math.ceil(e/i),y:Math.ceil(t/i)}},_calculateAbsoluteTileNumber:function(e,t,i){for(var n=0,r={},o=0;o<e;o++)n+=(r=this.gridSize[o]).x*r.y;return n+=(r=this.gridSize[e]).x*i+t},supports:function(e,t){return e.type&&"zoomifytileservice"==e.type},configure:function(e,t){return e},getTileUrl:function(e,t,i){var n,r=this._calculateAbsoluteTileNumber(e,t,i);return n=Math.floor(r/256),this.tilesUrl+"TileGroup"+n+"/"+e+"-"+t+"-"+i+".jpg"}})}(OpenSeadragon),function(e){function t(e,t){return t.levels}e.LegacyTileSource=function(t){var i,n,r;e.isArray(t)&&(i={type:"legacy-image-pyramid",levels:t}),i.levels=function(t){var i,n,r=[];for(n=0;n<t.length;n++)(i=t[n]).height&&i.width&&i.url?r.push({url:i.url,width:Number(i.width),height:Number(i.height)}):e.console.error("Unsupported image format: %s",i.url?i.url:"<no URL>");return r.sort(function(e,t){return e.height-t.height})}(i.levels),i.levels.length>0?(n=i.levels[i.levels.length-1].width,r=i.levels[i.levels.length-1].height):(n=0,r=0,e.console.error("No supported image formats found")),e.extend(!0,i,{width:n,height:r,tileSize:Math.max(r,n),tileOverlap:0,minLevel:0,maxLevel:i.levels.length>0?i.levels.length-1:0}),e.TileSource.apply(this,[i]),this.levels=i.levels},e.extend(e.LegacyTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(i,n){return e.isPlainObject(i)?t(this,i):function(i,n){if(!n||!n.documentElement)throw new Error(e.getString("Errors.Xml"));var r,o,s=n.documentElement,a=s.tagName,l=null,h=[];if("image"==a)try{for(l={type:s.getAttribute("type"),levels:[]},h=s.getElementsByTagName("level"),o=0;o<h.length;o++)r=h[o],l.levels.push({url:r.getAttribute("url"),width:parseInt(r.getAttribute("width"),10),height:parseInt(r.getAttribute("height"),10)});return t(i,l)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==a)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==a)throw new Error("Error: "+n)}throw new Error("Unknown element "+a)}(this,i)},getLevelScale:function(e){var t=NaN;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return this.levels.length>0&&e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n}})}(OpenSeadragon),function(e){e.ImageTileSource=function(t){t=e.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},t),e.TileSource.apply(this,[t])},e.extend(e.ImageTileSource.prototype,e.TileSource.prototype,{supports:function(e,t){return e.type&&"image"===e.type},configure:function(e,t){return e},getImageInfo:function(t){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),e.addEvent(i,"load",function(){n.width=Object.prototype.hasOwnProperty.call(i,"naturalWidth")?i.naturalWidth:i.width,n.height=Object.prototype.hasOwnProperty.call(i,"naturalHeight")?i.naturalHeight:i.height,n.aspectRatio=n.width/n.height,n.dimensions=new e.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),e.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+t,source:t})}),i.src=t},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(t){return this.getLevelScale(t)?new e.Point(1,1):new e.Point(0,0)},getTileUrl:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].url),n},getContext2D:function(e,t,i){var n=null;return e>=this.minLevel&&e<=this.maxLevel&&(n=this.levels[e].context2D),n},_buildLevels:function(){var t=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!e.supportsCanvas||!this.useCanvas)return delete this._image,t;var i=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,n=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,r=document.createElement("canvas"),o=r.getContext("2d");if(r.width=i,r.height=n,o.drawImage(this._image,0,0,i,n),t[0].context2D=o,delete this._image,e.isCanvasTainted(r))return t;for(;i>=2&&n>=2;){i=Math.floor(i/2),n=Math.floor(n/2);var s=document.createElement("canvas"),a=s.getContext("2d");s.width=i,s.height=n,a.drawImage(r,0,0,i,n),t.splice(0,0,{context2D:a,width:i,height:n}),r=s,o=a}return t}})}(OpenSeadragon),function(e){e.TileSourceCollection=function(t,i,n,r){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(e){function t(i){e.requestAnimationFrame(function(){!function(i){var n,r,o;i.shouldFade&&(n=e.now(),r=n-i.fadeBeginTime,o=1-r/i.fadeLength,o=Math.min(1,o),o=Math.max(0,o),i.imgGroup&&e.setElementOpacity(i.imgGroup,o,!0),o>0&&t(i))}(i)})}function i(t,i){t.element.disabled||(i>=e.ButtonState.GROUP&&t.currentState==e.ButtonState.REST&&(!function(t){t.shouldFade=!1,t.imgGroup&&e.setElementOpacity(t.imgGroup,1,!0)}(t),t.currentState=e.ButtonState.GROUP),i>=e.ButtonState.HOVER&&t.currentState==e.ButtonState.GROUP&&(t.imgHover&&(t.imgHover.style.visibility=""),t.currentState=e.ButtonState.HOVER),i>=e.ButtonState.DOWN&&t.currentState==e.ButtonState.HOVER&&(t.imgDown&&(t.imgDown.style.visibility=""),t.currentState=e.ButtonState.DOWN))}function n(i,n){i.element.disabled||(n<=e.ButtonState.HOVER&&i.currentState==e.ButtonState.DOWN&&(i.imgDown&&(i.imgDown.style.visibility="hidden"),i.currentState=e.ButtonState.HOVER),n<=e.ButtonState.GROUP&&i.currentState==e.ButtonState.HOVER&&(i.imgHover&&(i.imgHover.style.visibility="hidden"),i.currentState=e.ButtonState.GROUP),n<=e.ButtonState.REST&&i.currentState==e.ButtonState.GROUP&&(!function(i){i.shouldFade=!0,i.fadeBeginTime=e.now()+i.fadeDelay,window.setTimeout(function(){t(i)},i.fadeDelay)}(i),i.currentState=e.ButtonState.REST))}e.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},e.Button=function(t){var r=this;e.EventSource.call(this),e.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},t),this.element=t.element||e.makeNeutralElement("div"),t.element||(this.imgRest=e.makeTransparentImage(this.srcRest),this.imgGroup=e.makeTransparentImage(this.srcGroup),this.imgHover=e.makeTransparentImage(this.srcHover),this.imgDown=e.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",e.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",e.Browser.vendor==e.BROWSERS.FIREFOX&&e.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=e.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(t){t.insideElementPressed?(i(r,e.ButtonState.DOWN),r.raiseEvent("enter",{originalEvent:t.originalEvent})):t.buttonDownAny||i(r,e.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),r.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(t){n(r,e.ButtonState.GROUP),t.insideElementPressed&&r.raiseEvent("exit",{originalEvent:t.originalEvent})},blurHandler:function(e){this.exitHandler(e),r.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(t){i(r,e.ButtonState.DOWN),r.raiseEvent("press",{originalEvent:t.originalEvent})},releaseHandler:function(t){t.insideElementPressed&&t.insideElementReleased?(n(r,e.ButtonState.HOVER),r.raiseEvent("release",{originalEvent:t.originalEvent})):t.insideElementPressed?n(r,e.ButtonState.GROUP):i(r,e.ButtonState.HOVER)},clickHandler:function(e){e.quick&&r.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(r.raiseEvent("click",{originalEvent:e.originalEvent}),r.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),n(this,e.ButtonState.REST)},e.extend(e.Button.prototype,e.EventSource.prototype,{notifyGroupEnter:function(){i(this,e.ButtonState.GROUP)},notifyGroupExit:function(){n(this,e.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,e.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,e.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(e){e.ButtonGroup=function(t){e.extend(!0,this,{buttons:[],clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:e.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},t);var i,n=this.buttons.concat([]),r=this;if(this.element=t.element||e.makeNeutralElement("div"),!t.group)for(this.label=e.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),i=0;i<n.length;i++)this.element.appendChild(n[i].element);e.setElementTouchActionNone(this.element),this.tracker=new e.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(e){var t;for(t=0;t<r.buttons.length;t++)r.buttons[t].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<r.buttons.length;t++)r.buttons[t].notifyGroupExit()}})},e.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(e){e.Rect=function(t,i,n,r,o){var s,a;this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof r?r:0,this.degrees="number"==typeof o?o:0,this.degrees=e.positiveModulo(this.degrees,360),this.degrees>=270?(s=this.getTopRight(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=270):this.degrees>=180?(s=this.getBottomRight(),this.x=s.x,this.y=s.y,this.degrees-=180):this.degrees>=90&&(s=this.getBottomLeft(),this.x=s.x,this.y=s.y,a=this.height,this.height=this.width,this.width=a,this.degrees-=90)},e.Rect.fromSummits=function(t,i,n){var r=t.distanceTo(i),o=t.distanceTo(n),s=i.minus(t),a=Math.atan(s.y/s.x);return s.x<0?a+=Math.PI:s.y<0&&(a+=2*Math.PI),new e.Rect(t.x,t.y,r,o,a/Math.PI*180)},e.Rect.prototype={clone:function(){return new e.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new e.Point(this.x,this.y)},getBottomRight:function(){return new e.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new e.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new e.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new e.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new e.Point(this.width,this.height)},equals:function(t){return t instanceof e.Rect&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.degrees===t.degrees},times:function(t){return new e.Rect(this.x*t,this.y*t,this.width*t,this.height*t,this.degrees)},translate:function(t){return new e.Rect(this.x+t.x,this.y+t.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),n=t.getBoundingBox(),r=Math.min(i.x,n.x),o=Math.min(i.y,n.y),s=Math.max(i.x+i.width,n.x+n.width),a=Math.max(i.y+i.height,n.y+n.height);return new e.Rect(r,o,s-r,a-o)},intersection:function(t){var i=1e-10,n=[],r=this.getTopLeft();t.containsPoint(r,i)&&n.push(r);var o=this.getTopRight();t.containsPoint(o,i)&&n.push(o);var s=this.getBottomLeft();t.containsPoint(s,i)&&n.push(s);var a=this.getBottomRight();t.containsPoint(a,i)&&n.push(a);var l=t.getTopLeft();this.containsPoint(l,i)&&n.push(l);var h=t.getTopRight();this.containsPoint(h,i)&&n.push(h);var c=t.getBottomLeft();this.containsPoint(c,i)&&n.push(c);var u=t.getBottomRight();this.containsPoint(u,i)&&n.push(u);for(var d=this._getSegments(),p=t._getSegments(),g=0;g<d.length;g++)for(var m=d[g],f=0;f<p.length;f++){var v=p[f],w=y(m[0],m[1],v[0],v[1]);w&&n.push(w)}function y(t,n,r,o){var s=n.minus(t),a=o.minus(r),l=-a.x*s.y+s.x*a.y;if(0===l)return null;var h=(s.x*(t.y-r.y)-s.y*(t.x-r.x))/l,c=(a.x*(t.y-r.y)-a.y*(t.x-r.x))/l;return-i<=h&&h<=1-i&&-i<=c&&c<=1-i?new e.Point(t.x+c*s.x,t.y+c*s.y):null}if(0===n.length)return null;for(var _=n[0].x,T=n[0].x,x=n[0].y,S=n[0].y,b=1;b<n.length;b++){var E=n[b];E.x<_&&(_=E.x),E.x>T&&(T=E.x),E.y<x&&(x=E.y),E.y>S&&(S=E.y)}return new e.Rect(_,x,T-_,S-x)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(t,i){if(0===(t=e.positiveModulo(t,360)))return this.clone();i=i||this.getCenter();var n=this.getTopLeft().rotate(t,i),r=this.getTopRight().rotate(t,i).minus(n);r=r.apply(function(e){return Math.abs(e)<1e-15?0:e});var o=Math.atan(r.y/r.x);return r.x<0?o+=Math.PI:r.y<0&&(o+=2*Math.PI),new e.Rect(n.x,n.y,this.width,this.height,o/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),i=this.getTopRight(),n=this.getBottomLeft(),r=this.getBottomRight(),o=Math.min(t.x,i.x,n.x,r.x),s=Math.max(t.x,i.x,n.x,r.x),a=Math.min(t.y,i.y,n.y,r.y),l=Math.max(t.y,i.y,n.y,r.y);return new e.Rect(o,a,s-o,l-a)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),i=Math.floor(t.x),n=Math.floor(t.y),r=Math.ceil(t.width+t.x-i),o=Math.ceil(t.height+t.y-n);return new e.Rect(i,n,r,o)},containsPoint:function(e,t){t=t||0;var i=this.getTopLeft(),n=this.getTopRight(),r=this.getBottomLeft(),o=n.minus(i),s=r.minus(i);return(e.x-i.x)*o.x+(e.y-i.y)*o.y>=-t&&(e.x-n.x)*o.x+(e.y-n.y)*o.y<=t&&(e.x-i.x)*s.x+(e.y-i.y)*s.y>=-t&&(e.x-r.x)*s.x+(e.y-r.y)*s.y<=t},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(e){var t={};function i(t){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-t.delta.x>0?i>-(o-a.x)&&(this.element.style.marginLeft=i+2*t.delta.x+"px",r(this,a.x,i+2*t.delta.x)):-t.delta.x<0&&i<0&&(this.element.style.marginLeft=i+2*t.delta.x+"px",r(this,a.x,i+2*t.delta.x)):-t.delta.y>0?n>-(s-a.y)&&(this.element.style.marginTop=n+2*t.delta.y+"px",r(this,a.y,n+2*t.delta.y)):-t.delta.y<0&&n<0&&(this.element.style.marginTop=n+2*t.delta.y+"px",r(this,a.y,n+2*t.delta.y))),!1}function n(t){var i=Number(this.element.style.marginLeft.replace("px","")),n=Number(this.element.style.marginTop.replace("px","")),o=Number(this.element.style.width.replace("px","")),s=Number(this.element.style.height.replace("px","")),a=e.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?t.scroll>0?i>-(o-a.x)&&(this.element.style.marginLeft=i-60*t.scroll+"px",r(this,a.x,i-60*t.scroll)):t.scroll<0&&i<0&&(this.element.style.marginLeft=i-60*t.scroll+"px",r(this,a.x,i-60*t.scroll)):t.scroll<0?n>a.y-s&&(this.element.style.marginTop=n+60*t.scroll+"px",r(this,a.y,n+60*t.scroll)):t.scroll>0&&n<0&&(this.element.style.marginTop=n+60*t.scroll+"px",r(this,a.y,n+60*t.scroll))),!1}function r(t,i,n){var r,o,s,a,l,h,c;for(r="horizontal"==t.scroll?t.panelWidth:t.panelHeight,o=Math.ceil(i/r)+5,h=o=(o=(s=Math.ceil((Math.abs(n)+i)/r)+1)-o)<0?0:o;h<s&&h<t.panels.length;h++)if(!(c=t.panels[h]).activePanel){var u,d=t.viewer.tileSources[h];u=d.referenceStripThumbnailUrl?{type:"image",url:d.referenceStripThumbnailUrl}:d,(a=new e.Viewer({id:c.id,tileSources:[u],element:c,navigatorSizeRatio:t.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0})).displayRegion=e.makeNeutralElement("div"),a.displayRegion.id=c.id+"-displayregion",a.displayRegion.className="displayregion",(l=a.displayRegion.style).position="relative",l.top="0px",l.left="0px",l.fontSize="0px",l.overflow="hidden",l.float="left",l.cssFloat="left",l.styleFloat="left",l.zIndex=999999999,l.cursor="default",l.width=t.panelWidth-4+"px",l.height=t.panelHeight-4+"px",a.displayRegion.innerTracker=new e.MouseTracker({element:a.displayRegion,startDisabled:!0}),c.getElementsByTagName("div")[0].appendChild(a.displayRegion),t.miniViewers[c.id]=a,c.activePanel=!0}}function o(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function s(t){var i=t.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+e.getElementSize(i).y/2+"px":i.style.marginLeft="-"+e.getElementSize(i).x/2+"px",!1}function a(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function l(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}e.ReferenceStrip=function(h){var c,u,d,p=h.viewer,g=e.getElementSize(p.element);for(h.id||(h.id="referencestrip-"+e.now(),this.element=e.makeNeutralElement("div"),this.element.id=h.id,this.element.className="referencestrip"),h=e.extend(!0,{sizeRatio:e.DEFAULT_SETTINGS.referenceStripSizeRatio,position:e.DEFAULT_SETTINGS.referenceStripPosition,scroll:e.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:e.DEFAULT_SETTINGS.clickTimeThreshold},h,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),e.extend(this,h),t[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(u=this.element.style).marginTop="0px",u.marginRight="0px",u.marginBottom="0px",u.marginLeft="0px",u.left="0px",u.bottom="0px",u.border="0px",u.background="#000",u.position="relative",e.setElementTouchActionNone(this.element),e.setElementOpacity(this.element,.8),this.viewer=p,this.innerTracker=new e.MouseTracker({element:this.element,dragHandler:e.delegate(this,i),scrollHandler:e.delegate(this,n),enterHandler:e.delegate(this,o),exitHandler:e.delegate(this,s),keyDownHandler:e.delegate(this,a),keyHandler:e.delegate(this,l)}),h.width&&h.height?(this.element.style.width=h.width+"px",this.element.style.height=h.height+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):"horizontal"==h.scroll?(this.element.style.width=g.x*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.height=g.y*h.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=g.y*h.sizeRatio*p.tileSources.length+12*p.tileSources.length+"px",this.element.style.width=g.x*h.sizeRatio+"px",p.addControl(this.element,{anchor:e.ControlAnchor.TOP_LEFT})),this.panelWidth=g.x*this.sizeRatio+8,this.panelHeight=g.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},d=0;d<p.tileSources.length;d++)(c=e.makeNeutralElement("div")).id=this.element.id+"-"+d,c.style.width=this.panelWidth+"px",c.style.height=this.panelHeight+"px",c.style.display="inline",c.style.float="left",c.style.cssFloat="left",c.style.styleFloat="left",c.style.padding="2px",e.setElementTouchActionNone(c),c.innerTracker=new e.MouseTracker({element:c,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(t){t.eventSource.dragging=e.now()},releaseHandler:function(t){var i=t.eventSource,n=i.element.id,r=Number(n.split("-")[2]),o=e.now();t.insideElementPressed&&t.insideElementReleased&&i.dragging&&o-i.dragging<i.clickTimeThreshold&&(i.dragging=null,p.goToPage(r))}}),this.element.appendChild(c),c.activePanel=!1,this.panels.push(c);r(this,"vertical"==this.scroll?g.y:g.x,0),this.setFocus(0)},e.extend(e.ReferenceStrip.prototype,e.EventSource.prototype,e.Viewer.prototype,{setFocus:function(t){var i,n=e.getElement(this.element.id+"-"+t),s=e.getElementSize(this.viewer.canvas),a=Number(this.element.style.width.replace("px","")),l=Number(this.element.style.height.replace("px","")),h=-Number(this.element.style.marginLeft.replace("px","")),c=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==n&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=n,this.currentSelected.style.background="#999","horizontal"==this.scroll?(i=Number(t)*(this.panelWidth+3))>h+s.x-this.panelWidth?(i=Math.min(i,a-s.x),this.element.style.marginLeft=-i+"px",r(this,s.x,-i)):i<h&&(i=Math.max(0,i-s.x/2),this.element.style.marginLeft=-i+"px",r(this,s.x,-i)):(i=Number(t)*(this.panelHeight+3))>c+s.y-this.panelHeight?(i=Math.min(i,l-s.y),this.element.style.marginTop=-i+"px",r(this,s.y,-i)):i<c&&(i=Math.max(0,i-s.y/2),this.element.style.marginTop=-i+"px",r(this,s.y,-i)),this.currentPage=t,o.call(this,{eventSource:this.innerTracker}))},update:function(){return!!t[this.id].animating&&(e.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var e in this.miniViewers)this.miniViewers[e].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(e){e.DisplayRect=function(t,i,n,r,o,s){e.Rect.apply(this,[t,i,n,r]),this.minLevel=o,this.maxLevel=s},e.extend(e.DisplayRect.prototype,e.Rect.prototype)}(OpenSeadragon),function(e){e.Spring=function(t){var i=arguments;"object"!=typeof t&&(t={initial:i.length&&"number"==typeof i[0]?i[0]:void 0,springStiffness:i.length>1?i[1].springStiffness:5,animationTime:i.length>1?i[1].animationTime:1.5}),e.console.assert("number"==typeof t.springStiffness&&0!==t.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),e.console.assert("number"==typeof t.animationTime&&t.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),t.exponential&&(this._exponential=!0,delete t.exponential),e.extend(!0,this,t),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:e.now()},e.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},e.Spring.prototype={resetTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=t,this.start.time=this.target.time=this.current.time=e.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(t){e.console.assert(!this._exponential||0!==t,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=t,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(t){this.start.value+=t,this.target.value+=t,this._exponential&&(e.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(t){this._exponential=t,this._exponential&&(e.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var t,i;this.current.time=e.now(),this._exponential?(t=this.start._logValue,i=this.target._logValue):(t=this.start.value,i=this.target.value);var n,r,o=this.current.time>=this.target.time?i:t+(i-t)*(n=this.springStiffness,r=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(n*-r))/(1-Math.exp(-n))),s=this.current.value;return this._exponential?this.current.value=Math.exp(o):this.current.value=o,s!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}t.prototype={errorMsg:null,start:function(){var t=this,i=this.abort;this.image=new Image,this.image.onload=function(){t.finish(!0)},this.image.onabort=this.image.onerror=function(){t.errorMsg="Image load aborted",t.finish(!1)},this.jobId=window.setTimeout(function(){t.errorMsg="Image load exceeded timeout",t.finish(!1)},this.timeout),this.loadWithAjax?(this.request=e.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(e){var i;try{t.image._array=e.response,i=new window.Blob([e.response])}catch(t){var n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===t.name&&n){var r=new n;r.append(e.response),i=r.getBlob()}}0===i.size&&(t.errorMsg="Empty image response.",t.finish(!1));var o=(window.URL||window.webkitURL).createObjectURL(i);t.image.src=o},error:function(e){t.errorMsg="Image load aborted - XHR error",t.finish(!1)}}),this.abort=function(){t.request.abort(),"function"==typeof i&&i()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,timeout:e.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var i=this,n=new t({src:e.src,loadWithAjax:e.loadWithAjax,ajaxHeaders:e.loadWithAjax?e.ajaxHeaders:null,crossOriginPolicy:e.crossOriginPolicy,ajaxWithCredentials:e.ajaxWithCredentials,callback:function(t){!function(e,t,i){e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&e.jobQueue.length>0&&(e.jobQueue.shift().start(),e.jobsInProgress++),i(t.image,t.errorMsg,t.request)}(i,t,e.callback)},abort:e.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(n.start(),this.jobsInProgress++):this.jobQueue.push(n)},clear:function(){for(var e=0;e<this.jobQueue.length;e++){var t=this.jobQueue[e];"function"==typeof t.abort&&t.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(e){e.Tile=function(e,t,i,n,r,o,s,a,l,h){this.level=e,this.x=t,this.y=i,this.bounds=n,this.sourceBounds=h,this.exists=r,this.url=o,this.context2D=s,this.loadWithAjax=a,this.ajaxHeaders=l,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},e.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(t){this.cacheImageRecord?this.loaded?(this.element||(this.element=e.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=t&&t.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",e.setElementOpacity(this.element,this.opacity)):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):e.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(t,i,n,r){var o,s,a,l=this.position.times(e.pixelDensityRatio),h=this.size.times(e.pixelDensityRatio);this.context2D||this.cacheImageRecord?(o=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&o?(t.save(),t.globalAlpha=this.opacity,"number"==typeof n&&1!==n&&(l=l.times(n),h=h.times(n)),r instanceof e.Point&&(l=l.plus(r)),1===t.globalAlpha&&this._hasTransparencyChannel()&&t.clearRect(l.x+1,l.y+1,h.x-2,h.y-2),i({context:t,tile:this,rendered:o}),this.sourceBounds?(s=Math.min(this.sourceBounds.width,o.canvas.width),a=Math.min(this.sourceBounds.height,o.canvas.height)):(s=o.canvas.width,a=o.canvas.height),t.drawImage(o.canvas,0,0,s,a,l.x,l.y,h.x,h.y),t.restore()):e.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):e.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var t;if(this.cacheImageRecord)t=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return e.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;t=this.context2D}return t.canvas.width/(this.size.x*e.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(t,i,n){var r=Math.max(1,Math.ceil((n.x-i.x)/2)),o=Math.max(1,Math.ceil((n.y-i.y)/2));return new e.Point(r,o).minus(this.position.times(e.pixelDensityRatio).times(t||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(e){e.OverlayPlacement=e.Placement,e.OverlayRotationMode=e.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),e.Overlay=function(t,i,n){var r;r=e.isPlainObject(t)?t:{element:t,location:i,placement:n},this.element=r.element,this.style=r.element.style,this._init(r)},e.Overlay.prototype={_init:function(t){this.location=t.location,this.placement=void 0===t.placement?e.Placement.TOP_LEFT:t.placement,this.onDraw=t.onDraw,this.checkResize=void 0===t.checkResize||t.checkResize,this.width=void 0===t.width?null:t.width,this.height=void 0===t.height?null:t.height,this.rotationMode=t.rotationMode||e.OverlayRotationMode.EXACT,this.location instanceof e.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=e.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new e.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(t,i){var n=e.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?t.x-=i.x/2:n.isRight&&(t.x-=i.x),n.isVerticallyCentered?t.y-=i.y/2:n.isBottom&&(t.y-=i.y))},destroy:function(){var t=this.element,i=this.style;t.parentNode&&(t.parentNode.removeChild(t),t.prevElementParent&&(i.display="none",document.body.appendChild(t))),this.onDraw=null,i.top="",i.left="",i.position="",null!==this.width&&(i.width=""),null!==this.height&&(i.height="");var n=e.getCssPropertyWithVendorPrefix("transformOrigin"),r=e.getCssPropertyWithVendorPrefix("transform");n&&r&&(i[n]="",i[r]="")},drawHTML:function(t,i){var n=this.element;n.parentNode!==t&&(n.prevElementParent=n.parentNode,n.prevNextSibling=n.nextSibling,t.appendChild(n),this.style.position="absolute",this.size=e.getElementSize(n));var r=this._getOverlayPositionAndSize(i),o=r.position,s=this.size=r.size,a=r.rotate;if(this.onDraw)this.onDraw(o,s,this.element);else{var l=this.style;l.left=o.x+"px",l.top=o.y+"px",null!==this.width&&(l.width=s.x+"px"),null!==this.height&&(l.height=s.y+"px");var h=e.getCssPropertyWithVendorPrefix("transformOrigin"),c=e.getCssPropertyWithVendorPrefix("transform");h&&c&&(a?(l[h]=this._getTransformOrigin(),l[c]="rotate("+a+"deg)"):(l[h]="",l[c]="")),"none"!==l.display&&(l.display="block")}},_getOverlayPositionAndSize:function(t){var i=t.pixelFromPoint(this.location,!0),n=this._getSizeInPixels(t);this.adjust(i,n);var r=0;if(t.degrees&&this.rotationMode!==e.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var o=new e.Rect(i.x,i.y,n.x,n.y),s=this._getBoundingBox(o,t.degrees);i=s.getTopLeft(),n=s.getSize()}else r=t.degrees;return{position:i,size:n,rotate:r}},_getSizeInPixels:function(t){var i=this.size.x,n=this.size.y;if(null!==this.width||null!==this.height){var r=t.deltaPixelsFromPointsNoRotate(new e.Point(this.width||0,this.height||0),!0);null!==this.width&&(i=r.x),null!==this.height&&(n=r.y)}if(this.checkResize&&(null===this.width||null===this.height)){var o=this.size=e.getElementSize(this.element);null===this.width&&(i=o.x),null===this.height&&(n=o.y)}return new e.Point(i,n)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(t){var i=new e.Point(t.x,t.y),n=e.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=t.width/2:n.isRight&&(i.x+=t.width),n.isVerticallyCentered?i.y+=t.height/2:n.isBottom&&(i.y+=t.height)),i},_getTransformOrigin:function(){var t="",i=e.Placement.properties[this.placement];return i?(i.isLeft?t="left":i.isRight&&(t="right"),i.isTop?t+=" top":i.isBottom&&(t+=" bottom"),t):t},update:function(t,i){var n=e.isPlainObject(t)?t:{location:t,placement:i};this._init({location:n.location||this.location,placement:void 0!==n.placement?n.placement:this.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:void 0!==n.width?n.width:this.width,height:void 0!==n.height?n.height:this.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(t){e.console.assert(t,"A viewport must now be passed to Overlay.getBounds.");var i=this.width,n=this.height;if(null===i||null===n){var r=t.deltaPointsFromPixelsNoRotate(this.size,!0);null===i&&(i=r.x),null===n&&(n=r.y)}var o=this.location.clone();return this.adjust(o,new e.Point(i,n)),this._adjustBoundsForRotation(t,new e.Rect(o.x,o.y,i,n))},_adjustBoundsForRotation:function(t,i){if(!t||0===t.degrees||this.rotationMode===e.OverlayRotationMode.EXACT)return i;if(this.rotationMode===e.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(t);return t.viewerElementToViewportRectangle(new e.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-t.degrees,this._getPlacementPoint(i))}}}(OpenSeadragon),function(e){e.Drawer=function(t){e.console.assert(t.viewer,"[Drawer] options.viewer is required");var i=arguments;if(e.isPlainObject(t)||(t={source:i[0],viewport:i[1],element:i[2]}),e.console.assert(t.viewport,"[Drawer] options.viewport is required"),e.console.assert(t.element,"[Drawer] options.element is required"),t.source&&e.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=t.viewer,this.viewport=t.viewport,this.debugGridColor="string"==typeof t.debugGridColor?[t.debugGridColor]:t.debugGridColor||e.DEFAULT_SETTINGS.debugGridColor,t.opacity&&e.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=e.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=e.getElement(t.element),this.canvas=e.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",e.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},e.Drawer.prototype={addOverlay:function(t,i,n,r){return e.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(t,i,n,r),this},updateOverlay:function(t,i,n){return e.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(t,i,n),this},removeOverlay:function(t){return e.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(t),this},clearOverlays:function(){return e.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(t){e.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(t);return this},getOpacity:function(){e.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var t=this.viewer.world,i=0,n=0;n<t.getItemCount();n++){var r=t.getItemAt(n).getOpacity();r>i&&(i=r)}return i},needsUpdate:function(){return e.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return e.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return e.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return e.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y}this._clear()}},_clear:function(e,t){if(this.useCanvas){var i=this._getContext(e);if(t)i.clearRect(t.x,t.y,t.width,t.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(t){var i=this.viewport.pixelFromPointNoRotate(t.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(t.getSize(),!0);return new e.Rect(i.x*e.pixelDensityRatio,i.y*e.pixelDensityRatio,n.x*e.pixelDensityRatio,n.y*e.pixelDensityRatio)},drawTile:function(t,i,n,r,o){if(e.console.assert(t,"[Drawer.drawTile] tile is required"),e.console.assert(i,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var s=this._getContext(n);r=r||1,t.drawCanvas(s,i,r,o)}else t.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",function e(){if(0!==n.viewport.getRotation()){n.viewer.removeHandler("rotate",e);var t=n._calculateSketchCanvasSize();n.sketchCanvas.width=t.x,n.sketchCanvas.height=t.y}})}}t=this.sketchContext}return t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()}},drawRectangle:function(e,t,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=t,n.fillRect(e.x,e.y,e.width,e.height),n.restore()}},blendSketch:function(t,i,n,r){var o=t;if(e.isPlainObject(o)||(o={opacity:t,scale:i,translate:n,compositeOperation:r}),this.useCanvas&&this.sketchCanvas){t=o.opacity,r=o.compositeOperation;var s=o.bounds;if(this.context.save(),this.context.globalAlpha=t,r&&(this.context.globalCompositeOperation=r),s)s.x<0&&(s.width+=s.x,s.x=0),s.x+s.width>this.canvas.width&&(s.width=this.canvas.width-s.x),s.y<0&&(s.height+=s.y,s.y=0),s.y+s.height>this.canvas.height&&(s.height=this.canvas.height-s.y),this.context.drawImage(this.sketchCanvas,s.x,s.y,s.width,s.height,s.x,s.y,s.width,s.height);else{i=o.scale||1;var a=(n=o.translate)instanceof e.Point?n:new e.Point(0,0),l=0,h=0;if(n){var c=this.sketchCanvas.width-this.canvas.width,u=this.sketchCanvas.height-this.canvas.height;l=Math.round(c/2),h=Math.round(u/2)}this.context.drawImage(this.sketchCanvas,a.x-l*i,a.y-h*i,(this.canvas.width+2*l)*i,(this.canvas.height+2*h)*i,-l,-h,this.canvas.width+2*l,this.canvas.height+2*h)}this.context.restore()}},drawDebugInfo:function(t,i,n,r){if(this.useCanvas){var o=this.viewer.world.getIndexOfItem(r)%this.debugGridColor.length,s=this.context;s.save(),s.lineWidth=2*e.pixelDensityRatio,s.font="small-caps bold "+13*e.pixelDensityRatio+"px arial",s.strokeStyle=this.debugGridColor[o],s.fillStyle=this.debugGridColor[o],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),r.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:r.getRotation(!0),point:r.viewport.pixelFromPointNoRotate(r._getRotationPoint(!0),!0)}),s.strokeRect(t.position.x*e.pixelDensityRatio,t.position.y*e.pixelDensityRatio,t.size.x*e.pixelDensityRatio,t.size.y*e.pixelDensityRatio);var a=(t.position.x+t.size.x/2)*e.pixelDensityRatio,l=(t.position.y+t.size.y/2)*e.pixelDensityRatio;s.translate(a,l),s.rotate(Math.PI/180*-this.viewport.degrees),s.translate(-a,-l),0===t.x&&0===t.y&&(s.fillText("Zoom: "+this.viewport.getZoom(),t.position.x*e.pixelDensityRatio,(t.position.y-30)*e.pixelDensityRatio),s.fillText("Pan: "+this.viewport.getBounds().toString(),t.position.x*e.pixelDensityRatio,(t.position.y-20)*e.pixelDensityRatio)),s.fillText("Level: "+t.level,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+20)*e.pixelDensityRatio),s.fillText("Column: "+t.x,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+30)*e.pixelDensityRatio),s.fillText("Row: "+t.y,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+40)*e.pixelDensityRatio),s.fillText("Order: "+n+" of "+i,(t.position.x+10)*e.pixelDensityRatio,(t.position.y+50)*e.pixelDensityRatio),s.fillText("Size: "+t.size.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+60)*e.pixelDensityRatio),s.fillText("Position: "+t.position.toString(),(t.position.x+10)*e.pixelDensityRatio,(t.position.y+70)*e.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),r.getRotation(!0)%360!=0&&this._restoreRotationChanges(),s.restore()}},debugRect:function(t){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*e.pixelDensityRatio,i.strokeStyle=this.debugGridColor[0],i.fillStyle=this.debugGridColor[0],i.strokeRect(t.x*e.pixelDensityRatio,t.y*e.pixelDensityRatio,t.width*e.pixelDensityRatio,t.height*e.pixelDensityRatio),i.restore()}},getCanvasSize:function(t){var i=this._getContext(t).canvas;return new e.Point(i.width,i.height)},getCanvasCenter:function(){return new e.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(t){var i=t.point?t.point.times(e.pixelDensityRatio):this.getCanvasCenter(),n=this._getContext(t.useSketch);n.save(),n.translate(i.x,i.y),n.rotate(Math.PI/180*t.degrees),n.translate(-i.x,-i.y)},_restoreRotationChanges:function(e){this._getContext(e).restore()},_calculateCanvasSize:function(){var t=e.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:i.x*t,y:i.y*t}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),function(e){e.Viewport=function(t){var i=arguments;i.length&&i[0]instanceof e.Point&&(t={containerSize:i[0],contentSize:i[1],config:i[2]}),t.config&&(e.extend(!0,t,t.config),delete t.config),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t.margins||{}),delete t.margins,e.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:e.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:e.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:e.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:e.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:e.DEFAULT_SETTINGS.maxZoomLevel,degrees:e.DEFAULT_SETTINGS.degrees,homeFillsViewer:e.DEFAULT_SETTINGS.homeFillsViewer},t),this._updateContainerInnerSize(),this.centerSpringX=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new e.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new e.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new e.Rect(0,0,1,1),1),this.goHome(!0),this.update()},e.Viewport.prototype={resetContentSize:function(t){return e.console.assert(t,"[Viewport.resetContentSize] contentSize is required"),e.console.assert(t instanceof e.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),e.console.assert(t.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),e.console.assert(t.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new e.Rect(0,0,1,t.y/t.x),t.x),this},setHomeBounds:function(t,i){e.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(t,i)},_setContentBounds:function(t,i){e.console.assert(t,"[Viewport._setContentBounds] bounds is required"),e.console.assert(t instanceof e.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),e.console.assert(t.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),e.console.assert(t.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=t.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=t.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?e>=1?e:1:e>=1?1:e)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var t=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new e.Rect(t.x-i/2,t.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e},getMaxZoom:function(){var e=this.maxZoomLevel;return e||(e=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,e/=this._contentBounds.width),Math.max(e,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new e.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return e.extend({},this._margins)},setMargins:function(t){e.console.assert("object"===e.type(t),"[Viewport.setMargins] margins must be an object"),this._margins=e.extend({left:0,top:0,right:0,bottom:0},t),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(t){var i=this.getCenter(t),n=1/this.getZoom(t),r=n/this.getAspectRatio();return new e.Rect(i.x-n/2,i.y-r/2,n,r)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(t){var i,n,r,o,s,a,l=new e.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),h=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return t?l:this.zoomPoint?(i=this.pixelFromPoint(this.zoomPoint,!0),o=(r=1/(n=this.getZoom()))/this.getAspectRatio(),s=new e.Rect(l.x-r/2,l.y-o/2,r,o),a=this._pixelFromPoint(this.zoomPoint,s).minus(i).divide(this._containerInnerSize.x*n),h.plus(a)):h},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(e){return Math.max(Math.min(e,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(t){var i=new e.Rect(t.x,t.y,t.width,t.height);if(this.wrapHorizontal);else{var n=this.visibilityRatio*i.width,r=i.x+i.width,o=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,s=this._contentBoundsNoRotate.x-r+n,a=o-i.x-n;n>this._contentBoundsNoRotate.width?i.x+=(s+a)/2:a<0?i.x+=a:s>0&&(i.x+=s)}if(this.wrapVertical);else{var l=this.visibilityRatio*i.height,h=i.y+i.height,c=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,u=this._contentBoundsNoRotate.y-h+l,d=c-i.y-l;l>this._contentBoundsNoRotate.height?i.y+=(u+d)/2:d<0?i.y+=d:u>0&&(i.y+=u)}return i},_raiseConstraintsEvent:function(e){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:e})},applyConstraints:function(e){var t=this.getZoom(),i=this._applyZoomConstraints(t);t!==i&&this.zoomTo(i,this.zoomPoint,e);var n=this.getBoundsNoRotate(),r=this._applyBoundaryConstraints(n);return this._raiseConstraintsEvent(e),(n.x!==r.x||n.y!==r.y||e)&&this.fitBounds(r.rotate(-this.getRotation()),e),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(t,i){var n=(i=i||{}).immediately||!1,r=i.constraints||!1,o=this.getAspectRatio(),s=t.getCenter(),a=new e.Rect(t.x,t.y,t.width,t.height,t.degrees+this.getRotation()).getBoundingBox();a.getAspectRatio()>=o?a.height=a.width/o:a.width=a.height*o,a.x=s.x-a.width/2,a.y=s.y-a.height/2;var l=1/a.width;if(r){var h=a.getAspectRatio(),c=this._applyZoomConstraints(l);l!==c&&(l=c,a.width=1/l,a.x=s.x-a.width/2,a.height=a.width/h,a.y=s.y-a.height/2),s=(a=this._applyBoundaryConstraints(a)).getCenter(),this._raiseConstraintsEvent(n)}if(n)return this.panTo(s,!0),this.zoomTo(l,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var u=this.getBounds(),d=this.getZoom();if(0===d||Math.abs(l/d-1)<1e-8)return this.zoomTo(l,!0),this.panTo(s,n);var p=(a=a.rotate(-this.getRotation())).getTopLeft().times(l).minus(u.getTopLeft().times(d)).divide(l-d);return this.zoomTo(l,p,n)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(t){var i=new e.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,t)},fitHorizontally:function(t){var i=new e.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,t)},getConstrainedBounds:function(e){var t;return t=this.getBounds(e),this._applyBoundaryConstraints(t)},panBy:function(t,i){var n=new e.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(t),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(t,i,n){var r=this;return this.zoomPoint=i instanceof e.Point&&!isNaN(i.x)&&!isNaN(i.y)?i:null,n?this._adjustCenterSpringsForZoomPoint(function(){r.zoomSpring.resetTo(t)}):this.zoomSpring.springTo(t),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:t,refPoint:i,immediately:n}),this},setRotation:function(t){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=e.positiveModulo(t,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:t}),this):this},getRotation:function(){return this.degrees},resize:function(e,t){var i,n=this.getBoundsNoRotate(),r=n;return this.containerSize.x=e.x,this.containerSize.y=e.y,this._updateContainerInnerSize(),t&&(i=e.x/this.containerSize.x,r.width=n.width*i,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:e,maintain:t}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new e.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var e=this;this._adjustCenterSpringsForZoomPoint(function(){e.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var t=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,t},_adjustCenterSpringsForZoomPoint:function(e){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);e();var i=this.pixelFromPoint(this.zoomPoint,!0).minus(t),n=this.deltaPointsFromPixels(i,!0);this.centerSpringX.shiftBy(n.x),this.centerSpringY.shiftBy(n.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else e()},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(t,i){return t.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new e.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(t,i){var n=this.getBoundsNoRotate(i);return t.minus(new e.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(t,i){if(t instanceof e.Point)return this.viewportToImageCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).viewportToImageCoordinates(t,i,!0)}}return this._viewportToImageDelta(t-this._contentBoundsNoRotate.x,i-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(t,i){var n=this._contentBoundsNoRotate.width;return new e.Point(t/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(t,i){if(t instanceof e.Point)return this.imageToViewportCoordinates(t.x,t.y);if(this.viewer){var n=this.viewer.world.getItemCount();if(n>1)e.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===n){return this.viewer.world.getItemAt(0).imageToViewportCoordinates(t,i,!0)}}var r=this._imageToViewportDelta(t,i);return r.x+=this._contentBoundsNoRotate.x,r.y+=this._contentBoundsNoRotate.y,r},imageToViewportRectangle:function(t,i,n,r){var o=t;if(o instanceof e.Rect||(o=new e.Rect(t,i,n,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===s){return this.viewer.world.getItemAt(0).imageToViewportRectangle(t,i,n,r,!0)}}var a=this.imageToViewportCoordinates(o.x,o.y),l=this._imageToViewportDelta(o.width,o.height);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees)},viewportToImageRectangle:function(t,i,n,r){var o=t;if(o instanceof e.Rect||(o=new e.Rect(t,i,n,r)),this.viewer){var s=this.viewer.world.getItemCount();if(s>1)e.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===s){return this.viewer.world.getItemAt(0).viewportToImageRectangle(t,i,n,r,!0)}}var a=this.viewportToImageCoordinates(o.x,o.y),l=this._viewportToImageDelta(o.width,o.height);return new e.Rect(a.x,a.y,l.x,l.y,o.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(t){return e.Rect.fromSummits(this.pointFromPixel(t.getTopLeft(),!0),this.pointFromPixel(t.getTopRight(),!0),this.pointFromPixel(t.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(t){return e.Rect.fromSummits(this.pixelFromPoint(t.getTopLeft(),!0),this.pixelFromPoint(t.getTopRight(),!0),this.pixelFromPoint(t.getBottomLeft(),!0))},windowToViewportCoordinates:function(t){e.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=t.minus(e.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(t){return e.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(t).plus(e.getElementPosition(this.viewer.element))},viewportToImageZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).viewportToImageZoom(t)}}var n=this._contentSizeNoRotate.x;return t*(this._containerInnerSize.x/n*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(t){if(this.viewer){var i=this.viewer.world.getItemCount();if(i>1)e.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===i){return this.viewer.world.getItemAt(0).imageToViewportZoom(t)}}return t*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)}}}(OpenSeadragon),function(e){function t(e,t,n,r,o,s,l,h,c){var u=l.getBoundingBox().getTopLeft(),d=l.getBoundingBox().getBottomRight();e.viewer&&e.viewer.raiseEvent("update-level",{tiledImage:e,havedrawn:t,level:r,opacity:o,visibility:s,drawArea:l,topleft:u,bottomright:d,currenttime:h,best:c}),a(e.coverage,r),a(e.loadingCoverage,r);for(var p=e._getCornerTiles(r,u,d),g=p.topLeft,m=p.bottomRight,f=e.source.getNumTiles(r),v=e.viewport.pixelFromPoint(e.viewport.getCenter()),w=g.x;w<=m.x;w++)for(var y=g.y;y<=m.y;y++){if(!e.wrapHorizontal&&!e.wrapVertical){var _=e.source.getTileBounds(r,w,y);if(null===l.intersection(_))continue}c=i(e,n,t,w,y,r,o,s,v,f,h,c)}return c}function i(t,i,r,a,l,h,c,u,d,p,g,m){var f=function(t,i,n,r,o,s,a,l,h,c){var u,d,p,g,m,f,v,w,y;s[n]||(s[n]={});s[n][t]||(s[n][t]={});s[n][t][i]||(u=(l.x+t%l.x)%l.x,d=(l.y+i%l.y)%l.y,p=o.getTileBounds(n,u,d),g=o.getTileBounds(n,u,d,!0),m=o.tileExists(n,u,d),f=o.getTileUrl(n,u,d),r.loadTilesWithAjax?(v=o.getTileAjaxHeaders(n,u,d),e.isPlainObject(r.ajaxHeaders)&&(v=e.extend({},r.ajaxHeaders,v))):v=null,w=o.getContext2D?o.getContext2D(n,u,d):void 0,p.x+=(t-u)/l.x,p.y+=c/h*((i-d)/l.y),y=new e.Tile(n,t,i,p,m,f,w,r.loadTilesWithAjax,v,g),u===l.x-1&&(y.isRightMost=!0),d===l.y-1&&(y.isBottomMost=!0),s[n][t][i]=y);return(y=s[n][t][i]).lastTouchTime=a,y}(a,l,h,t,t.source,t.tilesMatrix,g,p,t._worldWidthCurrent,t._worldHeightCurrent),v=r;t.viewer&&t.viewer.raiseEvent("update-tile",{tiledImage:t,tile:f}),s(t.coverage,h,a,l,!1);var w=f.loaded||f.loading||o(t.loadingCoverage,h,a,l);if(s(t.loadingCoverage,h,a,l,w),!f.exists)return m;if(i&&!v&&(o(t.coverage,h,a,l)?s(t.coverage,h,a,l,!0):v=!0),!v)return m;if(function(t,i,n,r,o,s){var a=t.bounds.getTopLeft();a.x*=s._scaleSpring.current.value,a.y*=s._scaleSpring.current.value,a.x+=s._xSpring.current.value,a.y+=s._ySpring.current.value;var l=t.bounds.getSize();l.x*=s._scaleSpring.current.value,l.y*=s._scaleSpring.current.value;var h=n.pixelFromPointNoRotate(a,!0),c=n.pixelFromPointNoRotate(a,!1),u=n.deltaPixelsFromPointsNoRotate(l,!0),d=n.deltaPixelsFromPointsNoRotate(l,!1),p=c.plus(d.divide(2)),g=r.squaredDistanceTo(p);i||(u=u.plus(new e.Point(1,1)));t.isRightMost&&s.wrapHorizontal&&(u.x+=.75);t.isBottomMost&&s.wrapVertical&&(u.y+=.75);t.position=h,t.size=u,t.squaredDistance=g,t.visibility=o}(f,t.source.tileOverlap,t.viewport,d,u,t),!f.loaded)if(f.context2D)n(t,f);else{var y=t._tileCache.getImageRecord(f.cacheKey);if(y)n(t,f,y.getImage())}f.loaded?function(e,t,i,n,r,o,a){var l,h,c=1e3*e.blendTime;t.blendStart||(t.blendStart=a);l=a-t.blendStart,h=c?Math.min(1,l/c):1,e.alwaysBlend&&(h*=o);if(t.opacity=h,e.lastDrawn.push(t),1==h)s(e.coverage,r,i,n,!0),e._hasOpaqueTile=!0;else if(l<c)return!0;return!1}(t,f,a,l,h,c,g)&&(t._needsDraw=!0):f.loading?t._tilesLoading++:w||(m=function(e,t){if(!e)return t;if(t.visibility>e.visibility)return t;if(t.visibility==e.visibility&&t.squaredDistance<e.squaredDistance)return t;return e}(m,f));return m}function n(e,t,i,n,r){var o=0;function s(){return o++,a}function a(){0===--o&&(t.loading=!1,t.loaded=!0,t.context2D||e._tileCache.cacheTile({image:i,tile:t,cutoff:n,tiledImage:e}),e._needsDraw=!0)}e.viewer.raiseEvent("tile-loaded",{tile:t,tiledImage:e,tileRequest:r,image:i,getCompletionCallback:s}),s()()}function r(e,t,i,n){var r,o,s,a;if(!e[t])return!1;if(void 0===i||void 0===n){for(s in r=e[t])if(r.hasOwnProperty(s))for(a in o=r[s])if(o.hasOwnProperty(a)&&!o[a])return!1;return!0}return void 0===e[t][i]||void 0===e[t][i][n]||!0===e[t][i][n]}function o(e,t,i,n){return void 0===i||void 0===n?r(e,t+1):r(e,t+1,2*i,2*n)&&r(e,t+1,2*i,2*n+1)&&r(e,t+1,2*i+1,2*n)&&r(e,t+1,2*i+1,2*n+1)}function s(t,i,n,r,o){t[i]?(t[i][n]||(t[i][n]={}),t[i][n][r]=o):e.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",i)}function a(e,t){e[t]={}}e.TiledImage=function(t){var i=this;e.console.assert(t.tileCache,"[TiledImage] options.tileCache is required"),e.console.assert(t.drawer,"[TiledImage] options.drawer is required"),e.console.assert(t.viewer,"[TiledImage] options.viewer is required"),e.console.assert(t.imageLoader,"[TiledImage] options.imageLoader is required"),e.console.assert(t.source,"[TiledImage] options.source is required"),e.console.assert(!t.clip||t.clip instanceof e.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),e.EventSource.call(this),this._tileCache=t.tileCache,delete t.tileCache,this._drawer=t.drawer,delete t.drawer,this._imageLoader=t.imageLoader,delete t.imageLoader,t.clip instanceof e.Rect&&(this._clip=t.clip.clone()),delete t.clip;var n=t.x||0;delete t.x;var r=t.y||0;delete t.y,this.normHeight=t.source.dimensions.y/t.source.dimensions.x,this.contentAspectX=t.source.dimensions.x/t.source.dimensions.y;var o=1;t.width?(o=t.width,delete t.width,t.height&&(e.console.error("specifying both width and height to a tiledImage is not supported"),delete t.height)):t.height&&(o=t.height/this.normHeight,delete t.height);var s=t.fitBounds;delete t.fitBounds;var a=t.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete t.fitBoundsPlacement;var l=t.degrees||0;delete t.degrees,e.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:e.DEFAULT_SETTINGS.springStiffness,animationTime:e.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:e.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:e.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:e.DEFAULT_SETTINGS.wrapVertical,immediateRender:e.DEFAULT_SETTINGS.immediateRender,blendTime:e.DEFAULT_SETTINGS.blendTime,alwaysBlend:e.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:e.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:e.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:e.DEFAULT_SETTINGS.iOSDevice,debugMode:e.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:e.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:e.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:e.DEFAULT_SETTINGS.placeholderFillStyle,opacity:e.DEFAULT_SETTINGS.opacity,preload:e.DEFAULT_SETTINGS.preload,compositeOperation:e.DEFAULT_SETTINGS.compositeOperation},t),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new e.Spring({initial:n,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new e.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new e.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new e.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),s&&this.fitBounds(s,a,!0),this._drawingHandler=function(t){i.viewer.raiseEvent("tile-drawing",e.extend({tiledImage:i},t))}},e.extend(e.TiledImage.prototype,e.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(e){e!==this._fullyLoaded&&(this._fullyLoaded=e,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=e.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.update(),t=this._ySpring.update(),i=this._scaleSpring.update(),n=this._degreesSpring.update();return!!(e||t||i||n)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(this.getRotation(e),this._getRotationPoint(e))},getBoundsNoRotate:function(t){return t?new e.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new e.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return e.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(t){var i=this.getBoundsNoRotate(t);if(this._clip){var n=(t?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,r=this._clip.times(n);i=new e.Rect(i.x+r.x,i.y+r.y,r.width,r.height)}return i.rotate(this.getRotation(t),this._getRotationPoint(t))},getContentSize:function(){return new e.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(t,i,n){var r=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t*(this.source.dimensions.x/r),i*(this.source.dimensions.y*this.contentAspectX/r))},viewportToImageCoordinates:function(t,i,n){var r;return t instanceof e.Point?(n=i,r=t):r=new e.Point(t,i),r=r.rotate(-this.getRotation(n),this._getRotationPoint(n)),n?this._viewportToImageDelta(r.x-this._xSpring.current.value,r.y-this._ySpring.current.value):this._viewportToImageDelta(r.x-this._xSpring.target.value,r.y-this._ySpring.target.value)},_imageToViewportDelta:function(t,i,n){var r=n?this._scaleSpring.current.value:this._scaleSpring.target.value;return new e.Point(t/this.source.dimensions.x*r,i/this.source.dimensions.y/this.contentAspectX*r)},imageToViewportCoordinates:function(t,i,n){t instanceof e.Point&&(n=i,i=t.y,t=t.x);var r=this._imageToViewportDelta(t,i);return n?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r.rotate(this.getRotation(n),this._getRotationPoint(n))},imageToViewportRectangle:function(t,i,n,r,o){var s=t;s instanceof e.Rect?o=i:s=new e.Rect(t,i,n,r);var a=this.imageToViewportCoordinates(s.getTopLeft(),o),l=this._imageToViewportDelta(s.width,s.height,o);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees+this.getRotation(o))},viewportToImageRectangle:function(t,i,n,r,o){var s=t;t instanceof e.Rect?o=i:s=new e.Rect(t,i,n,r);var a=this.viewportToImageCoordinates(s.getTopLeft(),o),l=this._viewportToImageDelta(s.width,s.height,o);return new e.Rect(a.x,a.y,l.x,l.y,s.degrees-this.getRotation(o))},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){return this.imageToViewerElementCoordinates(e).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(t){var i=this._scaleSpring.current.value;return t=t.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new e.Rect((t.x-this._xSpring.current.value)/i,(t.y-this._ySpring.current.value)/i,t.width/i,t.height/i,t.degrees)},viewportToImageZoom:function(e){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*e},imageToViewportZoom:function(e){return e/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},fitBounds:function(t,i,n){i=i||e.Placement.CENTER;var r=e.Placement.properties[i],o=this.contentAspectX,s=0,a=0,l=1,h=1;if(this._clip&&(o=this._clip.getAspectRatio(),l=this._clip.width/this.source.dimensions.x,h=this._clip.height/this.source.dimensions.y,t.getAspectRatio()>o?(s=this._clip.x/this._clip.height*t.height,a=this._clip.y/this._clip.height*t.height):(s=this._clip.x/this._clip.width*t.width,a=this._clip.y/this._clip.width*t.width)),t.getAspectRatio()>o){var c=t.height/h,u=0;r.isHorizontallyCentered?u=(t.width-t.height*o)/2:r.isRight&&(u=t.width-t.height*o),this.setPosition(new e.Point(t.x-s+u,t.y-a),n),this.setHeight(c,n)}else{var d=t.width/l,p=0;r.isVerticallyCentered?p=(t.height-t.width/o)/2:r.isBottom&&(p=t.height-t.width/o),this.setPosition(new e.Point(t.x-s,t.y-a+p),n),this.setWidth(d,n)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(t){e.console.assert(!t||t instanceof e.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),t instanceof e.Rect?this._clip=t.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(e){e!==this.opacity&&(this.opacity=e,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(e){this._preload=!!e,this._needsDraw=!0},getRotation:function(e){return e?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(e,t){this._degreesSpring.target.value===e&&this._degreesSpring.isAtTargetValue()||(t?this._degreesSpring.resetTo(e):this._degreesSpring.springTo(e),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(e){return this.getBoundsNoRotate(e).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){e!==this.compositeOperation&&(this.compositeOperation=e,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var e=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),t=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,i=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(t/this.minPixelRatio)/Math.log(2))));return{lowestLevel:e=Math.min(e,i),highestLevel:i}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;){this.lastDrawn.pop().beingDrawn=!1}var i=this.viewport,o=this._viewportToTiledImageRectangle(i.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var s=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(o=o.intersection(s)))return}for(var a=this._getLevelsInterval(),l=a.lowestLevel,h=a.highestLevel,c=null,u=!1,d=e.now(),p=h;p>=l;p--){var g=!1,m=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!0).x*this._scaleSpring.current.value;if(p===l||!u&&m>=this.minPixelRatio)g=!0,u=!0;else if(!u)continue;var f=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(p),!1).x*this._scaleSpring.current.value,v=i.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,w=this.immediateRender?1:v;if(c=t(this,u,g,p,Math.min(1,(m-.5)/.5),w/Math.abs(w-f),o,d,c),r(this.coverage,p))break}!function(t,i){if(0===t.opacity||0===i.length&&!t.placeholderFillStyle)return;var n,r,o,s=i[0];s&&(n=t.opacity<1||t.compositeOperation&&"source-over"!==t.compositeOperation||!t._isBottomItem()&&s._hasTransparencyChannel());var a,l=t.viewport.getZoom(!0),h=t.viewportToImageZoom(l);i.length>1&&h>t.smoothTileEdgesMinZoom&&!t.iOSDevice&&t.getRotation(!0)%360==0&&e.supportsCanvas&&(n=!0,r=s.getScaleForEdgeSmoothing(),o=s.getTranslationForEdgeSmoothing(r,t._drawer.getCanvasSize(!1),t._drawer.getCanvasSize(!0)));n&&(r||(a=t.viewport.viewportToViewerElementRectangle(t.getClippedBounds(!0)).getIntegerBoundingBox().times(e.pixelDensityRatio)),t._drawer._clear(!0,a));r||(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:n}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:n}));var c=!1;if(t._clip){t._drawer.saveContext(n);var u=t.imageToViewportRectangle(t._clip,!0);u=u.rotate(-t.getRotation(!0),t._getRotationPoint(!0));var d=t._drawer.viewportToDrawerRectangle(u);r&&(d=d.times(r)),o&&(d=d.translate(o)),t._drawer.setClip(d,n),c=!0}if(t.placeholderFillStyle&&!1===t._hasOpaqueTile){var p=t._drawer.viewportToDrawerRectangle(t.getBounds(!0));r&&(p=p.times(r)),o&&(p=p.translate(o));var g=null;g="function"==typeof t.placeholderFillStyle?t.placeholderFillStyle(t,t._drawer.context):t.placeholderFillStyle,t._drawer.drawRectangle(p,g,n)}for(var m=i.length-1;m>=0;m--)s=i[m],t._drawer.drawTile(s,t._drawingHandler,n,r,o),s.beingDrawn=!0,t.viewer&&t.viewer.raiseEvent("tile-drawn",{tiledImage:t,tile:s});c&&t._drawer.restoreContext(n);r||(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(n),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(n));n&&(r&&(0!==t.viewport.degrees&&t._drawer._offsetForRotation({degrees:t.viewport.degrees,useSketch:!1}),t.getRotation(!0)%360!=0&&t._drawer._offsetForRotation({degrees:t.getRotation(!0),point:t.viewport.pixelFromPointNoRotate(t._getRotationPoint(!0),!0),useSketch:!1})),t._drawer.blendSketch({opacity:t.opacity,scale:r,translate:o,compositeOperation:t.compositeOperation,bounds:a}),r&&(t.getRotation(!0)%360!=0&&t._drawer._restoreRotationChanges(!1),0!==t.viewport.degrees&&t._drawer._restoreRotationChanges(!1)));!function(t,i){if(t.debugMode)for(var n=i.length-1;n>=0;n--){var r=i[n];try{t._drawer.drawDebugInfo(r,i.length,n,t)}catch(t){e.console.error(t)}}}(t,i)}(this,this.lastDrawn),c&&!c.context2D?(!function(t,i,r){i.loading=!0,t._imageLoader.addJob({src:i.url,loadWithAjax:i.loadWithAjax,ajaxHeaders:i.ajaxHeaders,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,callback:function(o,s,a){!function(t,i,r,o,s,a){if(!o)return e.console.log("Tile %s failed to load: %s - error: %s",i,i.url,s),t.viewer.raiseEvent("tile-load-failed",{tile:i,tiledImage:t,time:r,message:s,tileRequest:a}),i.loading=!1,void(i.exists=!1);if(r<t.lastResetTime)return e.console.log("Ignoring tile %s loaded before reset: %s",i,i.url),void(i.loading=!1);var l=function(){var e=t.source.getClosestLevel();n(t,i,o,e,a)};t._midDraw?window.setTimeout(l,1):l()}(t,i,r,o,s,a)},abort:function(){i.loading=!1}})}(this,c,d),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(t,i,n){var r,o,s,a;this.wrapHorizontal?(r=e.positiveModulo(i.x,1),o=e.positiveModulo(n.x,1)):(r=Math.max(0,i.x),o=Math.min(1,n.x));var l=1/this.source.aspectRatio;this.wrapVertical?(s=e.positiveModulo(i.y,l),a=e.positiveModulo(n.y,l)):(s=Math.max(0,i.y),a=Math.min(l,n.y));var h=this.source.getTileAtPoint(t,new e.Point(r,s)),c=this.source.getTileAtPoint(t,new e.Point(o,a)),u=this.source.getNumTiles(t);return this.wrapHorizontal&&(h.x+=u.x*Math.floor(i.x),c.x+=u.x*Math.floor(n.x)),this.wrapVertical&&(h.y+=u.y*Math.floor(i.y/l),c.y+=u.y*Math.floor(n.y/l)),{topLeft:h,bottomRight:c}}})}(OpenSeadragon),function(e){var t=function(t){e.console.assert(t,"[ImageRecord] options is required"),e.console.assert(t.image,"[ImageRecord] options.image is required"),this._image=t.image,this._tiles=[]};t.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(t){e.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=t},addTile:function(t){e.console.assert(t,"[ImageRecord.addTile] tile is required"),this._tiles.push(t)},removeTile:function(t){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===t)return void this._tiles.splice(i,1);e.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",t)},getTileCount:function(){return this._tiles.length}},e.TileCache=function(t){t=t||{},this._maxImageCacheCount=t.maxImageCacheCount||e.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},e.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(i){e.console.assert(i,"[TileCache.cacheTile] options is required"),e.console.assert(i.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(i.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),e.console.assert(i.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var n=i.cutoff||0,r=this._tilesLoaded.length,o=this._imagesLoaded[i.tile.cacheKey];if(o||(e.console.assert(i.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),o=this._imagesLoaded[i.tile.cacheKey]=new t({image:i.image}),this._imagesLoadedCount++),o.addTile(i.tile),i.tile.cacheImageRecord=o,this._imagesLoadedCount>this._maxImageCacheCount){for(var s,a,l,h,c,u,d=null,p=-1,g=null,m=this._tilesLoaded.length-1;m>=0;m--)(s=(u=this._tilesLoaded[m]).tile).level<=n||s.beingDrawn||(d?(h=s.lastTouchTime,a=d.lastTouchTime,c=s.level,l=d.level,(h<a||h==a&&c>l)&&(d=s,p=m,g=u)):(d=s,p=m,g=u));d&&p>=0&&(this._unloadTile(g),r=p)}this._tilesLoaded[r]=new function(t){e.console.assert(t,"[TileCache.cacheTile] options is required"),e.console.assert(t.tile,"[TileCache.cacheTile] options.tile is required"),e.console.assert(t.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=t.tile,this.tiledImage=t.tiledImage}({tile:i.tile,tiledImage:i.tiledImage})},clearTilesFor:function(t){var i;e.console.assert(t,"[TileCache.clearTilesFor] tiledImage is required");for(var n=0;n<this._tilesLoaded.length;++n)(i=this._tilesLoaded[n]).tiledImage===t&&(this._unloadTile(i),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(t){return e.console.assert(t,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[t]},_unloadTile:function(t){e.console.assert(t,"[TileCache._unloadTile] tileRecord is required");var i=t.tile,n=t.tiledImage;i.unload(),i.cacheImageRecord=null;var r=this._imagesLoaded[i.cacheKey];r.removeTile(i),r.getTileCount()||(r.destroy(),delete this._imagesLoaded[i.cacheKey],this._imagesLoadedCount--),n.viewer.raiseEvent("tile-unloaded",{tile:i,tiledImage:n})}}}(OpenSeadragon),function(e){e.World=function(t){var i=this;e.console.assert(t.viewer,"[World] options.viewer is required"),e.EventSource.call(this),this.viewer=t.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(e){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},e.extend(e.World.prototype,e.EventSource.prototype,{addItem:function(t,i){if(e.console.assert(t,"[World.addItem] item is required"),e.console.assert(t instanceof e.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(i=i||{}).index){var n=Math.max(0,Math.min(this._items.length,i.index));this._items.splice(n,0,t)}else this._items.push(t);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,t.addHandler("bounds-change",this._delegatedFigureSizes),t.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:t})},getItemAt:function(t){return e.console.assert(void 0!==t,"[World.getItemAt] index is required"),this._items[t]},getIndexOfItem:function(t){return e.console.assert(t,"[World.getIndexOfItem] item is required"),e.indexOf(this._items,t)},getItemCount:function(){return this._items.length},setItemIndex:function(t,i){e.console.assert(t,"[World.setItemIndex] item is required"),e.console.assert(void 0!==i,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(t);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,t),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:t,previousIndex:n,newIndex:i}))},removeItem:function(t){e.console.assert(t,"[World.removeItem] item is required");var i=e.indexOf(this._items,t);-1!==i&&(t.removeHandler("bounds-change",this._delegatedFigureSizes),t.removeHandler("clip-change",this._delegatedFigureSizes),t.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(t))},removeAll:function(){var e,t;for(this.viewer._cancelPendingImages(),t=0;t<this._items.length;t++)(e=this._items[t]).removeHandler("bounds-change",this._delegatedFigureSizes),e.removeHandler("clip-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(t){var i,n=(t=t||{}).immediately||!1,r=t.layout||e.DEFAULT_SETTINGS.collectionLayout,o=t.rows||e.DEFAULT_SETTINGS.collectionRows,s=t.columns||e.DEFAULT_SETTINGS.collectionColumns,a=t.tileSize||e.DEFAULT_SETTINGS.collectionTileSize,l=a+(t.tileMargin||e.DEFAULT_SETTINGS.collectionTileMargin);i=!t.rows&&s?s:Math.ceil(this._items.length/o);var h,c,u,d,p,g=0,m=0;this.setAutoRefigureSizes(!1);for(var f=0;f<this._items.length;f++)f&&f%i==0&&("horizontal"===r?(m+=l,g=0):(g+=l,m=0)),d=(u=(c=(h=this._items[f]).getBounds()).width>c.height?a:a*(c.width/c.height))*(c.height/c.width),p=new e.Point(g+(a-u)/2,m+(a-d)/2),h.setPosition(p,n),h.setWidth(u,n),"horizontal"===r?g+=l:m+=l;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var t=this._homeBounds?this._homeBounds.clone():null,i=this._contentSize?this._contentSize.clone():null,n=this._contentFactor||0;if(this._items.length){var r=this._items[0],o=r.getBounds();this._contentFactor=r.getContentSize().x/o.width;for(var s=r.getClippedBounds().getBoundingBox(),a=s.x,l=s.y,h=s.x+s.width,c=s.y+s.height,u=1;u<this._items.length;u++)o=(r=this._items[u]).getBounds(),this._contentFactor=Math.max(this._contentFactor,r.getContentSize().x/o.width),s=r.getClippedBounds().getBoundingBox(),a=Math.min(a,s.x),l=Math.min(l,s.y),h=Math.max(h,s.x+s.width),c=Math.max(c,s.y+s.height);this._homeBounds=new e.Rect(a,l,h-a,c-l),this._contentSize=new e.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new e.Rect(0,0,1,1),this._contentSize=new e.Point(1,1),this._contentFactor=1;this._contentFactor===n&&this._homeBounds.equals(t)&&this._contentSize.equals(i)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon)},function(e,t,i){"use strict";var n=function(e){return e.many_channel_active},r=function(e){for(var t=0;t<e.getItemCount();t++){var i=e.getItemAt(t).source;if(n(i))return i}};function o(e,t,i,n){var r=e.querySelector("canvas"),o=r.getContext("2d"),s=o.createLinearGradient(0,0,r.width,0);s.addColorStop(0,"rgba(0,0,0,1)"),s.addColorStop(i,"rgba(0,0,0,1)");var a="rgba("+t.map(function(e){return Math.round(255*e)}).join()+",1)";s.addColorStop(n,a),s.addColorStop(1,a),o.fillStyle=s,o.fillRect(0,0,r.width,r.height)}function s(e){var t=e.target.parentNode,i=t.querySelectorAll("input"),n=parseFloat(i[0].value),s=parseFloat(i[1].value);if(n>=s)e.target==i[0]?i[1].value=n+.02:i[0].value=s-.02;else{var a=r(this.world);a.many_channel_range=[n,s],o(t,a.many_channel_color,n,s);for(var l=0;l<this.world.getItemCount();l++){this.world.getItemAt(l)._needsDraw=!0}this.world.update()}}window.attach_color_events=function(e,t){for(var i=e.querySelectorAll("input"),r=t.tileSources.filter(n)[0],a=r.many_channel_color,l=r.many_channel_range,h=0;h<i.length;h++){var c=i[h];c.value=l[h],c.oninput=s.bind(t)}a=r.many_channel_color,l=r.many_channel_range;o.apply(void 0,[e,a].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(l)))}},function(e,t,i){"use strict";e.exports=function(e,t,i,n){var r={many_channel_color:e.many_channel_color,many_channel_range:e.many_channel_range,many_channel_id:e.many_channel_id,many_channel_active:n,many_channel_bitdepth:8};return"image"==i?(r.buildPyramid=!1,r.type="image",r.url=t,r):(r.getTileUrl=function(e,t,i){var n=this.maxLevel-e,r=this.many_channel_id;return this.many_channel_url+"/"+("C"+r+"-T0-Z0-L"+n+"-Y"+i+"-X"+t+".png")},r.many_channel_url=t,r.tileSize=1024,r.height=4080,r.width=7220,r.minLevel=0,r.maxLevel=3,r)}},function(e,t,i){"use strict";var n=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,r=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(i.push(s.value),!t||i.length!==t);n=!0);}catch(e){r=!0,o=e}finally{try{!n&&a.return&&a.return()}finally{if(r)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=i(9),o=function(e){var t=e.split(","),i=n(t,4),r=i[0],o=i[1],s=i[2],a=i[3];return{many_channel_id:parseInt(r),many_channel_range:[s,a].map(parseFloat),many_channel_color:[parseInt(o.substr(0,2),16)/255,parseInt(o.substr(2,2),16)/255,parseInt(o.substr(4,2),16)/255]}};window.read_source_list=function(e){var t=window.location.hash.slice(2);t=t||"0,FF0000,0,1/1,00FF00,0,1";var i=e.query||"",s=window.location.search.slice(1);return""!=s&&(i+="&"+s),function(e,t){if(""==e)return[];var i="custom",s=0,a={};return t.split("&").forEach(function(e){var t=e.split("="),r=n(t,2),o=r[0],l=r[1];"active"==o&&(s=parseInt(l)),"type"==o&&(i=l),"src"==o.slice(-3)&&(parseInt(o)?a[parseInt(o)]=l:a.src=l)}),e.split("/").map(o).map(function(e,t){var n=a[t]||a.src;return r(e,n,i,t==s)})}(t,i)}},function(e,t,i){"use strict";e.exports=function(e){var t=!1,i="type=image&0src=images/bw_red.png&1src=images/bw_green.png",n=e.split("/")[1];return 0==n.indexOf("many-channel-osd")&&(i="src=/minerva-test-images/png_tiles"),"dev"==n.split("-").pop()&&(t=!0),{query:i,debug:t}}},function(e,t){ViaWebGL=function(e){this["gl-drawing"]=function(e){return e},this["gl-loaded"]=function(e){return e},this.ready=function(e){return e};var t=this.maker();for(var i in this.flat=document.createElement("canvas").getContext("2d"),this.vShader="vShader.glsl",this.fShader="fShader.glsl",this.wrap=t.CLAMP_TO_EDGE,this.filter=t.NEAREST,this.height=128,this.width=128,this.on=0,this.gl=t,e)this[i]=e[i]},ViaWebGL.prototype={init:function(e){this.ready;this.hasOwnProperty("container")&&this.hasOwnProperty("onclick")&&(this.container.onclick=this[this.onclick].bind(this)),e&&e.height&&e.width&&(this.ready=this.toCanvas.bind(this,e),this.height=e.height,this.width=e.width),this.source=e,this.updateShape(this.height,this.width);var t=[[this.vShader,this.fShader].map(this.getter)];return t.push(this.toProgram.bind(this),this.toBuffers.bind(this)),Promise.all(t[0]).then(t[1]).then(t[2]).then(this.ready)},updateShape:function(e,t){this.width=e,this.height=t,this.gl.canvas.width=e,this.gl.canvas.height=t,this.gl.viewport(0,0,this.width,this.height)},maker:function(e){return this.context(document.createElement("canvas"))},context:function(e){return e.getContext("webgl2")},getter:function(e){return new Promise(function(t){if("glsl"!=e.slice(-4))return t(e);var i=new XMLHttpRequest;i.open("GET",e,!0),i.onerror=i.onload=function(){return 200==i.status?t(i.response):t(e)},i.send()})},toProgram:function(e){var t=this.gl,i=t.createProgram(),n=function(e,i,n,r){return t["get"+e+"Parameter"](n,t[i+"_STATUS"])||console.log((r||"LINK")+":\n"+t["get"+e+"InfoLog"](n)),n};return e.map(function(e,r){var o=["VERTEX_SHADER","FRAGMENT_SHADER"][r],s=t.createShader(t[o]);t.shaderSource(s,e),t.compileShader(s),t.attachShader(i,s),n("Shader","COMPILE",s,o)}),t.linkProgram(i),n("Program","LINK",i)},toBuffers:function(e){this.gl.useProgram(e),this["gl-loaded"].call(this,e);var t=new Float32Array([-1,1,-1,-1,1,1,1,-1].concat([0,1,0,0,1,1,1,0])),i=this.gl,n=2*t.BYTES_PER_ELEMENT,r=i.getUniformLocation(e,"u_tile_size"),o=i.getUniformLocation(e,"u_tile"),s=i.getUniformLocation(e,"u8");i.uniform2f(r,i.canvas.height,i.canvas.width),i.uniform1i(o,0),i.uniform1ui(s,255),this.att=["a_pos","a_tile_pos"].map(function(t,r){var o=i.getAttribLocation(e,t),s=4*r*n;return[o,2,i.FLOAT,0,n,s]}),this.tex={texParameteri:[[i.TEXTURE_2D,i.TEXTURE_WRAP_T,this.wrap],[i.TEXTURE_2D,i.TEXTURE_WRAP_S,this.wrap],[i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,this.filter],[i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.filter]],bindTexture:[i.TEXTURE_2D,i.createTexture()],drawArrays:[i.TRIANGLE_STRIP,0,4]},i.bindBuffer(i.ARRAY_BUFFER,i.createBuffer()),i.bufferData(i.ARRAY_BUFFER,t,i.STATIC_DRAW)},loadArray:function(e,t,i){this.updateShape(e,t),this["gl-drawing"].call(this);var n=this.gl;this.att.map(function(e){n.enableVertexAttribArray(e.slice(0,1)),n.vertexAttribPointer.apply(n,e)}),n.activeTexture(n.TEXTURE0),n.bindTexture.apply(n,this.tex.bindTexture),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,1),n.pixelStorei(n.UNPACK_ALIGNMENT,1),this.tex.texParameteri.map(function(e){n.texParameteri.apply(n,e)});var r=[n.TEXTURE_2D,0,n.RG8UI,this.width,this.height,0,n.RG_INTEGER,n.UNSIGNED_BYTE,i];return n.texImage2D.apply(n,r),n.drawArrays.apply(n,this.tex.drawArrays),this.container&&this.container.appendChild(this.gl.canvas),this.gl.canvas},toggle:function(){this.on++,this.container.innerHTML="",this.container.appendChild(this.toCanvas(this.source))}}},function(e,t){openSeadragonGL=function(e){this.io={"tile-loaded":function(e){new Promise(function(t,i){var n=window.UPNG.decode(e.image._array);0==n.ctype&&16==n.depth&&(n.data=n.data.slice(0,2*n.width*n.height),e.tile._array=n.data),t()}).then(e.getCompletionCallback())},"tile-drawing":function(e){var t=e.rendered.canvas.width,i=e.rendered.canvas.height,n=this.viaGL.loadArray(t,i,e.tile._array);e.rendered.drawImage(n,0,0)}},this.defaults={"tile-loaded":function(e,t){e(t)},"tile-drawing":function(e,t){1!==t.tile.loaded&&(t.tile.loaded=1,e(t))}},this.openSD=e,this.viaGL=new ViaWebGL},openSeadragonGL.prototype={init:function(){var e=this.merger.bind(this);return this.openSD.addHandler("open",e),this},addHandler:function(e,t){e in this.defaults&&(this[e]=this.defaults[e]),"function"==typeof t&&(this[e]=t)},merger:function(e){for(var t of(this.width=this.openSD.source.getTileWidth(),this.height=this.openSD.source.getTileHeight(),this.and(this.viaGL)))this.viaGL[t]=this[t];this.viaGL.init().then(this.adder.bind(this))},adder:function(){var e=this;this.openSD.addHandler("tile-loaded",function(t){var i=e.io["tile-loaded"].bind(e);e["tile-loaded"].call(e,i,t)}),this.openSD.addHandler("tile-drawing",function(t){var i=e.io["tile-drawing"].bind(e);e["tile-drawing"].call(e,i,t)});for(var t=this.openSD.world,i=0;i<t.getItemCount();i++){t.getItemAt(i)._needsDraw=!0}this.openSD.world.update()},and:function(e){return Object.keys(e).filter(Object.hasOwnProperty,this)},button:function(e){var t=e.name||"tool",i=e.prefix||this.openSD.prefixUrl;e.hasOwnProperty("onClick")||(e.onClick=this.shade),e.onClick=e.onClick.bind(this),e.srcRest=e.srcRest||i+t+"_rest.png",e.srcHover=e.srcHover||i+t+"_hover.png",e.srcDown=e.srcDown||i+t+"_pressed.png",e.srcGroup=e.srcGroup||i+t+"_grouphover.png",this.openSD.clearControls().buttons.buttons.push(new OpenSeadragon.Button(e));var n=new OpenSeadragon.ButtonGroup({buttons:this.openSD.buttons.buttons});this.openSD.addControl(n.element,{anchor:OpenSeadragon.ControlAnchor.TOP_LEFT})},shade:function(){this.viaGL.on++,this.openSD.world.resetItems()}}},function(e,t,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,i){"use strict";var n=i(0),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,i,l,h,c,u,d){var p,g,m,f,v,w,y,_,T,x=d.bits,S=0,b=0,E=0,P=0,R=0,C=0,k=0,I=0,O=0,z=0,B=null,D=0,A=new n.Buf16(16),L=new n.Buf16(16),M=null,H=0;for(S=0;S<=15;S++)A[S]=0;for(b=0;b<l;b++)A[t[i+b]]++;for(R=x,P=15;P>=1&&0===A[P];P--);if(R>P&&(R=P),0===P)return h[c++]=20971520,h[c++]=20971520,d.bits=1,0;for(E=1;E<P&&0===A[E];E++);for(R<E&&(R=E),I=1,S=1;S<=15;S++)if(I<<=1,(I-=A[S])<0)return-1;if(I>0&&(0===e||1!==P))return-1;for(L[1]=0,S=1;S<15;S++)L[S+1]=L[S]+A[S];for(b=0;b<l;b++)0!==t[i+b]&&(u[L[t[i+b]]++]=b);if(0===e?(B=M=u,w=19):1===e?(B=r,D-=257,M=o,H-=257,w=256):(B=s,M=a,w=-1),z=0,b=0,S=E,v=c,C=R,k=0,m=-1,f=(O=1<<R)-1,1===e&&O>852||2===e&&O>592)return 1;for(;;){y=S-k,u[b]<w?(_=0,T=u[b]):u[b]>w?(_=M[H+u[b]],T=B[D+u[b]]):(_=96,T=0),p=1<<S-k,E=g=1<<C;do{h[v+(z>>k)+(g-=p)]=y<<24|_<<16|T|0}while(0!==g);for(p=1<<S-1;z&p;)p>>=1;if(0!==p?(z&=p-1,z+=p):z=0,b++,0==--A[S]){if(S===P)break;S=t[i+u[b]]}if(S>R&&(z&f)!==m){for(0===k&&(k=R),v+=E,I=1<<(C=S-k);C+k<P&&!((I-=A[C+k])<=0);)C++,I<<=1;if(O+=1<<C,1===e&&O>852||2===e&&O>592)return 1;h[m=z&f]=R<<24|C<<16|v-c|0}}return 0!==z&&(h[v+z]=S-k<<24|64<<16|0),d.bits=R,0}},function(e,t,i){"use strict";e.exports=function(e,t){var i,n,r,o,s,a,l,h,c,u,d,p,g,m,f,v,w,y,_,T,x,S,b,E,P;i=e.state,n=e.next_in,E=e.input,r=n+(e.avail_in-5),o=e.next_out,P=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),l=i.dmax,h=i.wsize,c=i.whave,u=i.wnext,d=i.window,p=i.hold,g=i.bits,m=i.lencode,f=i.distcode,v=(1<<i.lenbits)-1,w=(1<<i.distbits)-1;e:do{g<15&&(p+=E[n++]<<g,g+=8,p+=E[n++]<<g,g+=8),y=m[p&v];t:for(;;){if(p>>>=_=y>>>24,g-=_,0===(_=y>>>16&255))P[o++]=65535&y;else{if(!(16&_)){if(0==(64&_)){y=m[(65535&y)+(p&(1<<_)-1)];continue t}if(32&_){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}T=65535&y,(_&=15)&&(g<_&&(p+=E[n++]<<g,g+=8),T+=p&(1<<_)-1,p>>>=_,g-=_),g<15&&(p+=E[n++]<<g,g+=8,p+=E[n++]<<g,g+=8),y=f[p&w];i:for(;;){if(p>>>=_=y>>>24,g-=_,!(16&(_=y>>>16&255))){if(0==(64&_)){y=f[(65535&y)+(p&(1<<_)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(x=65535&y,g<(_&=15)&&(p+=E[n++]<<g,(g+=8)<_&&(p+=E[n++]<<g,g+=8)),(x+=p&(1<<_)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=_,g-=_,x>(_=o-s)){if((_=x-_)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(S=0,b=d,0===u){if(S+=h-_,_<T){T-=_;do{P[o++]=d[S++]}while(--_);S=o-x,b=P}}else if(u<_){if(S+=h+u-_,(_-=u)<T){T-=_;do{P[o++]=d[S++]}while(--_);if(S=0,u<T){T-=_=u;do{P[o++]=d[S++]}while(--_);S=o-x,b=P}}}else if(S+=u-_,_<T){T-=_;do{P[o++]=d[S++]}while(--_);S=o-x,b=P}for(;T>2;)P[o++]=b[S++],P[o++]=b[S++],P[o++]=b[S++],T-=3;T&&(P[o++]=b[S++],T>1&&(P[o++]=b[S++]))}else{S=o-x;do{P[o++]=P[S++],P[o++]=P[S++],P[o++]=P[S++],T-=3}while(T>2);T&&(P[o++]=P[S++],T>1&&(P[o++]=P[S++]))}break}}break}}while(n<r&&o<a);n-=T=g>>3,p&=(1<<(g-=T<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=o<a?a-o+257:257-(o-a),i.hold=p,i.bits=g}},function(e,t,i){"use strict";var n=i(0),r=i(6),o=i(5),s=i(16),a=i(15),l=0,h=1,c=2,u=4,d=5,p=6,g=0,m=1,f=2,v=-2,w=-3,y=-4,_=-5,T=8,x=1,S=2,b=3,E=4,P=5,R=6,C=7,k=8,I=9,O=10,z=11,B=12,D=13,A=14,L=15,M=16,H=17,F=18,N=19,U=20,W=21,V=22,G=23,j=24,q=25,Z=26,$=27,X=28,K=29,Y=30,Q=31,J=32,ee=852,te=592,ie=15;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function re(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=x,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,g):v}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,re(e)):v}function se(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?v:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,oe(e))):v}function ae(e,t){var i,r;return e?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=r,r.window=null,(i=se(e,t))!==g&&(e.state=null),i):v}var le,he,ce=!0;function ue(e){if(ce){var t;for(le=new n.Buf32(512),he=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(a(h,e.lens,0,288,le,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;a(c,e.lens,0,32,he,0,e.work,{bits:5}),ce=!1}e.lencode=le,e.lenbits=9,e.distcode=he,e.distbits=5}function de(e,t,i,r){var o,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new n.Buf8(s.wsize)),r>=s.wsize?(n.arraySet(s.window,t,i-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):((o=s.wsize-s.wnext)>r&&(o=r),n.arraySet(s.window,t,i-r,o,s.wnext),(r-=o)?(n.arraySet(s.window,t,i-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=o,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=o))),0}t.inflateReset=oe,t.inflateReset2=se,t.inflateResetKeep=re,t.inflateInit=function(e){return ae(e,ie)},t.inflateInit2=ae,t.inflate=function(e,t){var i,ee,te,ie,re,oe,se,ae,le,he,ce,pe,ge,me,fe,ve,we,ye,_e,Te,xe,Se,be,Ee,Pe=0,Re=new n.Buf8(4),Ce=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return v;(i=e.state).mode===B&&(i.mode=D),re=e.next_out,te=e.output,se=e.avail_out,ie=e.next_in,ee=e.input,oe=e.avail_in,ae=i.hold,le=i.bits,he=oe,ce=se,Se=g;e:for(;;)switch(i.mode){case x:if(0===i.wrap){i.mode=D;break}for(;le<16;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(2&i.wrap&&35615===ae){i.check=0,Re[0]=255&ae,Re[1]=ae>>>8&255,i.check=o(i.check,Re,2,0),ae=0,le=0,i.mode=S;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&ae)<<8)+(ae>>8))%31){e.msg="incorrect header check",i.mode=Y;break}if((15&ae)!==T){e.msg="unknown compression method",i.mode=Y;break}if(le-=4,xe=8+(15&(ae>>>=4)),0===i.wbits)i.wbits=xe;else if(xe>i.wbits){e.msg="invalid window size",i.mode=Y;break}i.dmax=1<<xe,e.adler=i.check=1,i.mode=512&ae?O:B,ae=0,le=0;break;case S:for(;le<16;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(i.flags=ae,(255&i.flags)!==T){e.msg="unknown compression method",i.mode=Y;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Y;break}i.head&&(i.head.text=ae>>8&1),512&i.flags&&(Re[0]=255&ae,Re[1]=ae>>>8&255,i.check=o(i.check,Re,2,0)),ae=0,le=0,i.mode=b;case b:for(;le<32;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}i.head&&(i.head.time=ae),512&i.flags&&(Re[0]=255&ae,Re[1]=ae>>>8&255,Re[2]=ae>>>16&255,Re[3]=ae>>>24&255,i.check=o(i.check,Re,4,0)),ae=0,le=0,i.mode=E;case E:for(;le<16;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}i.head&&(i.head.xflags=255&ae,i.head.os=ae>>8),512&i.flags&&(Re[0]=255&ae,Re[1]=ae>>>8&255,i.check=o(i.check,Re,2,0)),ae=0,le=0,i.mode=P;case P:if(1024&i.flags){for(;le<16;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}i.length=ae,i.head&&(i.head.extra_len=ae),512&i.flags&&(Re[0]=255&ae,Re[1]=ae>>>8&255,i.check=o(i.check,Re,2,0)),ae=0,le=0}else i.head&&(i.head.extra=null);i.mode=R;case R:if(1024&i.flags&&((pe=i.length)>oe&&(pe=oe),pe&&(i.head&&(xe=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,ee,ie,pe,xe)),512&i.flags&&(i.check=o(i.check,ee,pe,ie)),oe-=pe,ie+=pe,i.length-=pe),i.length))break e;i.length=0,i.mode=C;case C:if(2048&i.flags){if(0===oe)break e;pe=0;do{xe=ee[ie+pe++],i.head&&xe&&i.length<65536&&(i.head.name+=String.fromCharCode(xe))}while(xe&&pe<oe);if(512&i.flags&&(i.check=o(i.check,ee,pe,ie)),oe-=pe,ie+=pe,xe)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=k;case k:if(4096&i.flags){if(0===oe)break e;pe=0;do{xe=ee[ie+pe++],i.head&&xe&&i.length<65536&&(i.head.comment+=String.fromCharCode(xe))}while(xe&&pe<oe);if(512&i.flags&&(i.check=o(i.check,ee,pe,ie)),oe-=pe,ie+=pe,xe)break e}else i.head&&(i.head.comment=null);i.mode=I;case I:if(512&i.flags){for(;le<16;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(ae!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Y;break}ae=0,le=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=B;break;case O:for(;le<32;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}e.adler=i.check=ne(ae),ae=0,le=0,i.mode=z;case z:if(0===i.havedict)return e.next_out=re,e.avail_out=se,e.next_in=ie,e.avail_in=oe,i.hold=ae,i.bits=le,f;e.adler=i.check=1,i.mode=B;case B:if(t===d||t===p)break e;case D:if(i.last){ae>>>=7&le,le-=7&le,i.mode=$;break}for(;le<3;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}switch(i.last=1&ae,le-=1,3&(ae>>>=1)){case 0:i.mode=A;break;case 1:if(ue(i),i.mode=U,t===p){ae>>>=2,le-=2;break e}break;case 2:i.mode=H;break;case 3:e.msg="invalid block type",i.mode=Y}ae>>>=2,le-=2;break;case A:for(ae>>>=7&le,le-=7&le;le<32;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if((65535&ae)!=(ae>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Y;break}if(i.length=65535&ae,ae=0,le=0,i.mode=L,t===p)break e;case L:i.mode=M;case M:if(pe=i.length){if(pe>oe&&(pe=oe),pe>se&&(pe=se),0===pe)break e;n.arraySet(te,ee,ie,pe,re),oe-=pe,ie+=pe,se-=pe,re+=pe,i.length-=pe;break}i.mode=B;break;case H:for(;le<14;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(i.nlen=257+(31&ae),ae>>>=5,le-=5,i.ndist=1+(31&ae),ae>>>=5,le-=5,i.ncode=4+(15&ae),ae>>>=4,le-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Y;break}i.have=0,i.mode=F;case F:for(;i.have<i.ncode;){for(;le<3;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}i.lens[Ce[i.have++]]=7&ae,ae>>>=3,le-=3}for(;i.have<19;)i.lens[Ce[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,be={bits:i.lenbits},Se=a(l,i.lens,0,19,i.lencode,0,i.work,be),i.lenbits=be.bits,Se){e.msg="invalid code lengths set",i.mode=Y;break}i.have=0,i.mode=N;case N:for(;i.have<i.nlen+i.ndist;){for(;ve=(Pe=i.lencode[ae&(1<<i.lenbits)-1])>>>16&255,we=65535&Pe,!((fe=Pe>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(we<16)ae>>>=fe,le-=fe,i.lens[i.have++]=we;else{if(16===we){for(Ee=fe+2;le<Ee;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(ae>>>=fe,le-=fe,0===i.have){e.msg="invalid bit length repeat",i.mode=Y;break}xe=i.lens[i.have-1],pe=3+(3&ae),ae>>>=2,le-=2}else if(17===we){for(Ee=fe+3;le<Ee;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}le-=fe,xe=0,pe=3+(7&(ae>>>=fe)),ae>>>=3,le-=3}else{for(Ee=fe+7;le<Ee;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}le-=fe,xe=0,pe=11+(127&(ae>>>=fe)),ae>>>=7,le-=7}if(i.have+pe>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Y;break}for(;pe--;)i.lens[i.have++]=xe}}if(i.mode===Y)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Y;break}if(i.lenbits=9,be={bits:i.lenbits},Se=a(h,i.lens,0,i.nlen,i.lencode,0,i.work,be),i.lenbits=be.bits,Se){e.msg="invalid literal/lengths set",i.mode=Y;break}if(i.distbits=6,i.distcode=i.distdyn,be={bits:i.distbits},Se=a(c,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,be),i.distbits=be.bits,Se){e.msg="invalid distances set",i.mode=Y;break}if(i.mode=U,t===p)break e;case U:i.mode=W;case W:if(oe>=6&&se>=258){e.next_out=re,e.avail_out=se,e.next_in=ie,e.avail_in=oe,i.hold=ae,i.bits=le,s(e,ce),re=e.next_out,te=e.output,se=e.avail_out,ie=e.next_in,ee=e.input,oe=e.avail_in,ae=i.hold,le=i.bits,i.mode===B&&(i.back=-1);break}for(i.back=0;ve=(Pe=i.lencode[ae&(1<<i.lenbits)-1])>>>16&255,we=65535&Pe,!((fe=Pe>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(ve&&0==(240&ve)){for(ye=fe,_e=ve,Te=we;ve=(Pe=i.lencode[Te+((ae&(1<<ye+_e)-1)>>ye)])>>>16&255,we=65535&Pe,!(ye+(fe=Pe>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}ae>>>=ye,le-=ye,i.back+=ye}if(ae>>>=fe,le-=fe,i.back+=fe,i.length=we,0===ve){i.mode=Z;break}if(32&ve){i.back=-1,i.mode=B;break}if(64&ve){e.msg="invalid literal/length code",i.mode=Y;break}i.extra=15&ve,i.mode=V;case V:if(i.extra){for(Ee=i.extra;le<Ee;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}i.length+=ae&(1<<i.extra)-1,ae>>>=i.extra,le-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=G;case G:for(;ve=(Pe=i.distcode[ae&(1<<i.distbits)-1])>>>16&255,we=65535&Pe,!((fe=Pe>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(0==(240&ve)){for(ye=fe,_e=ve,Te=we;ve=(Pe=i.distcode[Te+((ae&(1<<ye+_e)-1)>>ye)])>>>16&255,we=65535&Pe,!(ye+(fe=Pe>>>24)<=le);){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}ae>>>=ye,le-=ye,i.back+=ye}if(ae>>>=fe,le-=fe,i.back+=fe,64&ve){e.msg="invalid distance code",i.mode=Y;break}i.offset=we,i.extra=15&ve,i.mode=j;case j:if(i.extra){for(Ee=i.extra;le<Ee;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}i.offset+=ae&(1<<i.extra)-1,ae>>>=i.extra,le-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Y;break}i.mode=q;case q:if(0===se)break e;if(pe=ce-se,i.offset>pe){if((pe=i.offset-pe)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Y;break}pe>i.wnext?(pe-=i.wnext,ge=i.wsize-pe):ge=i.wnext-pe,pe>i.length&&(pe=i.length),me=i.window}else me=te,ge=re-i.offset,pe=i.length;pe>se&&(pe=se),se-=pe,i.length-=pe;do{te[re++]=me[ge++]}while(--pe);0===i.length&&(i.mode=W);break;case Z:if(0===se)break e;te[re++]=i.length,se--,i.mode=W;break;case $:if(i.wrap){for(;le<32;){if(0===oe)break e;oe--,ae|=ee[ie++]<<le,le+=8}if(ce-=se,e.total_out+=ce,i.total+=ce,ce&&(e.adler=i.check=i.flags?o(i.check,te,ce,re-ce):r(i.check,te,ce,re-ce)),ce=se,(i.flags?ae:ne(ae))!==i.check){e.msg="incorrect data check",i.mode=Y;break}ae=0,le=0}i.mode=X;case X:if(i.wrap&&i.flags){for(;le<32;){if(0===oe)break e;oe--,ae+=ee[ie++]<<le,le+=8}if(ae!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Y;break}ae=0,le=0}i.mode=K;case K:Se=m;break e;case Y:Se=w;break e;case Q:return y;case J:default:return v}return e.next_out=re,e.avail_out=se,e.next_in=ie,e.avail_in=oe,i.hold=ae,i.bits=le,(i.wsize||ce!==e.avail_out&&i.mode<Y&&(i.mode<$||t!==u))&&de(e,e.output,e.next_out,ce-e.avail_out)?(i.mode=Q,y):(he-=e.avail_in,ce-=e.avail_out,e.total_in+=he,e.total_out+=ce,i.total+=ce,i.wrap&&ce&&(e.adler=i.check=i.flags?o(i.check,te,ce,e.next_out-ce):r(i.check,te,ce,e.next_out-ce)),e.data_type=i.bits+(i.last?64:0)+(i.mode===B?128:0)+(i.mode===U||i.mode===L?256:0),(0===he&&0===ce||t===u)&&Se===g&&(Se=_),Se)},t.inflateEnd=function(e){if(!e||!e.state)return v;var t=e.state;return t.window&&(t.window=null),e.state=null,g},t.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?v:(i.head=t,t.done=!1,g):v},t.inflateSetDictionary=function(e,t){var i,n=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==z?v:i.mode===z&&r(1,t,n,0)!==i.check?w:de(e,t,n,n)?(i.mode=Q,y):(i.havedict=1,g):v},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,i){"use strict";var n=i(17),r=i(0),o=i(4),s=i(2),a=i(1),l=i(3),h=i(14),c=Object.prototype.toString;function u(e){if(!(this instanceof u))return new u(e);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,t.windowBits);if(i!==s.Z_OK)throw new Error(a[i]);this.header=new h,n.inflateGetHeader(this.strm,this.header)}function d(e,t){var i=new u(t);if(i.push(e,!0),i.err)throw i.msg||a[i.err];return i.result}u.prototype.push=function(e,t){var i,a,l,h,u,d,p=this.strm,g=this.options.chunkSize,m=this.options.dictionary,f=!1;if(this.ended)return!1;a=t===~~t?t:!0===t?s.Z_FINISH:s.Z_NO_FLUSH,"string"==typeof e?p.input=o.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new r.Buf8(g),p.next_out=0,p.avail_out=g),(i=n.inflate(p,s.Z_NO_FLUSH))===s.Z_NEED_DICT&&m&&(d="string"==typeof m?o.string2buf(m):"[object ArrayBuffer]"===c.call(m)?new Uint8Array(m):m,i=n.inflateSetDictionary(this.strm,d)),i===s.Z_BUF_ERROR&&!0===f&&(i=s.Z_OK,f=!1),i!==s.Z_STREAM_END&&i!==s.Z_OK)return this.onEnd(i),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&i!==s.Z_STREAM_END&&(0!==p.avail_in||a!==s.Z_FINISH&&a!==s.Z_SYNC_FLUSH)||("string"===this.options.to?(l=o.utf8border(p.output,p.next_out),h=p.next_out-l,u=o.buf2string(p.output,l),p.next_out=h,p.avail_out=g-h,h&&r.arraySet(p.output,p.output,l,h,0),this.onData(u)):this.onData(r.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(f=!0)}while((p.avail_in>0||0===p.avail_out)&&i!==s.Z_STREAM_END);return i===s.Z_STREAM_END&&(a=s.Z_FINISH),a===s.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===s.Z_OK):a!==s.Z_SYNC_FLUSH||(this.onEnd(s.Z_OK),p.avail_out=0,!0)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===s.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=u,t.inflate=d,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,d(e,t)},t.ungzip=d},function(e,t,i){"use strict";var n=i(0),r=4,o=0,s=1,a=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var h=0,c=1,u=2,d=29,p=256,g=p+1+d,m=30,f=19,v=2*g+1,w=15,y=16,_=7,T=256,x=16,S=17,b=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],P=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],R=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(2*(g+2));l(k);var I=new Array(2*m);l(I);var O=new Array(512);l(O);var z=new Array(256);l(z);var B=new Array(d);l(B);var D,A,L,M=new Array(m);function H(e,t,i,n,r){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=r,this.has_stree=e&&e.length}function F(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function N(e){return e<256?O[e]:O[256+(e>>>7)]}function U(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function W(e,t,i){e.bi_valid>y-i?(e.bi_buf|=t<<e.bi_valid&65535,U(e,e.bi_buf),e.bi_buf=t>>y-e.bi_valid,e.bi_valid+=i-y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function V(e,t,i){W(e,i[2*t],i[2*t+1])}function G(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function j(e,t,i){var n,r,o=new Array(w+1),s=0;for(n=1;n<=w;n++)o[n]=s=s+i[n-1]<<1;for(r=0;r<=t;r++){var a=e[2*r+1];0!==a&&(e[2*r]=G(o[a]++,a))}}function q(e){var t;for(t=0;t<g;t++)e.dyn_ltree[2*t]=0;for(t=0;t<m;t++)e.dyn_dtree[2*t]=0;for(t=0;t<f;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*T]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Z(e){e.bi_valid>8?U(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function $(e,t,i,n){var r=2*t,o=2*i;return e[r]<e[o]||e[r]===e[o]&&n[t]<=n[i]}function X(e,t,i){for(var n=e.heap[i],r=i<<1;r<=e.heap_len&&(r<e.heap_len&&$(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!$(t,n,e.heap[r],e.depth));)e.heap[i]=e.heap[r],i=r,r<<=1;e.heap[i]=n}function K(e,t,i){var n,r,o,s,a=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],r=e.pending_buf[e.l_buf+a],a++,0===n?V(e,r,t):(V(e,(o=z[r])+p+1,t),0!==(s=E[o])&&W(e,r-=B[o],s),V(e,o=N(--n),i),0!==(s=P[o])&&W(e,n-=M[o],s))}while(a<e.last_lit);V(e,T,t)}function Y(e,t){var i,n,r,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,h=-1;for(e.heap_len=0,e.heap_max=v,i=0;i<l;i++)0!==o[2*i]?(e.heap[++e.heap_len]=h=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=h<2?++h:0)]=1,e.depth[r]=0,e.opt_len--,a&&(e.static_len-=s[2*r+1]);for(t.max_code=h,i=e.heap_len>>1;i>=1;i--)X(e,o,i);r=l;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],X(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=n,o[2*r]=o[2*i]+o[2*n],e.depth[r]=(e.depth[i]>=e.depth[n]?e.depth[i]:e.depth[n])+1,o[2*i+1]=o[2*n+1]=r,e.heap[1]=r++,X(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,n,r,o,s,a,l=t.dyn_tree,h=t.max_code,c=t.stat_desc.static_tree,u=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,g=t.stat_desc.max_length,m=0;for(o=0;o<=w;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<v;i++)(o=l[2*l[2*(n=e.heap[i])+1]+1]+1)>g&&(o=g,m++),l[2*n+1]=o,n>h||(e.bl_count[o]++,s=0,n>=p&&(s=d[n-p]),a=l[2*n],e.opt_len+=a*(o+s),u&&(e.static_len+=a*(c[2*n+1]+s)));if(0!==m){do{for(o=g-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[g]--,m-=2}while(m>0);for(o=g;0!==o;o--)for(n=e.bl_count[o];0!==n;)(r=e.heap[--i])>h||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),n--)}}(e,t),j(o,h,e.bl_count)}function Q(e,t,i){var n,r,o=-1,s=t[1],a=0,l=7,h=4;for(0===s&&(l=138,h=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)r=s,s=t[2*(n+1)+1],++a<l&&r===s||(a<h?e.bl_tree[2*r]+=a:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*x]++):a<=10?e.bl_tree[2*S]++:e.bl_tree[2*b]++,a=0,o=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4))}function J(e,t,i){var n,r,o=-1,s=t[1],a=0,l=7,h=4;for(0===s&&(l=138,h=3),n=0;n<=i;n++)if(r=s,s=t[2*(n+1)+1],!(++a<l&&r===s)){if(a<h)do{V(e,r,e.bl_tree)}while(0!=--a);else 0!==r?(r!==o&&(V(e,r,e.bl_tree),a--),V(e,x,e.bl_tree),W(e,a-3,2)):a<=10?(V(e,S,e.bl_tree),W(e,a-3,3)):(V(e,b,e.bl_tree),W(e,a-11,7));a=0,o=r,0===s?(l=138,h=3):r===s?(l=6,h=3):(l=7,h=4)}}l(M);var ee=!1;function te(e,t,i,r){W(e,(h<<1)+(r?1:0),3),function(e,t,i,r){Z(e),r&&(U(e,i),U(e,~i)),n.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}t._tr_init=function(e){ee||(function(){var e,t,i,n,r,o=new Array(w+1);for(i=0,n=0;n<d-1;n++)for(B[n]=i,e=0;e<1<<E[n];e++)z[i++]=n;for(z[i-1]=n,r=0,n=0;n<16;n++)for(M[n]=r,e=0;e<1<<P[n];e++)O[r++]=n;for(r>>=7;n<m;n++)for(M[n]=r<<7,e=0;e<1<<P[n]-7;e++)O[256+r++]=n;for(t=0;t<=w;t++)o[t]=0;for(e=0;e<=143;)k[2*e+1]=8,e++,o[8]++;for(;e<=255;)k[2*e+1]=9,e++,o[9]++;for(;e<=279;)k[2*e+1]=7,e++,o[7]++;for(;e<=287;)k[2*e+1]=8,e++,o[8]++;for(j(k,g+1,o),e=0;e<m;e++)I[2*e+1]=5,I[2*e]=G(e,5);D=new H(k,E,p+1,g,w),A=new H(I,P,0,m,w),L=new H(new Array(0),R,0,f,_)}(),ee=!0),e.l_desc=new F(e.dyn_ltree,D),e.d_desc=new F(e.dyn_dtree,A),e.bl_desc=new F(e.bl_tree,L),e.bi_buf=0,e.bi_valid=0,q(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,i,n){var l,h,d=0;e.level>0?(e.strm.data_type===a&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return s;for(t=32;t<p;t++)if(0!==e.dyn_ltree[2*t])return s;return o}(e)),Y(e,e.l_desc),Y(e,e.d_desc),d=function(e){var t;for(Q(e,e.dyn_ltree,e.l_desc.max_code),Q(e,e.dyn_dtree,e.d_desc.max_code),Y(e,e.bl_desc),t=f-1;t>=3&&0===e.bl_tree[2*C[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),l=e.opt_len+3+7>>>3,(h=e.static_len+3+7>>>3)<=l&&(l=h)):l=h=i+5,i+4<=l&&-1!==t?te(e,t,i,n):e.strategy===r||h===l?(W(e,(c<<1)+(n?1:0),3),K(e,k,I)):(W(e,(u<<1)+(n?1:0),3),function(e,t,i,n){var r;for(W(e,t-257,5),W(e,i-1,5),W(e,n-4,4),r=0;r<n;r++)W(e,e.bl_tree[2*C[r]+1],3);J(e,e.dyn_ltree,t-1),J(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,d+1),K(e,e.dyn_ltree,e.dyn_dtree)),q(e),n&&Z(e)},t._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(z[i]+p+1)]++,e.dyn_dtree[2*N(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){W(e,c<<1,3),V(e,T,k),function(e){16===e.bi_valid?(U(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,i){"use strict";var n,r=i(0),o=i(19),s=i(6),a=i(5),l=i(1),h=0,c=1,u=3,d=4,p=5,g=0,m=1,f=-2,v=-3,w=-5,y=-1,_=1,T=2,x=3,S=4,b=0,E=2,P=8,R=9,C=15,k=8,I=286,O=30,z=19,B=2*I+1,D=15,A=3,L=258,M=L+A+1,H=32,F=42,N=69,U=73,W=91,V=103,G=113,j=666,q=1,Z=2,$=3,X=4,K=3;function Y(e,t){return e.msg=l[t],t}function Q(e){return(e<<1)-(e>4?9:0)}function J(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(r.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function te(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ie(e,t){e.pending_buf[e.pending++]=t}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function re(e,t){var i,n,r=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-M?e.strstart-(e.w_size-M):0,h=e.window,c=e.w_mask,u=e.prev,d=e.strstart+L,p=h[o+s-1],g=h[o+s];e.prev_length>=e.good_match&&(r>>=2),a>e.lookahead&&(a=e.lookahead);do{if(h[(i=t)+s]===g&&h[i+s-1]===p&&h[i]===h[o]&&h[++i]===h[o+1]){o+=2,i++;do{}while(h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&h[++o]===h[++i]&&o<d);if(n=L-(d-o),o=d-L,n>s){if(e.match_start=t,s=n,n>=a)break;p=h[o+s-1],g=h[o+s]}}}while((t=u[t&c])>l&&0!=--r);return s<=e.lookahead?s:e.lookahead}function oe(e){var t,i,n,o,l,h,c,u,d,p,g=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=g+(g-M)){r.arraySet(e.window,e.window,g,g,0),e.match_start-=g,e.strstart-=g,e.block_start-=g,t=i=e.hash_size;do{n=e.head[--t],e.head[t]=n>=g?n-g:0}while(--i);t=i=g;do{n=e.prev[--t],e.prev[t]=n>=g?n-g:0}while(--i);o+=g}if(0===e.strm.avail_in)break;if(h=e.strm,c=e.window,u=e.strstart+e.lookahead,d=o,p=void 0,(p=h.avail_in)>d&&(p=d),i=0===p?0:(h.avail_in-=p,r.arraySet(c,h.input,h.next_in,p,u),1===h.state.wrap?h.adler=s(h.adler,c,p,u):2===h.state.wrap&&(h.adler=a(h.adler,c,p,u)),h.next_in+=p,h.total_in+=p,p),e.lookahead+=i,e.lookahead+e.insert>=A)for(l=e.strstart-e.insert,e.ins_h=e.window[l],e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[l+A-1])&e.hash_mask,e.prev[l&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=l,l++,e.insert--,!(e.lookahead+e.insert<A)););}while(e.lookahead<M&&0!==e.strm.avail_in)}function se(e,t){for(var i,n;;){if(e.lookahead<M){if(oe(e),e.lookahead<M&&t===h)return q;if(0===e.lookahead)break}if(i=0,e.lookahead>=A&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+A-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-M&&(e.match_length=re(e,i)),e.match_length>=A)if(n=o._tr_tally(e,e.strstart-e.match_start,e.match_length-A),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=A){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+A-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=e.strstart<A-1?e.strstart:A-1,t===d?(te(e,!0),0===e.strm.avail_out?$:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:Z}function ae(e,t){for(var i,n,r;;){if(e.lookahead<M){if(oe(e),e.lookahead<M&&t===h)return q;if(0===e.lookahead)break}if(i=0,e.lookahead>=A&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+A-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=A-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-M&&(e.match_length=re(e,i),e.match_length<=5&&(e.strategy===_||e.match_length===A&&e.strstart-e.match_start>4096)&&(e.match_length=A-1)),e.prev_length>=A&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-A,n=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-A),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+A-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=A-1,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return q}else if(e.match_available){if((n=o._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return q}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<A-1?e.strstart:A-1,t===d?(te(e,!0),0===e.strm.avail_out?$:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:Z}function le(e,t,i,n,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=r}function he(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=E,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?F:G,e.adler=2===t.wrap?0:1,t.last_flush=h,o._tr_init(t),g):Y(e,f)}function ce(e){var t,i=he(e);return i===g&&((t=e.state).window_size=2*t.w_size,J(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=A-1,t.match_available=0,t.ins_h=0),i}function ue(e,t,i,n,o,s){if(!e)return f;var a=1;if(t===y&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),o<1||o>R||i!==P||n<8||n>15||t<0||t>9||s<0||s>S)return Y(e,f);8===n&&(n=9);var l=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=P,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*B),this.dyn_dtree=new r.Buf16(2*(2*O+1)),this.bl_tree=new r.Buf16(2*(2*z+1)),J(this.dyn_ltree),J(this.dyn_dtree),J(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(D+1),this.heap=new r.Buf16(2*I+1),J(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*I+1),J(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=l,l.strm=e,l.wrap=a,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+A-1)/A),l.window=new r.Buf8(2*l.w_size),l.head=new r.Buf16(l.hash_size),l.prev=new r.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new r.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=s,l.method=i,ce(e)}n=[new le(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(oe(e),0===e.lookahead&&t===h)return q;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,te(e,!1),0===e.strm.avail_out))return q;if(e.strstart-e.block_start>=e.w_size-M&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?$:X):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),q)}),new le(4,4,8,4,se),new le(4,5,16,8,se),new le(4,6,32,32,se),new le(4,4,16,16,ae),new le(8,16,32,32,ae),new le(8,16,128,128,ae),new le(8,32,128,256,ae),new le(32,128,258,1024,ae),new le(32,258,258,4096,ae)],t.deflateInit=function(e,t){return ue(e,t,P,C,k,b)},t.deflateInit2=ue,t.deflateReset=ce,t.deflateResetKeep=he,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?f:(e.state.gzhead=t,g):f},t.deflate=function(e,t){var i,r,s,l;if(!e||!e.state||t>p||t<0)return e?Y(e,f):f;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===j&&t!==d)return Y(e,0===e.avail_out?w:f);if(r.strm=e,i=r.last_flush,r.last_flush=t,r.status===F)if(2===r.wrap)e.adler=0,ie(r,31),ie(r,139),ie(r,8),r.gzhead?(ie(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),ie(r,255&r.gzhead.time),ie(r,r.gzhead.time>>8&255),ie(r,r.gzhead.time>>16&255),ie(r,r.gzhead.time>>24&255),ie(r,9===r.level?2:r.strategy>=T||r.level<2?4:0),ie(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(ie(r,255&r.gzhead.extra.length),ie(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=a(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=N):(ie(r,0),ie(r,0),ie(r,0),ie(r,0),ie(r,0),ie(r,9===r.level?2:r.strategy>=T||r.level<2?4:0),ie(r,K),r.status=G);else{var v=P+(r.w_bits-8<<4)<<8;v|=(r.strategy>=T||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(v|=H),v+=31-v%31,r.status=G,ne(r,v),0!==r.strstart&&(ne(r,e.adler>>>16),ne(r,65535&e.adler)),e.adler=1}if(r.status===N)if(r.gzhead.extra){for(s=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>s&&(e.adler=a(e.adler,r.pending_buf,r.pending-s,s)),ee(e),s=r.pending,r.pending!==r.pending_buf_size));)ie(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>s&&(e.adler=a(e.adler,r.pending_buf,r.pending-s,s)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=U)}else r.status=U;if(r.status===U)if(r.gzhead.name){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=a(e.adler,r.pending_buf,r.pending-s,s)),ee(e),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,ie(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(e.adler=a(e.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.gzindex=0,r.status=W)}else r.status=W;if(r.status===W)if(r.gzhead.comment){s=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>s&&(e.adler=a(e.adler,r.pending_buf,r.pending-s,s)),ee(e),s=r.pending,r.pending===r.pending_buf_size)){l=1;break}l=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,ie(r,l)}while(0!==l);r.gzhead.hcrc&&r.pending>s&&(e.adler=a(e.adler,r.pending_buf,r.pending-s,s)),0===l&&(r.status=V)}else r.status=V;if(r.status===V&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&ee(e),r.pending+2<=r.pending_buf_size&&(ie(r,255&e.adler),ie(r,e.adler>>8&255),e.adler=0,r.status=G)):r.status=G),0!==r.pending){if(ee(e),0===e.avail_out)return r.last_flush=-1,g}else if(0===e.avail_in&&Q(t)<=Q(i)&&t!==d)return Y(e,w);if(r.status===j&&0!==e.avail_in)return Y(e,w);if(0!==e.avail_in||0!==r.lookahead||t!==h&&r.status!==j){var y=r.strategy===T?function(e,t){for(var i;;){if(0===e.lookahead&&(oe(e),0===e.lookahead)){if(t===h)return q;break}if(e.match_length=0,i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?$:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:Z}(r,t):r.strategy===x?function(e,t){for(var i,n,r,s,a=e.window;;){if(e.lookahead<=L){if(oe(e),e.lookahead<=L&&t===h)return q;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=A&&e.strstart>0&&(n=a[r=e.strstart-1])===a[++r]&&n===a[++r]&&n===a[++r]){s=e.strstart+L;do{}while(n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&n===a[++r]&&r<s);e.match_length=L-(s-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=A?(i=o._tr_tally(e,1,e.match_length-A),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(te(e,!1),0===e.strm.avail_out))return q}return e.insert=0,t===d?(te(e,!0),0===e.strm.avail_out?$:X):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?q:Z}(r,t):n[r.level].func(r,t);if(y!==$&&y!==X||(r.status=j),y===q||y===$)return 0===e.avail_out&&(r.last_flush=-1),g;if(y===Z&&(t===c?o._tr_align(r):t!==p&&(o._tr_stored_block(r,0,0,!1),t===u&&(J(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),ee(e),0===e.avail_out))return r.last_flush=-1,g}return t!==d?g:r.wrap<=0?m:(2===r.wrap?(ie(r,255&e.adler),ie(r,e.adler>>8&255),ie(r,e.adler>>16&255),ie(r,e.adler>>24&255),ie(r,255&e.total_in),ie(r,e.total_in>>8&255),ie(r,e.total_in>>16&255),ie(r,e.total_in>>24&255)):(ne(r,e.adler>>>16),ne(r,65535&e.adler)),ee(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?g:m)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==F&&t!==N&&t!==U&&t!==W&&t!==V&&t!==G&&t!==j?Y(e,f):(e.state=null,t===G?Y(e,v):g):f},t.deflateSetDictionary=function(e,t){var i,n,o,a,l,h,c,u,d=t.length;if(!e||!e.state)return f;if(2===(a=(i=e.state).wrap)||1===a&&i.status!==F||i.lookahead)return f;for(1===a&&(e.adler=s(e.adler,t,d,0)),i.wrap=0,d>=i.w_size&&(0===a&&(J(i.head),i.strstart=0,i.block_start=0,i.insert=0),u=new r.Buf8(i.w_size),r.arraySet(u,t,d-i.w_size,i.w_size,0),t=u,d=i.w_size),l=e.avail_in,h=e.next_in,c=e.input,e.avail_in=d,e.next_in=0,e.input=t,oe(i);i.lookahead>=A;){n=i.strstart,o=i.lookahead-(A-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+A-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--o);i.strstart=n,i.lookahead=A-1,oe(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=A-1,i.match_available=0,e.next_in=h,e.input=c,e.avail_in=l,i.wrap=a,g},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,i){"use strict";var n=i(20),r=i(0),o=i(4),s=i(1),a=i(3),l=Object.prototype.toString,h=0,c=-1,u=0,d=8;function p(e){if(!(this instanceof p))return new p(e);this.options=r.assign({level:c,method:d,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==h)throw new Error(s[i]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var g;if(g="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===l.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=n.deflateSetDictionary(this.strm,g))!==h)throw new Error(s[i]);this._dict_set=!0}}function g(e,t){var i=new p(t);if(i.push(e,!0),i.err)throw i.msg||s[i.err];return i.result}p.prototype.push=function(e,t){var i,s,a=this.strm,c=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?4:0,"string"==typeof e?a.input=o.string2buf(e):"[object ArrayBuffer]"===l.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(c),a.next_out=0,a.avail_out=c),1!==(i=n.deflate(a,s))&&i!==h)return this.onEnd(i),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==i);return 4===s?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==s||(this.onEnd(h),a.avail_out=0,!0)},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=p,t.deflate=g,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,g(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,g(e,t)}},function(e,t,i){"use strict";var n={};(0,i(0).assign)(n,i(21),i(18),i(2)),e.exports=n},function(e,t){var i,n,r=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(i===setTimeout)return setTimeout(e,0);if((i===o||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:o}catch(e){i=o}try{n="function"==typeof clearTimeout?clearTimeout:s}catch(e){n=s}}();var l,h=[],c=!1,u=-1;function d(){c&&l&&(c=!1,l.length?h=l.concat(h):u=-1,h.length&&p())}function p(){if(!c){var e=a(d);c=!0;for(var t=h.length;t;){for(l=h,h=[];++u<t;)l&&l[u].run();u=-1,t=h.length}l=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function m(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];h.push(new g(e,t)),1!==h.length||c||a(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=m,r.addListener=m,r.once=m,r.off=m,r.removeListener=m,r.removeAllListeners=m,r.emit=m,r.prependListener=m,r.prependOnceListener=m,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},function(e,t,i){(function(t){!function(){var t={};e.exports=t,function(e,t){e.toRGBA8=function(t){var i=t.width,n=t.height;if(null==t.tabs.acTL)return[e.toRGBA8.decodeImage(t.data,i,n,t).buffer];var r=[];null==t.frames[0].data&&(t.frames[0].data=t.data);for(var o,s=new Uint8Array(i*n*4),a=0;a<t.frames.length;a++){var l=t.frames[a],h=l.rect.x,c=l.rect.y,u=l.rect.width,d=l.rect.height,p=e.toRGBA8.decodeImage(l.data,u,d,t);if(0==a?o=p:0==l.blend?e._copyTile(p,u,d,o,i,n,h,c,0):1==l.blend&&e._copyTile(p,u,d,o,i,n,h,c,1),r.push(o.buffer),o=o.slice(0),0==l.dispose);else if(1==l.dispose)e._copyTile(s,u,d,o,i,n,h,c,0);else if(2==l.dispose){for(var g=a-1;2==t.frames[g].dispose;)g--;o=new Uint8Array(r[g]).slice(0)}}return r},e.toRGBA8.decodeImage=function(t,i,n,r){var o=i*n,s=e.decode._getBPP(r),a=Math.ceil(i*s/8),l=new Uint8Array(4*o),h=new Uint32Array(l.buffer),c=r.ctype,u=r.depth,d=e._bin.readUshort;if(6==c){var p=o<<2;if(8==u)for(var g=0;g<p;g++)l[g]=t[g];if(16==u)for(g=0;g<p;g++)l[g]=t[g<<1]}else if(2==c){var m=r.tabs.tRNS,f=-1,v=-1,w=-1;if(m&&(f=m[0],v=m[1],w=m[2]),8==u)for(g=0;g<o;g++){var y=3*g;l[P=g<<2]=t[y],l[P+1]=t[y+1],l[P+2]=t[y+2],l[P+3]=255,-1!=f&&t[y]==f&&t[y+1]==v&&t[y+2]==w&&(l[P+3]=0)}if(16==u)for(g=0;g<o;g++){y=6*g;l[P=g<<2]=t[y],l[P+1]=t[y+2],l[P+2]=t[y+4],l[P+3]=255,-1!=f&&d(t,y)==f&&d(t,y+2)==v&&d(t,y+4)==w&&(l[P+3]=0)}}else if(3==c){var _=r.tabs.PLTE,T=r.tabs.tRNS,x=T?T.length:0;if(1==u)for(var S=0;S<n;S++){var b=S*a,E=S*i;for(g=0;g<i;g++){var P=E+g<<2,R=3*(C=t[b+(g>>3)]>>7-((7&g)<<0)&1);l[P]=_[R],l[P+1]=_[R+1],l[P+2]=_[R+2],l[P+3]=C<x?T[C]:255}}if(2==u)for(S=0;S<n;S++)for(b=S*a,E=S*i,g=0;g<i;g++){P=E+g<<2,R=3*(C=t[b+(g>>2)]>>6-((3&g)<<1)&3);l[P]=_[R],l[P+1]=_[R+1],l[P+2]=_[R+2],l[P+3]=C<x?T[C]:255}if(4==u)for(S=0;S<n;S++)for(b=S*a,E=S*i,g=0;g<i;g++){P=E+g<<2,R=3*(C=t[b+(g>>1)]>>4-((1&g)<<2)&15);l[P]=_[R],l[P+1]=_[R+1],l[P+2]=_[R+2],l[P+3]=C<x?T[C]:255}if(8==u)for(g=0;g<o;g++){var C;P=g<<2,R=3*(C=t[g]);l[P]=_[R],l[P+1]=_[R+1],l[P+2]=_[R+2],l[P+3]=C<x?T[C]:255}}else if(4==c){if(8==u)for(g=0;g<o;g++){P=g<<2;var k=t[I=g<<1];l[P]=k,l[P+1]=k,l[P+2]=k,l[P+3]=t[I+1]}if(16==u)for(g=0;g<o;g++){var I;P=g<<2,k=t[I=g<<2];l[P]=k,l[P+1]=k,l[P+2]=k,l[P+3]=t[I+2]}}else if(0==c){f=r.tabs.tRNS?r.tabs.tRNS:-1;if(1==u)for(g=0;g<o;g++){var O=(k=255*(t[g>>3]>>7-(7&g)&1))==255*f?0:255;h[g]=O<<24|k<<16|k<<8|k}if(2==u)for(g=0;g<o;g++){O=(k=85*(t[g>>2]>>6-((3&g)<<1)&3))==85*f?0:255;h[g]=O<<24|k<<16|k<<8|k}if(4==u)for(g=0;g<o;g++){O=(k=17*(t[g>>1]>>4-((1&g)<<2)&15))==17*f?0:255;h[g]=O<<24|k<<16|k<<8|k}if(8==u)for(g=0;g<o;g++){O=(k=t[g])==f?0:255;h[g]=O<<24|k<<16|k<<8|k}if(16==u)for(g=0;g<o;g++){k=t[g<<1],O=d(t,g<<1)==f?0:255;h[g]=O<<24|k<<16|k<<8|k}}return l},e.decode=function(t){for(var i,n=new Uint8Array(t),r=8,o=e._bin,s=o.readUshort,a=o.readUint,l={tabs:{},frames:[]},h=new Uint8Array(n.length),c=0,u=0,d=[137,80,78,71,13,10,26,10],p=0;p<8;p++)if(n[p]!=d[p])throw"The input is not a PNG file!";for(;r<n.length;){var g=o.readUint(n,r);r+=4;var m=o.readASCII(n,r,4);if(r+=4,"IHDR"==m)e.decode._IHDR(n,r,l);else if("IDAT"==m){for(p=0;p<g;p++)h[c+p]=n[r+p];c+=g}else if("acTL"==m)l.tabs[m]={num_frames:a(n,r),num_plays:a(n,r+4)},i=new Uint8Array(n.length);else if("fcTL"==m){var f;if(0!=u)(f=l.frames[l.frames.length-1]).data=e.decode._decompress(l,i.slice(0,u),f.rect.width,f.rect.height),u=0;var v={x:a(n,r+12),y:a(n,r+16),width:a(n,r+4),height:a(n,r+8)},w=s(n,r+22);w=s(n,r+20)/(0==w?100:w);var y={rect:v,delay:Math.round(1e3*w),dispose:n[r+24],blend:n[r+25]};l.frames.push(y)}else if("fdAT"==m){for(p=0;p<g-4;p++)i[u+p]=n[r+p+4];u+=g-4}else if("pHYs"==m)l.tabs[m]=[o.readUint(n,r),o.readUint(n,r+4),n[r+8]];else if("cHRM"==m){l.tabs[m]=[];for(p=0;p<8;p++)l.tabs[m].push(o.readUint(n,r+4*p))}else if("tEXt"==m){null==l.tabs[m]&&(l.tabs[m]={});var _=o.nextZero(n,r),T=o.readASCII(n,r,_-r),x=o.readASCII(n,_+1,r+g-_-1);l.tabs[m][T]=x}else if("iTXt"==m){null==l.tabs[m]&&(l.tabs[m]={});_=0;var S=r;_=o.nextZero(n,S);T=o.readASCII(n,S,_-S),n[S=_+1],n[S+1];S+=2,_=o.nextZero(n,S);o.readASCII(n,S,_-S);S=_+1,_=o.nextZero(n,S);o.readUTF8(n,S,_-S);S=_+1;x=o.readUTF8(n,S,g-(S-r));l.tabs[m][T]=x}else if("PLTE"==m)l.tabs[m]=o.readBytes(n,r,g);else if("hIST"==m){var b=l.tabs.PLTE.length/3;l.tabs[m]=[];for(p=0;p<b;p++)l.tabs[m].push(s(n,r+2*p))}else if("tRNS"==m)3==l.ctype?l.tabs[m]=o.readBytes(n,r,g):0==l.ctype?l.tabs[m]=s(n,r):2==l.ctype&&(l.tabs[m]=[s(n,r),s(n,r+2),s(n,r+4)]);else if("gAMA"==m)l.tabs[m]=o.readUint(n,r)/1e5;else if("sRGB"==m)l.tabs[m]=n[r];else if("bKGD"==m)0==l.ctype||4==l.ctype?l.tabs[m]=[s(n,r)]:2==l.ctype||6==l.ctype?l.tabs[m]=[s(n,r),s(n,r+2),s(n,r+4)]:3==l.ctype&&(l.tabs[m]=n[r]);else if("IEND"==m)break;r+=g;o.readUint(n,r);r+=4}0!=u&&((f=l.frames[l.frames.length-1]).data=e.decode._decompress(l,i.slice(0,u),f.rect.width,f.rect.height),u=0);return l.data=e.decode._decompress(l,h,l.width,l.height),delete l.compress,delete l.interlace,delete l.filter,l},e.decode._decompress=function(t,i,n,r){return 0==t.compress&&(i=e.decode._inflate(i)),0==t.interlace?i=e.decode._filterZero(i,t,0,n,r):1==t.interlace&&(i=e.decode._readInterlace(i,t)),i},e.decode._inflate=function(e){return t.inflate(e)},e.decode._readInterlace=function(t,i){for(var n=i.width,r=i.height,o=e.decode._getBPP(i),s=o>>3,a=Math.ceil(n*o/8),l=new Uint8Array(r*a),h=0,c=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],d=[8,8,8,4,4,2,2],p=[8,8,4,4,2,2,1],g=0;g<7;){for(var m=d[g],f=p[g],v=0,w=0,y=c[g];y<r;)y+=m,w++;for(var _=u[g];_<n;)_+=f,v++;var T=Math.ceil(v*o/8);e.decode._filterZero(t,i,h,v,w);for(var x=0,S=c[g];S<r;){for(var b=u[g],E=h+x*T<<3;b<n;){var P;if(1==o)P=(P=t[E>>3])>>7-(7&E)&1,l[S*a+(b>>3)]|=P<<7-((3&b)<<0);if(2==o)P=(P=t[E>>3])>>6-(7&E)&3,l[S*a+(b>>2)]|=P<<6-((3&b)<<1);if(4==o)P=(P=t[E>>3])>>4-(7&E)&15,l[S*a+(b>>1)]|=P<<4-((1&b)<<2);if(o>=8)for(var R=S*a+b*s,C=0;C<s;C++)l[R+C]=t[(E>>3)+C];E+=o,b+=f}x++,S+=m}v*w!=0&&(h+=w*(1+T)),g+=1}return l},e.decode._getBPP=function(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth},e.decode._filterZero=function(t,i,n,r,o){var s=e.decode._getBPP(i),a=Math.ceil(r*s/8),l=e.decode._paeth;s=Math.ceil(s/8);for(var h=0;h<o;h++){var c=n+h*a,u=c+h+1,d=t[u-1];if(0==d)for(var p=0;p<a;p++)t[c+p]=t[u+p];else if(1==d){for(p=0;p<s;p++)t[c+p]=t[u+p];for(p=s;p<a;p++)t[c+p]=t[u+p]+t[c+p-s]&255}else if(0==h){for(p=0;p<s;p++)t[c+p]=t[u+p];if(2==d)for(p=s;p<a;p++)t[c+p]=255&t[u+p];if(3==d)for(p=s;p<a;p++)t[c+p]=t[u+p]+(t[c+p-s]>>1)&255;if(4==d)for(p=s;p<a;p++)t[c+p]=t[u+p]+l(t[c+p-s],0,0)&255}else{if(2==d)for(p=0;p<a;p++)t[c+p]=t[u+p]+t[c+p-a]&255;if(3==d){for(p=0;p<s;p++)t[c+p]=t[u+p]+(t[c+p-a]>>1)&255;for(p=s;p<a;p++)t[c+p]=t[u+p]+(t[c+p-a]+t[c+p-s]>>1)&255}if(4==d){for(p=0;p<s;p++)t[c+p]=t[u+p]+l(0,t[c+p-a],0)&255;for(p=s;p<a;p++)t[c+p]=t[u+p]+l(t[c+p-s],t[c+p-a],t[c+p-s-a])&255}}}return t},e.decode._paeth=function(e,t,i){var n=e+t-i,r=Math.abs(n-e),o=Math.abs(n-t),s=Math.abs(n-i);return r<=o&&r<=s?e:o<=s?t:i},e.decode._IHDR=function(t,i,n){var r=e._bin;n.width=r.readUint(t,i),i+=4,n.height=r.readUint(t,i),i+=4,n.depth=t[i],i++,n.ctype=t[i],i++,n.compress=t[i],i++,n.filter=t[i],i++,n.interlace=t[i],i++},e._bin={nextZero:function(e,t){for(;0!=e[t];)t++;return t},readUshort:function(e,t){return e[t]<<8|e[t+1]},writeUshort:function(e,t,i){e[t]=i>>8&255,e[t+1]=255&i},readUint:function(e,t){return 16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3])},writeUint:function(e,t,i){e[t]=i>>24&255,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i},readASCII:function(e,t,i){for(var n="",r=0;r<i;r++)n+=String.fromCharCode(e[t+r]);return n},writeASCII:function(e,t,i){for(var n=0;n<i.length;n++)e[t+n]=i.charCodeAt(n)},readBytes:function(e,t,i){for(var n=[],r=0;r<i;r++)n.push(e[t+r]);return n},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(t,i,n){for(var r,o="",s=0;s<n;s++)o+="%"+e._bin.pad(t[i+s].toString(16));try{r=decodeURIComponent(o)}catch(r){return e._bin.readASCII(t,i,n)}return r}},e._copyTile=function(e,t,i,n,r,o,s,a,l){for(var h=Math.min(t,r),c=Math.min(i,o),u=0,d=0,p=0;p<c;p++)for(var g=0;g<h;g++)if(s>=0&&a>=0?(u=p*t+g<<2,d=(a+p)*r+s+g<<2):(u=(-a+p)*t-s+g<<2,d=p*r+g<<2),0==l)n[d]=e[u],n[d+1]=e[u+1],n[d+2]=e[u+2],n[d+3]=e[u+3];else if(1==l){var m=e[u+3]*(1/255),f=e[u]*m,v=e[u+1]*m,w=e[u+2]*m,y=n[d+3]*(1/255),_=n[d]*y,T=n[d+1]*y,x=n[d+2]*y,S=1-m,b=m+y*S,E=0==b?0:1/b;n[d+3]=255*b,n[d+0]=(f+_*S)*E,n[d+1]=(v+T*S)*E,n[d+2]=(w+x*S)*E}else if(2==l){m=e[u+3],f=e[u],v=e[u+1],w=e[u+2],y=n[d+3],_=n[d],T=n[d+1],x=n[d+2];m==y&&f==_&&v==T&&w==x?(n[d]=0,n[d+1]=0,n[d+2]=0,n[d+3]=0):(n[d]=f,n[d+1]=v,n[d+2]=w,n[d+3]=m)}else if(3==l){m=e[u+3],f=e[u],v=e[u+1],w=e[u+2],y=n[d+3],_=n[d],T=n[d+1],x=n[d+2];if(m==y&&f==_&&v==T&&w==x)continue;if(m<220&&y>20)return!1}return!0},e.encode=function(t,i,n,r,o,s){null==r&&(r=0),null==s&&(s=!1);var a=e.encode.compress(t,i,n,r,!1,s);return e.encode.compressPNG(a,-1),e.encode._main(a,i,n,o)},e.encodeLL=function(t,i,n,r,o,s,a){for(var l={ctype:0+(1==r?0:2)+(0==o?0:4),depth:s,frames:[]},h=(r+o)*s,c=h*i,u=0;u<t.length;u++)l.frames.push({rect:{x:0,y:0,width:i,height:n},img:new Uint8Array(t[u]),blend:0,dispose:1,bpp:Math.ceil(h/8),bpl:Math.ceil(c/8)});return e.encode.compressPNG(l,0),e.encode._main(l,i,n,a)},e.encode._main=function(t,i,n,r){var o=e.crc.crc,s=e._bin.writeUint,a=e._bin.writeUshort,l=e._bin.writeASCII,h=8,c=t.frames.length>1,u=!1,d=46+(c?20:0);if(3==t.ctype){for(var p=t.plte.length,g=0;g<p;g++)t.plte[g]>>>24!=255&&(u=!0);d+=8+3*p+4+(u?8+1*p+4:0)}for(var m=0;m<t.frames.length;m++){var f=t.frames[m];c&&(d+=38),d+=f.cimg.length+12,0!=m&&(d+=4)}d+=12;var v=new Uint8Array(d),w=[137,80,78,71,13,10,26,10];for(g=0;g<8;g++)v[g]=w[g];if(s(v,h,13),l(v,h+=4,"IHDR"),s(v,h+=4,i),s(v,h+=4,n),v[h+=4]=t.depth,v[++h]=t.ctype,v[++h]=0,v[++h]=0,v[++h]=0,s(v,++h,o(v,h-17,17)),h+=4,c&&(s(v,h,8),l(v,h+=4,"acTL"),s(v,h+=4,t.frames.length),s(v,h+=4,0),s(v,h+=4,o(v,h-12,12)),h+=4),3==t.ctype){s(v,h,3*(p=t.plte.length)),l(v,h+=4,"PLTE"),h+=4;for(g=0;g<p;g++){var y=3*g,_=t.plte[g],T=255&_,x=_>>>8&255,S=_>>>16&255;v[h+y+0]=T,v[h+y+1]=x,v[h+y+2]=S}if(s(v,h+=3*p,o(v,h-3*p-4,3*p+4)),h+=4,u){s(v,h,p),l(v,h+=4,"tRNS"),h+=4;for(g=0;g<p;g++)v[h+g]=t.plte[g]>>>24&255;s(v,h+=p,o(v,h-p-4,p+4)),h+=4}}var b=0;for(m=0;m<t.frames.length;m++){f=t.frames[m];c&&(s(v,h,26),l(v,h+=4,"fcTL"),s(v,h+=4,b++),s(v,h+=4,f.rect.width),s(v,h+=4,f.rect.height),s(v,h+=4,f.rect.x),s(v,h+=4,f.rect.y),a(v,h+=4,r[m]),a(v,h+=2,1e3),v[h+=2]=f.dispose,v[++h]=f.blend,s(v,++h,o(v,h-30,30)),h+=4);var E=f.cimg;s(v,h,(p=E.length)+(0==m?0:4));var P=h+=4;l(v,h,0==m?"IDAT":"fdAT"),h+=4,0!=m&&(s(v,h,b++),h+=4);for(g=0;g<p;g++)v[h+g]=E[g];s(v,h+=p,o(v,P,h-P)),h+=4}return s(v,h,0),l(v,h+=4,"IEND"),s(v,h+=4,o(v,h-4,4)),h+=4,v.buffer},e.encode.compressPNG=function(t,i){for(var n=0;n<t.frames.length;n++){var r=t.frames[n],o=(r.rect.width,r.rect.height),s=new Uint8Array(o*r.bpl+o);r.cimg=e.encode._filterZero(r.img,o,r.bpp,r.bpl,s,i)}},e.encode.compress=function(t,i,n,r,o,s){null==s&&(s=!1);for(var a=6,l=8,h=255,c=0;c<t.length;c++)for(var u=new Uint8Array(t[c]),d=u.length,p=0;p<d;p+=4)h&=u[p+3];var g=255!=h,m=g&&o,f=e.encode.framize(t,i,n,o,m),v={},w=[],y=[];if(0!=r){var _=[];for(p=0;p<f.length;p++)_.push(f[p].img.buffer);var T=e.encode.concatRGBA(_,o),x=e.quantize(T,r),S=0,b=new Uint8Array(x.abuf);for(p=0;p<f.length;p++){var E=(V=f[p].img).length;y.push(new Uint8Array(x.inds.buffer,S>>2,E>>2));for(c=0;c<E;c+=4)V[c]=b[S+c],V[c+1]=b[S+c+1],V[c+2]=b[S+c+2],V[c+3]=b[S+c+3];S+=E}for(p=0;p<x.plte.length;p++)w.push(x.plte[p].est.rgba)}else for(c=0;c<f.length;c++){var P=f[c],R=new Uint32Array(P.img.buffer),C=P.rect.width,k=(d=R.length,new Uint8Array(d));y.push(k);for(p=0;p<d;p++){var I=R[p];if(0!=p&&I==R[p-1])k[p]=k[p-1];else if(p>C&&I==R[p-C])k[p]=k[p-C];else{var O=v[I];if(null==O&&(v[I]=O=w.length,w.push(I),w.length>=300))break;k[p]=O}}}var z=w.length;z<=256&&0==s&&(l=z<=2?1:z<=4?2:z<=16?4:8,o&&(l=8));for(c=0;c<f.length;c++){(P=f[c]).rect.x,P.rect.y,C=P.rect.width;var B=P.rect.height,D=P.img,A=(new Uint32Array(D.buffer),4*C),L=4;if(z<=256&&0==s){A=Math.ceil(l*C/8);for(var M=new Uint8Array(A*B),H=y[c],F=0;F<B;F++){p=F*A;var N=F*C;if(8==l)for(var U=0;U<C;U++)M[p+U]=H[N+U];else if(4==l)for(U=0;U<C;U++)M[p+(U>>1)]|=H[N+U]<<4-4*(1&U);else if(2==l)for(U=0;U<C;U++)M[p+(U>>2)]|=H[N+U]<<6-2*(3&U);else if(1==l)for(U=0;U<C;U++)M[p+(U>>3)]|=H[N+U]<<7-1*(7&U)}D=M,a=3,L=1}else if(0==g&&1==f.length){M=new Uint8Array(C*B*3);var W=C*B;for(p=0;p<W;p++){var V,G=4*p;M[V=3*p]=D[G],M[V+1]=D[G+1],M[V+2]=D[G+2]}D=M,a=2,L=3,A=3*C}P.img=D,P.bpl=A,P.bpp=L}return{ctype:a,depth:l,plte:w,frames:f}},e.encode.framize=function(t,i,n,r,o){for(var s=[],a=0;a<t.length;a++){var l=new Uint8Array(t[a]),h=new Uint32Array(l.buffer),c=0,u=0,d=i,p=n,g=0;if(0==a||o)l=l.slice(0);else{for(var m=r||1==a||2==s[s.length-2].dispose?1:2,f=0,v=1e9,w=0;w<m;w++){for(var y=new Uint8Array(t[a-1-w]),_=new Uint32Array(t[a-1-w]),T=i,x=n,S=-1,b=-1,E=0;E<n;E++)for(var P=0;P<i;P++){var R=E*i+P;h[R]!=_[R]&&(P<T&&(T=P),P>S&&(S=P),E<x&&(x=E),E>b&&(b=E))}var C=-1==S?1:(S-T+1)*(b-x+1);C<v&&(v=C,f=w,-1==S?(c=u=0,d=p=1):(c=T,u=x,d=S-T+1,p=b-x+1))}y=new Uint8Array(t[a-1-f]);1==f&&(s[s.length-1].dispose=2);var k=new Uint8Array(d*p*4);new Uint32Array(k.buffer);e._copyTile(y,i,n,k,d,p,-c,-u,0),e._copyTile(l,i,n,k,d,p,-c,-u,3)?(e._copyTile(l,i,n,k,d,p,-c,-u,2),g=1):(e._copyTile(l,i,n,k,d,p,-c,-u,0),g=0),l=k}s.push({rect:{x:c,y:u,width:d,height:p},img:l,blend:g,dispose:o?1:0})}return s},e.encode._filterZero=function(i,n,r,o,s,a){if(-1!=a){for(var l=0;l<n;l++)e.encode._filterLine(s,i,l,o,r,a);return t.deflate(s,{level:0})}for(var h=[],c=0;c<5;c++)if(!(n*o>5e5)||2!=c&&3!=c&&4!=c){for(l=0;l<n;l++)e.encode._filterLine(s,i,l,o,r,c);if(h.push(t.deflate(s,{level:0})),1==r)break}for(var u,d=1e9,p=0;p<h.length;p++)h[p].length<d&&(u=p,d=h[p].length);return h[u]},e.encode._filterLine=function(t,i,n,r,o,s){var a=n*r,l=a+n,h=e.decode._paeth;if(t[l]=s,l++,0==s)for(var c=0;c<r;c++)t[l+c]=i[a+c];else if(1==s){for(c=0;c<o;c++)t[l+c]=i[a+c];for(c=o;c<r;c++)t[l+c]=i[a+c]-i[a+c-o]+256&255}else if(0==n){for(c=0;c<o;c++)t[l+c]=i[a+c];if(2==s)for(c=o;c<r;c++)t[l+c]=i[a+c];if(3==s)for(c=o;c<r;c++)t[l+c]=i[a+c]-(i[a+c-o]>>1)+256&255;if(4==s)for(c=o;c<r;c++)t[l+c]=i[a+c]-h(i[a+c-o],0,0)+256&255}else{if(2==s)for(c=0;c<r;c++)t[l+c]=i[a+c]+256-i[a+c-r]&255;if(3==s){for(c=0;c<o;c++)t[l+c]=i[a+c]+256-(i[a+c-r]>>1)&255;for(c=o;c<r;c++)t[l+c]=i[a+c]+256-(i[a+c-r]+i[a+c-o]>>1)&255}if(4==s){for(c=0;c<o;c++)t[l+c]=i[a+c]+256-h(0,i[a+c-r],0)&255;for(c=o;c<r;c++)t[l+c]=i[a+c]+256-h(i[a+c-o],i[a+c-r],i[a+c-o-r])&255}}},e.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var i=t,n=0;n<8;n++)1&i?i=3988292384^i>>>1:i>>>=1;e[t]=i}return e}(),update:function(t,i,n,r){for(var o=0;o<r;o++)t=e.crc.table[255&(t^i[n+o])]^t>>>8;return t},crc:function(t,i,n){return 4294967295^e.crc.update(4294967295,t,i,n)}},e.quantize=function(t,i){for(var n=new Uint8Array(t),r=n.slice(0),o=new Uint32Array(r.buffer),s=e.quantize.getKDtree(r,i),a=s[0],l=s[1],h=(e.quantize.planeDst,n),c=o,u=h.length,d=new Uint8Array(n.length>>2),p=0;p<u;p+=4){var g=h[p]*(1/255),m=h[p+1]*(1/255),f=h[p+2]*(1/255),v=h[p+3]*(1/255),w=e.quantize.getNearest(a,g,m,f,v);d[p>>2]=w.ind,c[p>>2]=w.est.rgba}return{abuf:r.buffer,inds:d,plte:l}},e.quantize.getKDtree=function(t,i,n){null==n&&(n=1e-4);var r=new Uint32Array(t.buffer),o={i0:0,i1:t.length,bst:null,est:null,tdst:0,left:null,right:null};o.bst=e.quantize.stats(t,o.i0,o.i1),o.est=e.quantize.estats(o.bst);for(var s=[o];s.length<i;){for(var a=0,l=0,h=0;h<s.length;h++)s[h].est.L>a&&(a=s[h].est.L,l=h);if(a<n)break;var c=s[l],u=e.quantize.splitPixels(t,r,c.i0,c.i1,c.est.e,c.est.eMq255);if(c.i0>=u||c.i1<=u)c.est.L=0;else{var d={i0:c.i0,i1:u,bst:null,est:null,tdst:0,left:null,right:null};d.bst=e.quantize.stats(t,d.i0,d.i1),d.est=e.quantize.estats(d.bst);var p={i0:u,i1:c.i1,bst:null,est:null,tdst:0,left:null,right:null};p.bst={R:[],m:[],N:c.bst.N-d.bst.N};for(h=0;h<16;h++)p.bst.R[h]=c.bst.R[h]-d.bst.R[h];for(h=0;h<4;h++)p.bst.m[h]=c.bst.m[h]-d.bst.m[h];p.est=e.quantize.estats(p.bst),c.left=d,c.right=p,s[l]=d,s.push(p)}}s.sort(function(e,t){return t.bst.N-e.bst.N});for(h=0;h<s.length;h++)s[h].ind=h;return[o,s]},e.quantize.getNearest=function(t,i,n,r,o){if(null==t.left)return t.tdst=e.quantize.dist(t.est.q,i,n,r,o),t;var s=e.quantize.planeDst(t.est,i,n,r,o),a=t.left,l=t.right;s>0&&(a=t.right,l=t.left);var h=e.quantize.getNearest(a,i,n,r,o);if(h.tdst<=s*s)return h;var c=e.quantize.getNearest(l,i,n,r,o);return c.tdst<h.tdst?c:h},e.quantize.planeDst=function(e,t,i,n,r){var o=e.e;return o[0]*t+o[1]*i+o[2]*n+o[3]*r-e.eMq},e.quantize.dist=function(e,t,i,n,r){var o=t-e[0],s=i-e[1],a=n-e[2],l=r-e[3];return o*o+s*s+a*a+l*l},e.quantize.splitPixels=function(t,i,n,r,o,s){var a=e.quantize.vecDot;r-=4;for(;n<r;){for(;a(t,n,o)<=s;)n+=4;for(;a(t,r,o)>s;)r-=4;if(n>=r)break;var l=i[n>>2];i[n>>2]=i[r>>2],i[r>>2]=l,n+=4,r-=4}for(;a(t,n,o)>s;)n-=4;return n+4},e.quantize.vecDot=function(e,t,i){return e[t]*i[0]+e[t+1]*i[1]+e[t+2]*i[2]+e[t+3]*i[3]},e.quantize.stats=function(e,t,i){for(var n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=[0,0,0,0],o=i-t>>2,s=t;s<i;s+=4){var a=e[s]*(1/255),l=e[s+1]*(1/255),h=e[s+2]*(1/255),c=e[s+3]*(1/255);r[0]+=a,r[1]+=l,r[2]+=h,r[3]+=c,n[0]+=a*a,n[1]+=a*l,n[2]+=a*h,n[3]+=a*c,n[5]+=l*l,n[6]+=l*h,n[7]+=l*c,n[10]+=h*h,n[11]+=h*c,n[15]+=c*c}return n[4]=n[1],n[8]=n[2],n[9]=n[6],n[12]=n[3],n[13]=n[7],n[14]=n[11],{R:n,m:r,N:o}},e.quantize.estats=function(t){var i=t.R,n=t.m,r=t.N,o=n[0],s=n[1],a=n[2],l=n[3],h=0==r?0:1/r,c=[i[0]-o*o*h,i[1]-o*s*h,i[2]-o*a*h,i[3]-o*l*h,i[4]-s*o*h,i[5]-s*s*h,i[6]-s*a*h,i[7]-s*l*h,i[8]-a*o*h,i[9]-a*s*h,i[10]-a*a*h,i[11]-a*l*h,i[12]-l*o*h,i[13]-l*s*h,i[14]-l*a*h,i[15]-l*l*h],u=c,d=e.M4,p=[.5,.5,.5,.5],g=0,m=0;if(0!=r)for(var f=0;f<10&&(p=d.multVec(u,p),m=Math.sqrt(d.dot(p,p)),p=d.sml(1/m,p),!(Math.abs(m-g)<1e-9));f++)g=m;var v=[o*h,s*h,a*h,l*h];return{Cov:c,q:v,e:p,L:g,eMq255:d.dot(d.sml(255,v),p),eMq:d.dot(p,v),rgba:(Math.round(255*v[3])<<24|Math.round(255*v[2])<<16|Math.round(255*v[1])<<8|Math.round(255*v[0])<<0)>>>0}},e.M4={multVec:function(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]]},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},sml:function(e,t){return[e*t[0],e*t[1],e*t[2],e*t[3]]}},e.encode.concatRGBA=function(e,t){for(var i=0,n=0;n<e.length;n++)i+=e[n].byteLength;var r=new Uint8Array(i),o=0;for(n=0;n<e.length;n++){for(var s=new Uint8Array(e[n]),a=s.length,l=0;l<a;l+=4){var h=s[l],c=s[l+1],u=s[l+2],d=s[l+3];t&&(d=0==(128&d)?0:255),0==d&&(h=c=u=0),r[o+l]=h,r[o+l+1]=c,r[o+l+2]=u,r[o+l+3]=d}o+=a}return r.buffer}}(t,i(22))}()}).call(this,i(23))},function(e,t,i){"use strict";window.OpenSeadragon=i(7),window.UPNG=i(24),i(13),i(12),e.exports={ViaWebGL:ViaWebGL,openSeadragonGL:openSeadragonGL}},function(e,t,i){"use strict";i(25).openSeadragonGL;var n=i(7),r=i(11);i(10),i(8),window.many_channel={defaults:{opacity:1,rows:1,tileSize:1024,tileMargin:-1024,compositeOperation:"lighter",prefixUrl:"images/openseadragon/"},define_interface:function(e){var t=document.getElementById("many-channel-composite-menu"),i=document.getElementById("many-channel-margin-menu"),r={anchor:n.ControlAnchor.TOP_LEFT};e.addControl(document.getElementById("many-channel-menus"),r),t.onchange=function(){var t=e.world,i=this.options[this.selectedIndex].value;"Null"==i&&(i=null);for(var n=0;n<t.getItemCount();n++){var r=t.getItemAt(n);r.compositeOperation=i,r._needsDraw=!0}t.update()},i.onchange=function(){var t=e.world,i=window.many_channel.defaults.rows,n=window.many_channel.defaults.tileSize,r=parseInt(this.options[this.selectedIndex].value);t.arrange({tileMargin:r,tileSize:n,rows:i});var o=t.getHomeBounds().getCenter();e.viewport.panTo(o)}},load_gl:function(e){this.gl.enable(this.gl.BLEND),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ONE,this.gl.ONE),this.u_tile_color=this.gl.getUniformLocation(e,"u_tile_color"),this.u_tile_range=this.gl.getUniformLocation(e,"u_tile_range")},draw_gl:function(){this.gl.uniform3fv(this.u_tile_color,this.color_3fv),this.gl.uniform2fv(this.u_tile_range,this.range_2fv),this.gl.clear(this.gl.COLOR_BUFFER_BIT)},load_tile:function(e,t){e(t)},draw_tile:function(e,t){t.tile;var i=this.viaGL,n=(this.openSD,t.tiledImage.source);i.color_3fv=new Float32Array(n.many_channel_color),i.range_2fv=new Float32Array(n.many_channel_range),e(t)},link_webgl:function(e){var t=new openSeadragonGL(e);t.vShader="static/vert.glsl",t.fShader="static/frag.glsl",t.addHandler("tile-drawing",window.many_channel.draw_tile),t.addHandler("tile-loaded",window.many_channel.load_tile),t.addHandler("gl-drawing",window.many_channel.draw_gl),t.addHandler("gl-loaded",window.many_channel.load_gl),t.button({prefix:window.many_channel.defaults.prefixUrl,tooltip:"Toggle shaders",name:"button"}),t.init()}},window.onload=function(){var e=r(window.location.pathname),t=window.read_source_list(e),i=n({debugMode:e.debug,collectionMode:!0,id:"many-channel-viewer",showZoomControl:!1,showHomeControl:!1,showFullPageControl:!1,loadTilesWithAjax:!0,opacity:window.many_channel.defaults.opacity,collectionRows:window.many_channel.defaults.rows,prefixUrl:window.many_channel.defaults.prefixUrl,collectionTileSize:window.many_channel.defaults.tileSize,collectionTileMargin:window.many_channel.defaults.tileMargin,compositeOperation:window.many_channel.defaults.compositeOperation,tileSources:t});window.many_channel.link_webgl(i),window.many_channel.define_interface(i);var o=document.getElementById("many-channel-color-slider");window.attach_color_events(o,i)}},function(e,t,i){e.exports=i(26)}]);